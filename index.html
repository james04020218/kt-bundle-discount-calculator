<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KT ê²°í•© í• ì¸ ê³„ì‚°ê¸° (Gemini AI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }

        .input-group { margin-bottom: 1.5rem; }
        .input-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #334155; /* slate-700 */ }
        .input-field, .select-field { width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #cbd5e1; /* slate-300 */ border-radius: 0.375rem; box-shadow: sm; transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out; }
        .input-field:focus, .select-field:focus { border-color: #0ea5e9; /* sky-500 */ outline: none; box-shadow: 0 0 0 0.2rem rgba(14, 165, 233, 0.25); }
        .input-field:disabled, .select-field:disabled { background-color: #e2e8f0; /* slate-200 */ cursor: not-allowed; }
        .btn-primary { background-color: #0ea5e9; /* sky-500 */ color: white; padding: 0.75rem 1.5rem; border-radius: 0.375rem; font-weight: 600; transition: background-color 0.3s ease; }
        .btn-primary:hover { background-color: #0284c7; /* sky-600 */ }
        .btn-secondary { background-color: #64748b; /* slate-500 */ color: white; padding: 0.75rem 1.5rem; border-radius: 0.375rem; font-weight: 600; transition: background-color 0.3s ease; }
        .btn-secondary:hover { background-color: #475569; /* slate-600 */ }
        .section-title { font-size: 1.5rem; font-weight: 700; color: #0369a1; /* sky-700 */ margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #38bdf8 /* sky-400 */;}
        .result-card { background-color: white; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); margin-bottom: 1.5rem; }
        .result-label { color: #475569; /* slate-600 */ }
        .result-value { color: #1e293b; /* slate-800 */ font-weight: 600;}
        .total-value { color: #f59e0b; /* amber-500 */ font-size: 1.5rem; font-weight: 700;}
        .mobile-line-item { border: 1px solid #e2e8f0; /* slate-200 */ padding: 1rem; border-radius: 0.375rem; margin-bottom: 0.75rem; }
        .radio-label { margin-right: 1rem; margin-bottom: 0.5rem; display: inline-flex; align-items: center; cursor: pointer;}
        .radio-input { margin-right: 0.5rem; accent-color: #0ea5e9; /* sky-500 */ }
        .info-box { background-color: #eff6ff; /* blue-50 */ border-left: 4px solid #3b82f6; /* blue-500 */ padding: 1rem; margin-top:0.5rem; margin-bottom:1rem; font-size: 0.875rem; color: #1e40af; /* blue-800 */}
        .info-box ul { padding-left: 1.25rem; list-style-type: disc; }
        .info-box ul ul { padding-left: 1rem; list-style-type: circle;}
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 20px; margin-left: 10px; vertical-align: middle;}
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px;}
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%;}
        input:checked + .slider { background-color: #2196F3; } /* KT Sky Blue for toggle */
        input:checked + .slider:before { transform: translateX(20px); }
        .discount-details { background-color: #f0f9ff; border: 1px solid #bae6fd; padding: 1rem; border-radius: 0.375rem; font-size:0.875rem; }
        .discount-details ul { padding-left: 1.25rem; }
        .discount-details ul ul { padding-left: 1rem; }
        .summary-item { margin-bottom: 0.25rem; }
        .message-script-area { width: 100%; min-height: 150px; padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-size: 0.875rem; white-space: pre-wrap; word-wrap: break-word; }
        .copy-button-container { text-align: right; margin-top: 0.5rem; }
        .copy-feedback { font-size: 0.75rem; color: green; margin-left: 0.5rem; }
    </style>
</head>
<body class="text-slate-800">
    <header class="bg-sky-700 text-white p-6 shadow-md">
        <div class="container mx-auto max-w-4xl">
            <h1 class="text-3xl font-bold text-center">KT ê²°í•© í• ì¸ ê³„ì‚°ê¸° (Gemini AI âœ¨)</h1>
            <p class="text-center text-sky-200 mt-1">ì„ íƒí•˜ì‹  ì„œë¹„ìŠ¤ì™€ í• ì¸ ìœ í˜•ì— ë”°ë¥¸ ì˜ˆìƒ ìš”ê¸ˆì„ ê³„ì‚°í•´ ë³´ì„¸ìš”.</p>
        </div>
    </header>

    <main class="container mx-auto max-w-4xl p-4 sm:p-6 lg:p-8">
        <section id="inputSection" class="mb-8">
            <h2 class="section-title">1. ì„œë¹„ìŠ¤ ì„ íƒ (3ë…„ ì•½ì • ê¸°ì¤€, VAT í¬í•¨)</h2>
            <p class="mb-3 text-sm text-slate-600">ì•„ë˜ í•­ëª©ë“¤ì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”. ëª¨ë“  ìš”ê¸ˆì€ KT í‘œì¤€ 3ë…„ ì•½ì •, ë¶€ê°€ì„¸ í¬í•¨ ê¸ˆì•¡ì„ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤. TV, ì „í™”, ëª¨ë°”ì¼ ì„ íƒì€ ì¸í„°ë„· ìš”ê¸ˆ í• ì¸ ê³„ì‚°ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.</p>
            
            <div class="mb-2 text-sm">
                <p class="font-semibold text-red-600">âš ï¸ ë¯¼ê°ì •ë³´</p>
                <p><a href="https://miso.kr/booking/forms/secure-details?querystring=ê³ ê°ë‹˜ ì „í™”ë²ˆí˜¸" target="_blank" class="text-red-500 hover:text-red-700 underline font-medium break-all">https://miso.kr/booking/forms/secure-details?querystring=ê³ ê°ë‹˜ ì „í™”ë²ˆí˜¸</a></p>
                <p class="text-slate-600">ã„´> ìœ„ ë§í¬ë¥¼ ê³ ê°ì—ê²Œ ë¬¸ìë¡œ ì „ì†¡í•´ì£¼ì„¸ìš”. (ì•„ë˜ ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬ ê¸°ëŠ¥ ì´ìš©)</p>
            </div>
            <div class="mb-2 text-sm">
                <span class="font-semibold text-sky-700">ì°¸ê³  ìŠ¤í”„ë ˆë“œì‹œíŠ¸:</span>
                <a href="https://docs.google.com/spreadsheets/d/10d21RrhIPBiJr7RZIHnk0h1dB4GvTEcHCuXSyFYw1M4/edit?gid=0#gid=0" target="_blank" class="text-blue-600 hover:text-blue-700 underline font-medium">ë°”ë¡œê°€ê¸°</a>
            </div>
            <div class="mb-4 text-sm">
                <span class="font-semibold text-sky-700">KT ì¸í„°ë„· ìƒí’ˆì²­ì•½ ë³¸ì¸ì¸ì¦ ë§í¬:</span>
                <a href="https://online.kt.com/smart/simple/simpleCustomerInfoPop.do?prdcId=0F0BA335-ACD6-459E-BDB3-95CE61EEFE35" target="_blank" class="text-blue-600 hover:text-blue-700 underline font-medium">ë°”ë¡œê°€ê¸° (PASS ë˜ëŠ” ì‹ ìš©ì¹´ë“œ ì¸ì¦)</a>
            </div>

            <div class="input-group">
                <label class="input-label">ì¸í„°ë„· ìœ í˜• ì„ íƒ</label>
                <div class="flex items-center space-x-4">
                    <label class="radio-label">
                        <input type="radio" name="internetType" value="bundle" class="radio-input">
                        ì¸í„°ë„· + TV ë²ˆë“¤
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="internetType" value="standalone" class="radio-input" checked>
                        ì¸í„°ë„· ë‹¨ë…
                    </label>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="input-group">
                    <label for="internetPlan" class="input-label">ì¸í„°ë„· ìš”ê¸ˆì œ</label>
                    <select id="internetPlan" class="select-field">
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="wifiRouterRental" class="input-label block mb-1">ì™€ì´íŒŒì´ ê³µìœ ê¸°</label>
                    <select id="wifiRouterRental" class="select-field">
                        <option value="1100" data-name="KTê³µìœ ê¸°">KTê³µìœ ê¸° (ì›” 1,100ì›)</option>
                        <option value="0" data-name="GiGA WiFi home ax">GiGA WiFi home ax</option>
                        <option value="0" data-name="KT WiFi 7D">KT WiFi 7D</option>
                        <option value="0" data-name="KTê³µìœ ê¸° X">KTê³µìœ ê¸° X (ë¯¸ì‚¬ìš©)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="tvPlan" class="input-label">TV ìš”ê¸ˆì œ (1ë²ˆì§¸ TV, ê¸°ê°€ì§€ë‹ˆA í¬í•¨ê°€)</label>
                    <select id="tvPlan" class="select-field">
                        <option value="none" data-category="ì—†ìŒ" data-stb-included-price="0">ì„ íƒ ì•ˆí•¨</option>
                        <option value="KTTVë² ì´ì§" data-price="15400" data-category="ë² ì´ì§" data-stb-included-price="15400">KTTVë² ì´ì§ (236ì±„ë„) + ê¸°ê°€ì§€ë‹ˆA (ì›” 15,400ì›)</option>
                        <option value="KTTVë¼ì´íŠ¸" data-price="16500" data-category="ë¼ì´íŠ¸" data-stb-included-price="16500">KTTVë¼ì´íŠ¸ (240ì±„ë„) + ê¸°ê°€ì§€ë‹ˆA (ì›” 16,500ì›)</option>
                        <option value="KTTVì—ì„¼ìŠ¤" data-price="19800" data-category="ì—ì„¼ìŠ¤" data-stb-included-price="19800">KTTVì—ì„¼ìŠ¤ (266ì±„ë„) + ê¸°ê°€ì§€ë‹ˆA (ì›” 19,800ì›)</option>
                        <option value="KTTVì—ì„¼ìŠ¤ í”ŒëŸ¬ìŠ¤" data-price="24200" data-category="ì—ì„¼ìŠ¤ í”ŒëŸ¬ìŠ¤" data-stb-included-price="24200">KTTVì—ì„¼ìŠ¤ í”ŒëŸ¬ìŠ¤ (266+ì±„ë„) (ì›” 24,200ì›)</option>
                        <option value="KTTVë„·í”Œë¦­ìŠ¤ HD" data-price="31100" data-category="ë„·í”Œë¦­ìŠ¤ HD" data-stb-included-price="31100">KTTVë„·í”Œë¦­ìŠ¤ HD (267ì±„ë„) (ì›” 31,100ì›)</option>
                        <option value="KTTVë„·í”Œë¦­ìŠ¤ UHD" data-price="34600" data-category="ë„·í”Œë¦­ìŠ¤ UHD" data-stb-included-price="34600">KTTVë„·í”Œë¦­ìŠ¤ UHD (267ì±„ë„) (ì›” 34,600ì›)</option>
                        <option value="KTTVí‚¤ì¦ˆëœë“œíŒ©ì´ˆì´ìŠ¤" data-price="20900" data-category="í‚¤ì¦ˆëœë“œ" data-stb-included-price="20900">KTTVí‚¤ì¦ˆëœë“œíŒ©ì´ˆì´ìŠ¤ (ì›” 20,900ì›)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="additionalTvPlan" class="input-label">ì¶”ê°€ TV ì„ íƒ (2ë²ˆì§¸ TV)</label>
                    <select id="additionalTvPlan" class="select-field">
                        <option value="none" data-price="0" data-name="ì„ íƒ ì•ˆí•¨">ì„ íƒ ì•ˆí•¨</option>
                        <option value="KTTV ì¶”ê°€ë² ì´ì§" data-price="10670" data-name="ë² ì´ì§ (236ì±„ë„) + ê¸°ê°€ì§€ë‹ˆA">KTTV ì¶”ê°€ë² ì´ì§ (236ì±„ë„) + ê¸°ê°€ì§€ë‹ˆA (ì›” 10,670ì›)</option>
                        <option value="KTTV ì¶”ê°€ë¼ì´íŠ¸" data-price="11220" data-name="ë¼ì´íŠ¸ (240ì±„ë„) + ê¸°ê°€ì§€ë‹ˆA">KTTV ì¶”ê°€ë¼ì´íŠ¸ (240ì±„ë„) + ê¸°ê°€ì§€ë‹ˆA (ì›” 11,220ì›)</option>
                        <option value="KTTV ì¶”ê°€ì—ì„¼ìŠ¤" data-price="13420" data-name="ì—ì„¼ìŠ¤ (266ì±„ë„) + ê¸°ê°€ì§€ë‹ˆA">KTTV ì¶”ê°€ì—ì„¼ìŠ¤ (266ì±„ë„) + ê¸°ê°€ì§€ë‹ˆA (ì›” 13,420ì›)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="phonePlan" class="input-label">ì§‘ì „í™” ìš”ê¸ˆì œ</label>
                    <select id="phonePlan" class="select-field">
                        <option value="none">ì„ íƒ ì•ˆí•¨</option>
                        <option value="ì¸í„°ë„·ì „í™” ìš°ë¦¬ë¼ë¦¬3000" data-price="6294">ìš°ë¦¬ë¼ë¦¬3000 (ì›” 6,294ì›)</option>
                        <option value="ì§‘ì „í™” ìœ ì„ 3000" data-price="8494">ìœ ì„ 3000 (ì›” 8,494ì›)</option>
                        <option value="ì§‘ì „í™” ìœ ë¬´ì„ 3000" data-price="8250">ìœ ë¬´ì„ 3000 (ì›” 8,250ì›)</option>
                    </select>
                </div>
            </div>
            
            <div class="input-group">
                <label class="input-label">KT ë¶€ê°€ì„œë¹„ìŠ¤ (ì„ íƒ)</label>
                <div id="addonServicesContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                    <label class="flex items-center"><input type="checkbox" name="addonService" value="ê¸°ê°€ì§€ë‹ˆ3A" data-price="1100" class="radio-input mr-2">ê¸°ê°€ì§€ë‹ˆ3A (AI ì…‹í†±ë°•ìŠ¤) (ì›” 1,100ì›)</label>
                    <label class="flex items-center"><input type="checkbox" name="addonService" value="AI ì§€ë‹ˆ TV ì˜¬ì¸ì› ì‚¬ìš´ë“œë°”" data-price="5500" class="radio-input mr-2">AI ì§€ë‹ˆ TV ì˜¬ì¸ì› ì‚¬ìš´ë“œë°” (ì›” 5,500ì›)</label>
                    <label class="flex items-center"><input type="checkbox" name="addonService" value="ë²„ë””ì¦í­ê¸°" data-price="1650" class="radio-input mr-2">ë²„ë””ì¦í­ê¸° (ì›” 1,650ì›)</label>
                    <label class="flex items-center"><input type="checkbox" name="addonService" value="ê¸°ê°€ì§€ë‹ˆ 4A" data-price="3300" class="radio-input mr-2">ê¸°ê°€ì§€ë‹ˆ 4A (ì›” 3,300ì›)</label>
                </div>
            </div>
        </section>

        <section id="discountTypeSection" class="mb-8">
            <h2 class="section-title">2. ê²°í•© í• ì¸ ìœ í˜• ì„ íƒ</h2>
            <div class="bg-white p-6 rounded-lg shadow">
                <p class="mb-4 text-sm text-slate-600">ê°€ì¥ ìœ ë¦¬í•œ í• ì¸ ìœ í˜•ì„ ì„ íƒí•˜ê±°ë‚˜, ê° ìœ í˜•ë³„ ì˜ˆìƒ ìš”ê¸ˆì„ ë¹„êµí•´ë³´ì„¸ìš”.</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2">
                    <label class="radio-label"><input type="radio" name="discountType" value="none" class="radio-input"> ê²°í•© í• ì¸ ì—†ìŒ</label>
                    <div class="flex items-center">
                        <label class="radio-label"><input type="radio" name="discountType" value="totalAmountBundle" class="radio-input" checked> ì´ì•¡ ê²°í•©í• ì¸</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="totalAmountDetailsToggle">
                            <span class="slider"></span>
                        </label>
                        <span class="ml-1 text-xs text-slate-500">(ìƒì„¸ë³´ê¸°)</span>
                    </div>
                    <div class="flex items-center">
                        <label class="radio-label"><input type="radio" name="discountType" value="premiumFamilyBundle" class="radio-input"> í”„ë¦¬ë¯¸ì—„ ê°€ì¡±ê²°í•©</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="premiumFamilyDetailsToggle">
                            <span class="slider"></span>
                        </label>
                        <span class="ml-1 text-xs text-slate-500">(ìƒì„¸ë³´ê¸°)</span>
                    </div>
                    <div class="flex items-center">
                        <label class="radio-label"><input type="radio" name="discountType" value="premiumSingleBundle" class="radio-input"> í”„ë¦¬ë¯¸ì—„ ì‹±ê¸€ê²°í•©</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="premiumSingleDetailsToggle">
                            <span class="slider"></span>
                        </label>
                        <span class="ml-1 text-xs text-slate-500">(ìƒì„¸ë³´ê¸°)</span>
                    </div>
                    <div class="flex items-center">
                        <label class="radio-label"><input type="radio" name="discountType" value="mvnoBundle" class="radio-input"> ì•Œëœ°í° ê²°í•©</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="mvnoDetailsToggle">
                            <span class="slider"></span>
                        </label>
                        <span class="ml-1 text-xs text-slate-500">(ìƒì„¸ë³´ê¸°)</span>
                    </div>
                    <div class="flex items-center">
                        <label class="radio-label"><input type="radio" name="discountType" value="familyBundle" class="radio-input"> íŒ¨ë°€ë¦¬ ê²°í•© (ì¸í„°ë„· ì¶”ê°€íšŒì„ )</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="familyBundleDetailsToggle">
                            <span class="slider"></span>
                        </label>
                        <span class="ml-1 text-xs text-slate-500">(ìƒì„¸ë³´ê¸°)</span>
                    </div>
                    <div class="flex items-center">
                        <label class="radio-label"><input type="radio" name="discountType" value="separateFamilyBundle" class="radio-input"> ë”°ë¡œ ì‚´ì•„ë„ ê°€ì¡±ê²°í•©</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="separateFamilyDetailsToggle">
                            <span class="slider"></span>
                        </label>
                        <span class="ml-1 text-xs text-slate-500">(ìƒì„¸ë³´ê¸°)</span>
                    </div>
                </div>

                <div id="totalAmountDetailsContainer" class="mt-4 hidden discount-details"></div>
                <div id="premiumFamilyDetailsContainer" class="mt-4 hidden discount-details"></div>
                <div id="premiumSingleDetailsContainer" class="mt-4 hidden discount-details"></div>
                <div id="familyBundleDetailsContainer" class="mt-4 hidden discount-details"></div>
                <div id="separateFamilyDetailsContainer" class="mt-4 hidden discount-details"></div>
                <div id="mvnoDetailsContainer" class="mt-4 hidden discount-details"></div>

                <div class="input-group mt-6">
                    <label class="input-label">ëª¨ë°”ì¼ íšŒì„  ì •ë³´ (ìµœëŒ€ 5íšŒì„ )</label>
                    <div class="flex items-center mb-2">
                        <label for="mobileLinesCount" class="mr-2 text-sm text-slate-700">ê²°í•©í•  ëª¨ë°”ì¼ íšŒì„  ìˆ˜:</label>
                        <input type="number" id="mobileLinesCount" min="0" max="5" value="0" class="input-field w-20 text-center">
                    </div>
                    <div id="mobileLinesContainer" class="space-y-3"></div>
                </div>
                <div class="input-group mt-6">
                    <label for="dongpanSalesCheckKt" class="input-label flex items-center cursor-pointer">
                        <input type="checkbox" id="dongpanSalesCheckKt" class="radio-input h-5 w-5 mr-2">
                        KT ë™íŒìœ ì‹¬ íŒë§¤ ì‹œ ì¶”ê°€ ì‚¬ì€í’ˆ ì ìš© ë° ì•ˆë‚´ ë³´ê¸°
                    </label>
                    <div id="dongpanPolicyDetailsContainerKt" class="mt-3 hidden info-box">
                        <h4 class="font-semibold text-sm mb-2">KT ì¸í„°ë„· ìœ ì‹¬ ê°œí†µ ì ˆì°¨ ì•ˆë‚´ (ìƒë‹´ì› ì°¸ê³ ìš©)</h4>
                        <p class="text-xs mb-1"><strong>ì‹ ì²­ ë° ì¸ì¦:</strong></p>
                        <ul class="list-disc list-inside text-xs space-y-0.5 mb-2">
                            <li>KT ì¸í„°ë„· ìœ ì‹¬ ê°œí†µ ì‹ ì²­ì„œ ë§í¬: <a href="http://online.kt.com/index.jsp?prdcID=6C463388-3BDF-4E68-BE73-975E05BDA182" target="_blank" class="text-blue-700 font-bold hover:text-blue-800 underline text-lg">ë°”ë¡œê°€ê¸°</a> (PASS ë˜ëŠ” ì‹ ìš©ì¹´ë“œ ì¸ì¦ í•„ìš”)</li>
                            <li>KT ë™íŒ ê²°í•© ë³¸ì¸ì¸ì¦ ë§í¬ (ê²°í•©ë§Œ ì²´í¬): <a href="https://online.kt.com/smart/simple/simpleCustomerInfoPop.do?prdcId=65278B4C-20F1-47FA-9EEF-56E9B574D346" target="_blank" class="text-blue-600 hover:underline font-semibold">ë°”ë¡œê°€ê¸°</a></li>
                        </ul>
                        <p class="text-xs mb-1"><strong>ê²°í•© ê°€ëŠ¥ íšŒì„ :</strong> ì¸í„°ë„· + ìœ ì‹¬ ë™íŒ + ê°€ì¡± ìœ ì‹¬ 2íšŒì„  (ì´ 3íšŒì„ ê¹Œì§€ ê°€ëŠ¥)</p>
                        <p class="text-xs mb-1"><strong>ì ‘ìˆ˜ ê³¼ì •:</strong> ë°±ë©”ê°€ ì ‘ìˆ˜ì›¹(speedonline.kr) KT(ì¼ë°˜) > ëª¨ë°”ì¼ íƒ­ìœ¼ë¡œ ì ‘ìˆ˜</p>
                        <p class="text-xs mb-1"><strong>ì ‘ìˆ˜ ì‹œ í•„ìˆ˜ ê¸°ì¬ ì‚¬í•­ (ê¸°íƒ€ë©”ëª¨ ì–‘ì‹):</strong></p>
                        <ul class="list-disc list-inside text-xs space-y-0.5 mb-2">
                            <li>ì¸í„°ë„· ê°œí†µ ì™„ë£Œ ì‹œ: "[ê°œí†µ ì™„ë£Œ / ìœ ì‹¬ ë°œì†¡ ìš”ì²­]"</li>
                            <li>ì´ë¯¸ ê°œí†µëœ ê³ ê° 30ì¼ ì´ë‚´ ë™íŒ ì‹œ: "[ê°œí†µì™„ë£Œ ì¼ì, ê°œí†µë²ˆí˜¸ ê¸°ì¬ / ìœ ì‹¬ ë°œì†¡ ìš”ì²­]"</li>
                            <li>ê³ ê° ìœ ì‹¬ ìˆ˜ë ¹ í›„ ê°œí†µ ìš”ì²­ ì‹œ: "[ê³ ê° ìœ ì‹¬ ìˆ˜ë ¹ ì™„ë£Œ / ê°œí†µ ì§„í–‰ ìš”ì²­]"</li>
                        </ul>
                        <p class="text-xs mb-1"><strong>ê°œí†µ ì§„í–‰ ë° ìœ ì˜ì‚¬í•­:</strong></p>
                        <ul class="list-disc list-inside text-xs space-y-0.5 mb-2">
                            <li>ê³ ê°ì—ê²Œ ìœ„ì•½ê¸ˆ í™•ì¸ ë° ë™ì˜ ë¬¸ì ë°œì†¡ í›„ ì²˜ë¦¬. ë¯¸ë™ì˜ ì‹œ 10ë¶„ í›„ ê°•ì œ ë™ì˜ ì²˜ë¦¬ ê°€ëŠ¥.</li>
                            <li>USIM êµì²´ ë° ì „ì› ON ì„±ê³µ í›„ ì„ íƒì•½ì • ë° ìœ ë¬´ì„  ê²°í•© í•„ìˆ˜ (ì™„ë£Œ ì‹œ ê°œí†µ ì™„ë£Œ ì²˜ë¦¬).</li>
                            <li>ìœ ì‹¬ ê°œí†µ ìµœëŒ€ 4ì‹œê°„ ì†Œìš” ê°€ëŠ¥. ì‚¬ì „ ë™ì˜ ë¬¸ì ì²˜ë¦¬ ì‹œ ë¹ ë¥¸ ê°œí†µ.</li>
                            <li>KT USIM ê°œí†µ ì „ê¹Œì§€ ê¸°ì¡´ USIM ì‚¬ìš©, ì‹ í˜¸ ëŠê¸°ë©´ êµì²´. ê¸°ê¸° ìˆ˜íšŒ ì¬ì‹œë™ í•„ìš”.</li>
                        </ul>
                        <p class="text-xs mb-1"><strong>ë¹„ìš© ë° ìˆ˜ìˆ˜ë£Œ ì£¼ì˜ì‚¬í•­:</strong></p>
                        <ul class="list-disc list-inside text-xs space-y-0.5">
                            <li>ìœ ì‹¬ ë‹¹ì¼ ë°œì†¡ ë§ˆê° 15ì‹œ.</li>
                            <li>ìœ ì‹¬ ë¹„ìš© 7,700ì› / ë²ˆí˜¸ì´ë™ ìˆ˜ìˆ˜ë£Œ 800ì› ì²« ë‹¬ ì²­êµ¬.</li>
                            <li>ì¸í„°ë„·/ìœ ì‹¬ ì¤‘ í•˜ë‚˜ë¼ë„ ì„¤ì¹˜/ê°œí†µ ë¶ˆê°€ ì‹œ ìˆ˜ìˆ˜ë£Œ ì§€ê¸‰ ë¶ˆê°€.</li>
                            <li>ì¸í„°ë„· ê°œí†µì›” ê¸°ì¤€ ìµì›” ë§ê¹Œì§€ ìœ ì‹¬ ê°œí†µ ì‹œ ìˆ˜ìˆ˜ë£Œ ì¸ì •.</li>
                            <li>ì„ íƒì•½ì • ë¯¸ì ìš© ì‹œ ìˆ˜ìˆ˜ë£Œ ì§€ê¸‰ ë¶ˆê°€.</li>
                            <li>ì¸í„°ë„·/ìœ ì‹¬ ëª…ì˜ì ìƒì´í•´ë„ ìœ ì‹¬ ìˆ˜ìˆ˜ë£Œ ì§€ê¸‰ ê°€ëŠ¥.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="installationSection" class="mb-8">
            <h2 class="section-title">3. ì„¤ì¹˜ ì˜µì…˜</h2>
            <div class="input-group bg-white p-6 rounded-lg shadow">
                <label class="input-label">ì„¤ì¹˜ í¬ë§ ì‹œì  (ì„¤ì¹˜ë¹„ ë³€ë™)</label>
                <div class="space-y-2">
                    <label class="radio-label"><input type="radio" name="installationTime" value="weekday" class="radio-input" checked> í‰ì¼ ì£¼ê°„</label>
                    <label class="radio-label"><input type="radio" name="installationTime" value="weekend" class="radio-input"> ì£¼ë§/ì•¼ê°„ (í• ì¦ ì ìš©)</label>
                </div>
            </div>
        </section>

        <section id="affiliateCardSection" class="mb-8">
            <h2 class="section-title">4. ì œíœ´ì¹´ë“œ ì¶”ê°€ í• ì¸ (ì„ íƒ ì‚¬í•­)</h2>
            <div class="input-group bg-white p-6 rounded-lg shadow">
                <label for="affiliateCard" class="input-label">ì œíœ´ì¹´ë“œ ì„ íƒ</label>
                <select id="affiliateCard" class="select-field">
                    <option value="none">í• ì¸ ë¯¸ì ìš©</option>
                    <option value="hyundai">í˜„ëŒ€ì¹´ë“œM Ed3</option>
                    <option value="bc">BCë°”ë¡œì¹´ë“œ</option>
                    <option value="ibk">IBKì¹´ë“œ</option>
                    <option value="kb">KBêµ­ë¯¼ì¹´ë“œ</option>
                    <option value="samsung">ì‚¼ì„±ì¹´ë“œ</option>
                    <option value="lotte">ë¡¯ë°ì¹´ë“œ</option>
                    <option value="shinhan">ì‹ í•œì¹´ë“œ</option>
                </select>
                
                <div id="cardTierContainer" class="mt-4 hidden">
                    <label class="input-label">ì „ì›” ì‹¤ì  êµ¬ê°„ ì„ íƒ</label>
                    <div id="cardTiers" class="space-y-2">
                    </div>
                </div>
            </div>
        </section>
        <div class="text-center mb-8 flex justify-center items-center">
            <button id="calculateButton" class="btn-primary text-lg">ì˜ˆìƒ ìš”ê¸ˆ ê³„ì‚°í•˜ê¸°</button>
            <button id="resetButton" class="btn-secondary text-lg ml-4">ì´ˆê¸°í™”</button>
        </div>

        <section id="resultSection" class="hidden">
            <h2 class="section-title">ğŸ“Š ê³„ì‚° ê²°ê³¼</h2>
            
            <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-4">âœ… ìµœì¢… ìš”ê¸ˆ ë° í˜œíƒ ìš”ì•½</h3>
                <div class="grid grid-cols-2 gap-6 text-center">
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <p class="text-sm text-slate-600">ğŸ–¥ï¸ ì¸í„°ë„·/TV ì›” ìµœì¢… ìš”ê¸ˆ</p>
                        <p id="summaryPreDiscountCost" class="text-sm text-slate-500" style="display: none;"></p>
                        <p id="summaryFinalCost" class="text-3xl font-bold text-red-600 my-2">0 ì›</p>
                        <p id="summaryCardApplied" class="text-xs text-slate-500 h-4"></p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p class="text-sm text-slate-600">ğŸ ìµœëŒ€ í˜œíƒ ê¸ˆì•¡</p>
                        <p id="summaryGiftTotal" class="text-3xl font-bold text-green-700 my-2">0 ì›</p>
                        <p id="summaryGiftBreakdown" class="text-xs text-slate-500"></p>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <p class="text-sm text-slate-600">ğŸ“‰ ì¸í„°ë„· ìš”ê¸ˆ í• ì¸</p>
                        <p id="summaryInternetDiscount" class="text-xl font-bold text-sky-600 my-2">0 ì›</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p class="text-sm text-slate-600">ğŸ“± íœ´ëŒ€í° ìš”ê¸ˆ í• ì¸</p>
                        <p id="summaryMobileDiscount" class="text-xl font-bold text-green-700 my-2">0 ì›</p>
                    </div>
                </div>

                <div class="text-center mt-6">
                    <button id="toggleDetailsButton" class="text-sm text-slate-500 hover:text-sky-600 bg-slate-100 px-4 py-2 rounded-full">
                        ìƒì„¸ ìš”ê¸ˆ ë‚´ì—­ í¼ì³ë³´ê¸° â–¼
                    </button>
                </div>
            </div>

            <div id="expandedDetailsContainer" class="hidden">
                <div class="result-card">
                    <h3 class="text-2xl font-bold text-blue-700 mb-4">ğŸ“‹ ìƒì„¸ ìš”ê¸ˆ ë‚´ì—­</h3>
                    <div class="grid grid-cols-2 gap-x-4 gap-y-1 text-sm">
                        <p><strong>ì„ íƒ ì¸í„°ë„·:</strong> <span id="selectedInternet"></span></p>
                        <p><strong>ëª¨ë°”ì¼ íšŒì„  ìˆ˜:</strong> <span id="selectedMobileCount"></span></p>
                        <p><strong>ì„ íƒ TV (1ë²ˆì§¸):</strong> <span id="selectedTv"></span></p>
                        <p><strong>ì ìš© í• ì¸ ìœ í˜•:</strong> <span id="selectedDiscountType"></span></p>
                        <p><strong>ì„ íƒ ì¶”ê°€ TV (2ë²ˆì§¸):</strong> <span id="selectedAdditionalTv"></span></p>
                        <p><strong>ì„ íƒ ì§‘ì „í™”:</strong> <span id="selectedPhone"></span></p>
                        <p><strong>ì„ íƒ ì™€ì´íŒŒì´:</strong> <span id="selectedWifi"></span></p>
                        <div></div> <div class="col-span-2" id="selectedWifiDetails"></div> 
                    </div>
                </div>

                <div class="result-card">
                    <h3 class="text-lg font-semibold text-blue-700 mb-3">ğŸ–¥ï¸ ì¸í„°ë„·/TV ìš”ê¸ˆ ê³„ì‚° ê³¼ì •</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between"><span>ì›” ì¸í„°ë„· ê¸°ë³¸ë£Œ (ë‹¨ë…/TVê²°í•© ê¸°ì¤€)</span><span id="detailInternetBase">0 ì›</span></div>
                        <div class="flex justify-between"><span>ì›” ì™€ì´íŒŒì´ ê³µìœ ê¸° ì„ëŒ€ë£Œ</span><span id="detailWifiFee">0 ì›</span></div>
                        <div class="flex justify-between text-green-600"><span>ì›” ì´ ì¸í„°ë„· ê²°í•© í• ì¸ì•¡ (ì˜ˆìƒ)</span><span id="detailInternetDiscountTotal">0 ì›</span></div>
                        <hr class="my-2">
                        <div class="flex justify-between font-bold text-base"><span>ìµœì¢… ì˜ˆìƒ ì›” ë‚©ë¶€ì•¡ (í• ì¸ ì ìš©)</span><span id="detailFinalCost" class="text-red-600">0 ì›</span></div>
                        
                        <div id="detailCardDiscountContainer" class="hidden flex justify-between font-bold text-blue-600">
                            <span>ì œíœ´ì¹´ë“œ ì¶”ê°€ í• ì¸ (<span id="selectedCardName"></span>)</span>
                            <span id="detailCardDiscount">- 0 ì›</span>
                        </div>
                        <hr id="finalCardCostSeparator" class="my-2 hidden">
                        <div id="detailFinalCardCostContainer" class="hidden flex justify-between font-bold text-xl">
                            <span>âœ¨ ì¹´ë“œ ì ìš© ìµœì¢… ë‚©ë¶€ì•¡</span>
                            <span id="detailFinalCardCost" class="text-fuchsia-600">0 ì›</span>
                        </div>
                        </div>
                </div>

                <div class="result-card">
                    <h3 class="text-lg font-semibold text-blue-700 mb-3">ğŸ“± ëª¨ë°”ì¼ ìš”ê¸ˆ í• ì¸ ìƒì„¸</h3>
                    <div id="mobileDiscountDetailContainer" class="p-3 bg-blue-50 rounded-md text-sm">
                        <p>ê²°í•© ìœ í˜•ì— ë”°ë¥¸ ëª¨ë°”ì¼ í• ì¸ ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>

                <div class="result-card">
                    <h3 class="text-lg font-semibold text-blue-700 mb-3">ğŸ ì‚¬ì€í’ˆ í˜œíƒ ìƒì„¸</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between"><span>ê¸°ë³¸ ì‚¬ì€í’ˆ (í˜„ê¸ˆ)</span><span id="giftCash">0 ì›</span></div>
                        <div class="flex justify-between"><span>ê¸°ë³¸ ì‚¬ì€í’ˆ (ìƒí’ˆê¶Œ)</span><span id="giftVoucher">0 ì›</span></div>
                        <div class="flex justify-between"><span>ì¼ë°˜ì „í™” ì¶”ê°€ ìƒí’ˆê¶Œ</span><span id="giftPhoneVoucher">0 ì›</span></div>
                        <div class="flex justify-between"><span>ì¶”ê°€ TV ì‚¬ì€í’ˆ (í˜„ê¸ˆ)</span><span id="giftAdditionalTv">0 ì›</span></div>
                        <div id="dongpanCashContainerKt" class="flex justify-between hidden"><span>ë™íŒ ì¶”ê°€ í˜„ê¸ˆ ì‚¬ì€í’ˆ (KT)</span><span id="giftDongpanAdditionalCashKt">0 ì›</span></div>
                        <hr class="my-1 border-dashed">
                        <div class="flex justify-between text-blue-600"><span>âœ¨ í›„ê¸° ì´ë²¤íŠ¸ í˜œíƒ (ìµœëŒ€)</span><span id="giftReviewEvent">+ 40,000 ì›</span></div>
                        <div class="flex justify-between text-blue-600"><span>ğŸ¤ ì§€ì¸ ì¶”ì²œ í˜œíƒ (ìµœëŒ€)</span><span id="giftReferralEvent">+ 30,000 ì›</span></div>
                        <hr class="my-2">
                        <div class="flex justify-between font-bold text-base"><span>ì´ ìµœëŒ€ í˜œíƒ ê°€ì¹˜ (ì˜ˆìƒ)</span><span id="giftTotal" class="text-green-700">0 ì›</span></div>
                    </div>
                </div>
            </div>
            
            <section id="installationFeeSection" class="hidden">
                 <div class="result-card">
                    <h3 class="text-lg font-semibold text-blue-700 mb-3">âš™ï¸ ì„¤ì¹˜ë¹„ (ì²« ë‹¬ 1íšŒ ì²­êµ¬)</h3>
                    <div class="text-center">
                        <p id="installationFeeResult" class="text-2xl font-bold text-slate-800 my-2">0 ì›</p>
                        <p id="installationFeeDescription" class="text-sm text-slate-500"></p>
                    </div>
                </div>
            </section>
        </section>

        <section id="messageScriptSection" class="hidden mt-12">
            <h2 class="section-title">ğŸ“„ ê³ ê° ì•ˆë‚´ ë¬¸ì ìŠ¤í¬ë¦½íŠ¸ (ìƒë‹´ì› ì°¸ê³ ìš©)</h2>
            <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-3">1. ë°±ë©”ê°€ ì „ì‚° ë©”ëª¨</h3>
                <textarea id="memoScript" class="message-script-area" readonly></textarea>
                <div class="copy-button-container">
                    <button onclick="copyToClipboard('memoScript', 'copyFeedbackMemo')" class="btn-secondary text-xs">ë³µì‚¬í•˜ê¸°</button>
                    <span id="copyFeedbackMemo" class="copy-feedback"></span>
                </div>
            </div>
            <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-3">2. ìƒí’ˆ ì•ˆë‚´ ë¬¸ì</h3>
                <div class="mb-3 text-right">
                    <button id="generateComparisonButton" class="btn-primary text-xs py-1 px-3">âš¡ 100M vs 500M ë¹„êµ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±</button>
                </div>
                <textarea id="infoScript" class="message-script-area" readonly></textarea>
                <div class="copy-button-container">
                    <button onclick="copyToClipboard('infoScript', 'copyFeedbackInfo')" class="btn-secondary text-xs">ë³µì‚¬í•˜ê¸°</button>
                    <span id="copyFeedbackInfo" class="copy-feedback"></span>
                </div>
            </div>
            <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-3">3. ê°€ì… ì™„ë£Œ ë¬¸ì</h3>
                <textarea id="completeScript" class="message-script-area" readonly></textarea>
                <div class="copy-button-container">
                    <button onclick="copyToClipboard('completeScript', 'copyFeedbackComplete')" class="btn-secondary text-xs">ë³µì‚¬í•˜ê¸°</button>
                    <span id="copyFeedbackComplete" class="copy-feedback"></span>
                </div>
            </div>
            <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-3">4. [ë¯¸ì†Œ] ìœ ì‹¬ ì ‘ìˆ˜ ì™„ë£Œ ì•ˆë‚´</h3>
                <textarea id="usimCompleteScript" class="message-script-area" readonly></textarea>
                <div class="copy-button-container">
                    <button onclick="copyToClipboard('usimCompleteScript', 'copyFeedbackUsimComplete')" class="btn-secondary text-xs">ë³µì‚¬í•˜ê¸°</button>
                    <span id="copyFeedbackUsimComplete" class="copy-feedback"></span>
                </div>
            </div>
            <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-3">5. ë¯¼ê°ì •ë³´ ì „ì†¡ìš© ë§í¬ (ê³ ê° ë°œì†¡ìš©)</h3>
                <textarea id="sensitiveInfoLinkScript" class="message-script-area" readonly></textarea>
                <div class="copy-button-container">
                    <button onclick="copyToClipboard('sensitiveInfoLinkScript', 'copyFeedbackSensitiveInfo')" class="btn-secondary text-xs">ë³µì‚¬í•˜ê¸°</button>
                    <span id="copyFeedbackSensitiveInfo" class="copy-feedback"></span>
                </div>
            </div>
            
            <div id="geminiScriptCard" class="result-card hidden">
                <h3 class="text-xl font-semibold text-sky-600 mb-3 flex items-center">
                    <span class="text-2xl mr-2">âœ¨</span> AI ë§ì¶¤ ì„¤ë“/í•´í”¼ì½œ ë¬¸ì (Beta)
                </h3>
                <p class="text-sm text-slate-600 mb-4">ê³„ì‚°ëœ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ê³ ê°ì—ê²Œ ë³´ë‚¼ ë§ì¶¤í˜• ì„¤ë“ ë©”ì‹œì§€ë‚˜ ì„¤ì¹˜ í›„ í•´í”¼ì½œ ë¬¸ìë¥¼ AIê°€ ìƒì„±í•©ë‹ˆë‹¤.</p>
                
                <div class="flex items-center space-x-4 mb-4">
                    <button id="generateAIPersuasionBtn" class="btn-primary text-sm flex-1">âœ¨ AIë¡œ ê³ ê° ë§ì¶¤ ì„¤ë“ ë¬¸ì ìƒì„±</button>
                    <button id="generateAIHappyCallBtn" class="btn-secondary text-sm flex-1">ğŸ˜Š AIë¡œ ì„¤ì¹˜ í›„ í•´í”¼ì½œ ë¬¸ì ìƒì„±</button>
                </div>

                <div id="geminiLoading" class="hidden text-center p-4">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-sky-500"></div>
                    <p class="text-slate-500 mt-2">AIê°€ ê³ ê°ë‹˜ì„ ìœ„í•œ ìµœê³ ì˜ ë¬¸ìë¥¼ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤...</p>
                </div>

                <div id="geminiResultContainer" class="hidden">
                    <textarea id="geminiResultTextarea" class="message-script-area" readonly></textarea>
                    <div class="copy-button-container">
                        <button onclick="copyToClipboard('geminiResultTextarea', 'copyFeedbackGemini')" class="btn-secondary text-xs">ë³µì‚¬í•˜ê¸°</button>
                        <span id="copyFeedbackGemini" class="copy-feedback"></span>
                    </div>
                </div>
            </div>
            
            <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-3">6. (ê³ ê° ì„¤ë“ìš©) 1ë…„ vs 3ë…„ ì•½ì • ìµœì¢… ë¹„ìš© ë¹„êµ</h3>
                <textarea id="tcoComparisonScript" class="message-script-area" readonly></textarea>
                <div class="copy-button-container">
                    <button onclick="copyToClipboard('tcoComparisonScript', 'copyFeedbackTco')" class="btn-secondary text-xs">ë³µì‚¬í•˜ê¸°</button>
                    <span id="copyFeedbackTco" class="copy-feedback"></span>
                </div>
            </div>
            <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-3">7. (ì „ë¬¸ê°€ìš©) KT ìœ„ì•½ê¸ˆ ì‚°ì • ë°©ì‹ ìƒì„¸ ë¶„ì„</h3>
                <textarea id="penaltyAnalysisScript" class="message-script-area" readonly></textarea>
                <div class="copy-button-container">
                    <button onclick="copyToClipboard('penaltyAnalysisScript', 'copyFeedbackPenalty')" class="btn-secondary text-xs">ë³µì‚¬í•˜ê¸°</button>
                    <span id="copyFeedbackPenalty" class="copy-feedback"></span>
                </div>
            </div>
            <div class="result-card">
                <h3 class="text-xl font-semibold text-sky-600 mb-3">8. (ìƒì„¸ ì•ˆë‚´) ìœ„ì•½ê¸ˆ ë©´ì œ ì¡°ê±´ ì´ì •ë¦¬</h3>
                <textarea id="penaltyWaiverScript" class="message-script-area" readonly></textarea>
                <div class="copy-button-container">
                    <button onclick="copyToClipboard('penaltyWaiverScript', 'copyFeedbackWaiver')" class="btn-secondary text-xs">ë³µì‚¬í•˜ê¸°</button>
                    <span id="copyFeedbackWaiver" class="copy-feedback"></span>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-center p-6 mt-12 bg-sky-800 text-sky-200 text-sm">
        <p>ë³¸ ê³„ì‚°ê¸°ëŠ” KT ë¯¸ì†Œì—ì„œ ì œê³µí•©ë‹ˆë‹¤.</p>
        <p>&copy; 2024 KT ê²°í•© í• ì¸ ê³„ì‚°ê¸°. ëª¨ë“  ì •ë³´ëŠ” ì°¸ê³ ìš©ì…ë‹ˆë‹¤.</p>
    </footer>

    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script> 
    <script>
        // script.js (2025-07-13 ìµœì¢… ìˆ˜ì •ë³¸)
        const internetPlans_KT = {
            "KTì¸í„°ë„·(ë‹¨ë…) 100mb": { basePrice: 22000, speed: 100, type: "100M" },
            "KTì¸í„°ë„·(ë‹¨ë…) 500mb": { basePrice: 33000, speed: 500, type: "500M" },
            "KTì¸í„°ë„·(ë‹¨ë…) 1GB": { basePrice: 38500, speed: 1000, type: "1G" },
            "KTì¸í„°ë„·ë²ˆë“¤100mb": { basePrice: 22000, speed: 100, type: "100M" },
            "KTì¸í„°ë„·ë²ˆë“¤500mb": { basePrice: 27500, speed: 500, type: "500M" },
            "KTì¸í„°ë„·ë²ˆë“¤1GB": { basePrice: 33000, speed: 1000, type: "1G" }
        };
        
        const tvPlans_KT = {
            "KTTVë² ì´ì§": { basePrice: 15400, category: "ë² ì´ì§", stbIncluded: "ê¸°ê°€ì§€ë‹ˆA" },
            "KTTVë¼ì´íŠ¸": { basePrice: 16500, category: "ë¼ì´íŠ¸", stbIncluded: "ê¸°ê°€ì§€ë‹ˆA" },
            "KTTVì—ì„¼ìŠ¤": { basePrice: 19800, category: "ì—ì„¼ìŠ¤", stbIncluded: "ê¸°ê°€ì§€ë‹ˆA" },
            "KTTVì—ì„¼ìŠ¤ í”ŒëŸ¬ìŠ¤": { basePrice: 24200, category: "ì—ì„¼ìŠ¤ í”ŒëŸ¬ìŠ¤", stbIncluded: "ê¸°ê°€ì§€ë‹ˆA" },
            "KTTVë„·í”Œë¦­ìŠ¤ HD": { basePrice: 31100, category: "ë„·í”Œë¦­ìŠ¤ HD", stbIncluded: "ê¸°ê°€ì§€ë‹ˆA" },
            "KTTVë„·í”Œë¦­ìŠ¤ UHD": { basePrice: 34600, category: "ë„·í”Œë¦­ìŠ¤ UHD", stbIncluded: "ê¸°ê°€ì§€ë‹ˆA" },
            "KTTVí‚¤ì¦ˆëœë“œíŒ©ì´ˆì´ìŠ¤": { basePrice: 20900, category: "í‚¤ì¦ˆëœë“œ", stbIncluded: "ê¸°ê°€ì§€ë‹ˆA" }
        };
        
        const additionalTvPlans_KT = {
            "none": { basePrice: 0, name: "ì„ íƒ ì•ˆí•¨" },
            "KTTV ì¶”ê°€ë² ì´ì§": { basePrice: 10670, name: "ë² ì´ì§ (236ì±„ë„) + ê¸°ê°€ì§€ë‹ˆA" },
            "KTTV ì¶”ê°€ë¼ì´íŠ¸": { basePrice: 11220, name: "ë¼ì´íŠ¸ (240ì±„ë„) + ê¸°ê°€ì§€ë‹ˆA" },
            "KTTV ì¶”ê°€ì—ì„¼ìŠ¤": { basePrice: 13420, name: "ì—ì„¼ìŠ¤ (266ì±„ë„) + ê¸°ê°€ì§€ë‹ˆA" }
        };
        
        const phonePlans_KT = {
            "ì¸í„°ë„·ì „í™” ìš°ë¦¬ë¼ë¦¬3000": { basePrice: 6294 },
            "ì§‘ì „í™” ìœ ì„ 3000": { basePrice: 8494 },
            "ì§‘ì „í™” ìœ ë¬´ì„ 3000": { basePrice: 8250 }
        };
        
        const wifiOptions_KT = {
            "KTê³µìœ ê¸°": { fee: 1100, name: "KTê³µìœ ê¸°", url: null, promotion: null },
            "GiGA WiFi home ax": { fee: 0, name: "GiGA WiFi home ax", url: "https://product.kt.com/wDic/productDetail.do?ItemCode=1401", promotion: "'ë² ì´ì§(500Mbps)' ìš”ê¸ˆì œ ì‹ ê·œ ê°€ì… ì‹œ ë¬´ë£Œ ì œê³µ" },
            "KT WiFi 7D": { fee: 0, name: "KT WiFi 7D", url: "https://product.kt.com/wDic/productDetail.do?ItemCode=1633", promotion: "'ì—ì„¼ìŠ¤(1Gbps)' ì´ìƒ ìš”ê¸ˆì œ ì‹ ê·œ ê°€ì… ì‹œ ë¬´ë£Œ ì œê³µ (25ë…„ 8/31ê¹Œì§€, ì„ ì°©ìˆœ 5ë§Œëª…)" },
            "KTê³µìœ ê¸° X": { fee: 0, name: "KTê³µìœ ê¸° X (ë¯¸ì‚¬ìš©)", url: null, promotion: null }
        };
        
        
        const ktAddonServices = {
            "ê¸°ê°€ì§€ë‹ˆ3A": { price: 1100, name: "ê¸°ê°€ì§€ë‹ˆ3A (AI ì…‹í†±ë°•ìŠ¤)"},
            "AI ì§€ë‹ˆ TV ì˜¬ì¸ì› ì‚¬ìš´ë“œë°”": { price: 5500, name: "AI ì§€ë‹ˆ TV ì˜¬ì¸ì› ì‚¬ìš´ë“œë°”"},
            "ë²„ë””ì¦í­ê¸°": { price: 1650, name: "ë²„ë””ì¦í­ê¸°"},
            "ê¸°ê°€ì§€ë‹ˆ 4A": { price: 3300, name: "ê¸°ê°€ì§€ë‹ˆ 4A"}
        };
        
        // â–¼â–¼â–¼ NEW DATA ADDED â–¼â–¼â–¼
        const affiliateCardDiscounts = {
            "hyundai": {
                name: "í˜„ëŒ€ì¹´ë“œM Ed3",
                phone: "1577-6000",
                tiers: [
                    { usage: 1000000, discount: 22000, label: "100ë§Œì› ì´ìƒ ì‚¬ìš©" },
                    { usage: 1500000, discount: 40000, label: "150ë§Œì› ì´ìƒ ì‚¬ìš©" }
                ]
            },
            "bc": {
                name: "BCë°”ë¡œì¹´ë“œ",
                phone: "1588-4000",
                tiers: [
                    { usage: 300000, discount: 7000, label: "30ë§Œì› ì´ìƒ ì‚¬ìš©" },
                    { usage: 700000, discount: 13000, label: "70ë§Œì› ì´ìƒ ì‚¬ìš©" }
                ]
            },
            "ibk": {
                name: "IBKì¹´ë“œ",
                phone: "1566-2566",
                tiers: [
                    { usage: 300000, discount: 7000, label: "30ë§Œì› ì´ìƒ ì‚¬ìš©" },
                    { usage: 700000, discount: 15000, label: "70ë§Œì› ì´ìƒ ì‚¬ìš©" }
                ]
            },
            "kb": {
                name: "KBêµ­ë¯¼ì¹´ë“œ",
                phone: "1588-1688",
                tiers: [
                    { usage: 300000, discount: 7000, label: "30ë§Œì› ì´ìƒ ì‚¬ìš©" },
                    { usage: 700000, discount: 11000, label: "70ë§Œì› ì´ìƒ ì‚¬ìš©" }
                ]
            },
            "samsung": {
                name: "ì‚¼ì„±ì¹´ë“œ",
                phone: "1588-8700",
                tiers: [
                    { usage: 300000, discount: 7000, label: "30ë§Œì› ì´ìƒ ì‚¬ìš©" },
                    { usage: 700000, discount: 16000, label: "70ë§Œì› ì´ìƒ ì‚¬ìš©" }
                ]
            },
            "lotte": {
                name: "ë¡¯ë°ì¹´ë“œ",
                phone: "1588-8100",
                tiers: [
                    { usage: 300000, discount: 10000, label: "30ë§Œì› ì´ìƒ ì‚¬ìš©" },
                    { usage: 700000, discount: 15000, label: "70ë§Œì› ì´ìƒ ì‚¬ìš©" },
                    { usage: 1200000, discount: 20000, label: "120ë§Œì› ì´ìƒ ì‚¬ìš©" }
                ]
            },
            "shinhan": {
                name: "ì‹ í•œì¹´ë“œ",
                phone: "1544-7000",
                tiers: [
                    { usage: 300000, discount: 7000, label: "30ë§Œì› ì´ìƒ ì‚¬ìš©" },
                    { usage: 700000, discount: 15000, label: "70ë§Œì› ì´ìƒ ì‚¬ìš©" }
                ]
            }
        };
        // â–²â–²â–² NEW DATA ADDED â–²â–²â–²

        const mobilePlans_KT = [
            { "category": "90K", "name": "ë””ì¦ˆë‹ˆ+ ì´ˆì´ìŠ¤ ìŠ¤í˜ì…œ", "network": "5G", "price": 110000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1470" },
            { "category": "90K", "name": "(ìœ íŠœë¸Œ í”„ë¦¬ë¯¸ì—„) ì´ˆì´ìŠ¤ ìŠ¤í˜ì…œ", "network": "5G", "price": 110000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1499" },
            { "category": "90K", "name": "ë„·í”Œë¦­ìŠ¤ ì´ˆì´ìŠ¤ ìŠ¤í˜ì…œ", "network": "5G", "price": 110000, "url": "https://product.kt.com/wDic/simple/mNetflixMain.do" },
            { "category": "90K", "name": "í‹°ë¹™/ì§€ë‹ˆ/ë°€ë¦¬ ì´ˆì´ìŠ¤ ìŠ¤í˜ì…œ", "network": "5G", "price": 110000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1601" },
            { "category": "90K", "name": "ë„·í”Œë¦­ìŠ¤ ì´ˆì´ìŠ¤ ë² ì´ì§", "network": "5G", "price": 90000, "url": "https://product.kt.com/wDic/simple/mNetflixMain.do" },
            { "category": "90K", "name": "í‹°ë¹™/ì§€ë‹ˆ/ë°€ë¦¬ ì´ˆì´ìŠ¤ ë² ì´ì§", "network": "5G", "price": 90000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1601" },
            { "category": "90K", "name": "ë””ì¦ˆë‹ˆ+ ì´ˆì´ìŠ¤ ë² ì´ì§", "network": "5G", "price": 90000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1470" },
            { "category": "90K", "name": "(ìœ íŠœë¸Œ í”„ë¦¬ë¯¸ì—„) ì´ˆì´ìŠ¤ ë² ì´ì§", "network": "5G", "price": 90000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1499" },
            { "category": "61K", "name": "ë°ì´í„°ON í”„ë¦¬ë¯¸ì—„", "network": "LTE", "price": 89000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1248" },
            { "category": "61K", "name": "ë² ì´ì§", "network": "5G", "price": 80000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1283" },
            { "category": "61K", "name": "5G ì‹¬í”Œ 110GB", "network": "5G", "price": 69000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1406&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "61K", "name": "ë°ì´í„°ON ë¹„ë””ì˜¤ í”ŒëŸ¬ìŠ¤", "network": "LTE", "price": 69000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1248" },
            { "category": "61K", "name": "5G ì‹¬í”Œ 90GB", "network": "5G", "price": 67000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1406&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "61K", "name": "5G ì‹¬í”Œ 70GB", "network": "5G", "price": 65000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1406&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "61K", "name": "5G ì‹¬í”Œ 50GB", "network": "5G", "price": 63000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1406&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "61K", "name": "5G ì‹¬í”Œ 30GB", "network": "5G", "price": 61000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1406&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ìŠ¬ë¦¼ 21GB", "network": "5G", "price": 58000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1284&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ìŠ¬ë¦¼ 21GB (ì´ì›”)", "network": "5G", "price": 58000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1284&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ìŠ¬ë¦¼ 14GB", "network": "5G", "price": 55000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1284&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ìŠ¬ë¦¼ 14GB (ì´ì›”)", "network": "5G", "price": 55000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1284&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ìŠ¬ë¦¼ 10GB", "network": "5G", "price": 50000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1284&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ìŠ¬ë¦¼ 10GB (ì´ì›”)", "network": "5G", "price": 50000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1284&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ì‹œë‹ˆì–´ ë² ì´ì§", "network": "5G", "price": 49000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1558&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ìŠ¬ë¦¼ 7GB", "network": "5G", "price": 45000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1284&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ìŠ¬ë¦¼ 7GB (ì´ì›”)", "network": "5G", "price": 45000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1284&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ì‹œë‹ˆì–´ Aí˜•", "network": "5G", "price": 44000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1558&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ì‹œë‹ˆì–´ Bí˜•", "network": "5G", "price": 42000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1558&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ì‹œë‹ˆì–´ Cí˜•", "network": "5G", "price": 41000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1558&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ìŠ¬ë¦¼ 5GB", "network": "5G", "price": 37000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1284&CateCode=6002&filter_code=81&option_code=109&pageSize=10" },
            { "category": "37K", "name": "5G ìŠ¬ë¦¼ 4GB (ì´ì›”)", "network": "5G", "price": 37000, "url": "https://product.kt.com/wDic/productDetail.do?ItemCode=1284&CateCode=6002&filter_code=81&option_code=109&pageSize=10" }
        ].sort((a, b) => b.price - a.price);
        
        
        const newKtDiscountRules = {
            "ì´ì•¡ê²°í•©í• ì¸": {
                "100M": {
                    "ë‹¨ë…": {"ëª¨ë°”ì¼_22000ë¯¸ë§Œ": 1650, "ëª¨ë°”ì¼_64900ë¯¸ë§Œ": 3300, "ëª¨ë°”ì¼_64900ì´ìƒ": 5500},
                    "TV":   {"ëª¨ë°”ì¼_22000ë¯¸ë§Œ": 1650, "ëª¨ë°”ì¼_64900ë¯¸ë§Œ": 3300, "ëª¨ë°”ì¼_64900ì´ìƒ": 5500}
                },
                "500M": {
                    "ë‹¨ë…": {"ëª¨ë°”ì¼_22000ë¯¸ë§Œ": 7700, "ëª¨ë°”ì¼_22000ì´ìƒ": 11000},
                    "TV":   {"ëª¨ë°”ì¼_22000ë¯¸ë§Œ": 2200, "ëª¨ë°”ì¼_22000ì´ìƒ": 5500}
                },
                "1G": {
                    "ë‹¨ë…": {"ëª¨ë°”ì¼_22000ë¯¸ë§Œ": 7700, "ëª¨ë°”ì¼_22000ì´ìƒ": 11000},
                    "TV":   {"ëª¨ë°”ì¼_ê²°í•©ì‹œ": 5500}
                }
            },
            "í”„ë¦¬ë¯¸ì—„ê°€ì¡±ê²°í•©": {
                "500M_TV": 5500, "1G_TV": 5500,
                "500M_ë‹¨ë…": 5500, "1G_ë‹¨ë…": 11000
            },
            "í”„ë¦¬ë¯¸ì—„ì‹±ê¸€ê²°í•©": {
                "500M_ë‹¨ë…": 5500, "1G_ë‹¨ë…": 5500
            },
            "íŒ¨ë°€ë¦¬ê²°í•©": {
                "100M_TV": 5500, "100M_ë‹¨ë…": 5500,
                "500M_TV": 5500, "500M_ë‹¨ë…": 11000,
                "1G_TV": 5500,   "1G_ë‹¨ë…": 11000
            },
            "ì•Œëœ°í°ê²°í•©": {
                "100M_TV": 3300, "100M_ë‹¨ë…": 3300,
                "500M_TV": 5500, "500M_ë‹¨ë…": 11000,
                "1G_TV": 5500,   "1G_ë‹¨ë…": 11000
            }
        };
        
        const dongpanGiftRules_New = {
            "37K ìš”ê¸ˆì œ": {
                "100Mb ë‹¨ë… ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 150000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "100Mb ë‹¨ë… íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 150000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "500Mb ë‹¨ë… ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 160000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "500Mb ë‹¨ë… íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 160000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "1Gb ë‹¨ë… ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 170000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "1Gb ë‹¨ë… íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 170000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "100Mb+TV ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 200000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 60000 },
                "100Mb+TV íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 200000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 60000 },
                "500Mb+TV ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 220000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 60000 },
                "500Mb+TV íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 220000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 60000 },
                "1Gb+TV ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 240000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 60000 },
                "1Gb+TV íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 240000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 60000 }
            },
            "61K ìš”ê¸ˆì œ": {
                "100Mb ë‹¨ë… ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 270000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "100Mb ë‹¨ë… íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 270000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "500Mb ë‹¨ë… ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 280000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "500Mb ë‹¨ë… íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 280000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "1Gb ë‹¨ë… ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 290000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "1Gb ë‹¨ë… íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 290000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "100Mb+TV ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 320000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 120000 },
                "100Mb+TV íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 320000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 120000 },
                "500Mb+TV ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 340000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 130000 },
                "500Mb+TV íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 340000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 120000 },
                "1Gb+TV ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 360000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 130000 },
                "1Gb+TV íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 360000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 120000 }
            },
            "90K ìš”ê¸ˆì œ": {
                "100Mb ë‹¨ë… ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 310000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "100Mb ë‹¨ë… íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 310000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "500Mb ë‹¨ë… ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 320000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "500Mb ë‹¨ë… íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 320000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "1Gb ë‹¨ë… ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 330000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "1Gb ë‹¨ë… íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 330000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": "ì œê³µ ë¶ˆê°€" },
                "100Mb+TV ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 360000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 130000 },
                "100Mb+TV íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 360000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 130000 },
                "500Mb+TV ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 380000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 140000 },
                "500Mb+TV íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 380000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 130000 },
                "1Gb+TV ì¼ë°˜": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 400000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 140000 },
                "1Gb+TV íŒ¨ë°€ë¦¬": { "ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ": { "ìœ ì‹¬": 400000 }, "ê°€ì¡± ì‚¬ì€í’ˆ": 130000 }
            }
        };
        
        const ktInstallationFees_new = {
            "í‰ì¼": {
                "ì¸í„°ë„·": 36000,
                "ì¸í„°ë„·+TV": 56200,
                "ì¸í„°ë„·+ì¼ë°˜ì „í™”": 68000,
                "ì¸í„°ë„·+070ì „í™”": 60000,
                "ì¸í„°ë„·+TV+ì¼ë°˜ì „í™”": 88200,
                "ì¸í„°ë„·+TV+070ì „í™”": 80200,
                "ì¸í„°ë„·+TV+TVì¶”ê°€": 71600
            },
            "ì£¼ë§": {
                "ì¸í„°ë„·": 45000,
                "ì¸í„°ë„·+ì¼ë°˜ì „í™”": 86000,
                "ì¸í„°ë„·+070ì „í™”": 78000,
                "ì¸í„°ë„·+TV": 71250,
                "ì¸í„°ë„·+TV+ì¼ë°˜ì „í™”": 112250,
                "ì¸í„°ë„·+TV+070ì „í™”": 104250,
                "ì¸í„°ë„·+TV+TVì¶”ê°€": 90500
            }
        };
        
        
        const giftTable = {
            "ë² ì´ì§": {
                "100ë‹¨ë…": { cash: 50000, voucher: 40000 }, "500ë‹¨ë…": { cash: 100000, voucher: 40000 }, "1Gë‹¨ë…": { cash: 90000, voucher: 50000 },
                "100ë²ˆë“¤": { cash: 310000, voucher: 60000 }, "500ë²ˆë“¤": { cash: 390000, voucher: 60000 }, "ê¸°ê°€ë²ˆë“¤": { cash: 360000, voucher: 90000 }
            },
            "ë¼ì´íŠ¸": {
                "100ë‹¨ë…": { cash: 50000, voucher: 40000 }, "500ë‹¨ë…": { cash: 100000, voucher: 40000 }, "1Gë‹¨ë…": { cash: 90000, voucher: 50000 },
                "100ë²ˆë“¤": { cash: 310000, voucher: 60000 }, "500ë²ˆë“¤": { cash: 380000, voucher: 70000 }, "ê¸°ê°€ë²ˆë“¤": { cash: 350000, voucher: 100000 }
            },
            "ì—ì„¼ìŠ¤": {
                "100ë‹¨ë…": { cash: 50000, voucher: 40000 }, "500ë‹¨ë…": { cash: 100000, voucher: 40000 }, "1Gë‹¨ë…": { cash: 90000, voucher: 50000 },
                "100ë²ˆë“¤": { cash: 310000, voucher: 60000 }, "500ë²ˆë“¤": { cash: 420000, voucher: 30000 }, "ê¸°ê°€ë²ˆë“¤": { cash: 320000, voucher: 30000 }
            },
            "ì—ì„¼ìŠ¤ í”ŒëŸ¬ìŠ¤": {
                "100ë‹¨ë…": { cash: 50000, voucher: 40000 }, "500ë‹¨ë…": { cash: 100000, voucher: 40000 }, "1Gë‹¨ë…": { cash: 90000, voucher: 50000 },
                "100ë²ˆë“¤": { cash: 310000, voucher: 60000 }, "500ë²ˆë“¤": { cash: 420000, voucher: 30000 }, "ê¸°ê°€ë²ˆë“¤": { cash: 320000, voucher: 30000 }
            },
            "ë„·í”Œë¦­ìŠ¤ HD": {
                "100ë‹¨ë…": { cash: 50000, voucher: 40000 }, "500ë‹¨ë…": { cash: 100000, voucher: 40000 }, "1Gë‹¨ë…": { cash: 90000, voucher: 50000 },
                "100ë²ˆë“¤": { cash: 310000, voucher: 60000 }, "500ë²ˆë“¤": { cash: 390000, voucher: 60000 }, "ê¸°ê°€ë²ˆë“¤": { cash: 360000, voucher: 90000 }
            },
            "ë„·í”Œë¦­ìŠ¤ UHD": {
                "100ë‹¨ë…": { cash: 50000, voucher: 40000 }, "500ë‹¨ë…": { cash: 100000, voucher: 40000 }, "1Gë‹¨ë…": { cash: 90000, voucher: 50000 },
                "100ë²ˆë“¤": { cash: 310000, voucher: 60000 }, "500ë²ˆë“¤": { cash: 390000, voucher: 60000 }, "ê¸°ê°€ë²ˆë“¤": { cash: 360000, voucher: 90000 }
            },
            "í‚¤ì¦ˆëœë“œ": {
                "100ë‹¨ë…": { cash: 50000, voucher: 40000 }, "500ë‹¨ë…": { cash: 100000, voucher: 40000 }, "1Gë‹¨ë…": { cash: 90000, voucher: 50000 },
                "100ë²ˆë“¤": { cash: 310000, voucher: 60000 }, "500ë²ˆë“¤": { cash: 390000, voucher: 60000 }, "ê¸°ê°€ë²ˆë“¤": { cash: 360000, voucher: 90000 }
            }
        };
        
        // [ìš”ì²­ 1] ì´ì•¡ê²°í•©í• ì¸ ê·œì¹™ JSON ë°˜ì˜
        const kt_total_mobile_fee_discounts = {
            "100M": {
                "tier1_under_22000": { "internet_discount": 1650, "mobile_discount": 0, "total_discount": 1650 },
                "tier2_22000_to_64899": { "internet_discount": 3300, "mobile_discount": 0, "total_discount": 3300 },
                "tier3_64900_to_108899": { "internet_discount": 5500, "mobile_discount": 3300, "total_discount": 8800 },
                "tier4_108900_to_141899": { "internet_discount": 5500, "mobile_discount": 14300, "total_discount": 19800 },
                "tier5_141900_to_174899": { "internet_discount": 5500, "mobile_discount": 18700, "total_discount": 24200 },
                "tier6_over_174900": { "internet_discount": 5500, "mobile_discount": 23100, "total_discount": 28600 }
            },
            "500M_1G": {
                "tier1_under_22000": { "internet_discount": 2200, "mobile_discount": 0, "total_discount": 2200 },
                "tier2_22000_to_64899": { "internet_discount": 5500, "mobile_discount": 0, "total_discount": 5500 },
                "tier3_64900_to_108899": { "internet_discount": 5500, "mobile_discount": 5500, "total_discount": 11000 },
                "tier4_108900_to_141899": { "internet_discount": 5500, "mobile_discount": 16610, "total_discount": 22110 },
                "tier5_141900_to_174899": { "internet_discount": 5500, "mobile_discount": 22100, "total_discount": 27610 },
                "tier6_over_174900": { "internet_discount": 5500, "mobile_discount": 27610, "total_discount": 33110 }
            }
        };
        
        
        // ------------------- DOM Element Selectors -------------------
        const internetPlanEl = document.getElementById('internetPlan');
        const wifiRouterRentalEl = document.getElementById('wifiRouterRental');
        const tvPlanEl = document.getElementById('tvPlan');
        const additionalTvPlanEl = document.getElementById('additionalTvPlan');
        const phonePlanEl = document.getElementById('phonePlan');
        const addonServicesContainerEl = document.getElementById('addonServicesContainer');
        const mobileLinesCountEl = document.getElementById('mobileLinesCount');
        const mobileLinesContainerEl = document.getElementById('mobileLinesContainer');
        const dongpanSalesCheckKtEl = document.getElementById('dongpanSalesCheckKt');
        const dongpanPolicyDetailsContainerKtEl = document.getElementById('dongpanPolicyDetailsContainerKt');
        const discountTypeRadios = document.querySelectorAll('input[name="discountType"]');
        
        const totalAmountDetailsToggleEl = document.getElementById('totalAmountDetailsToggle');
        const totalAmountDetailsContainerEl = document.getElementById('totalAmountDetailsContainer');
        const detailInternetDiscountEl = document.getElementById('detailInternetDiscount');
        const detailMobileDiscountEl = document.getElementById('detailMobileDiscount');
        const detailTotalDiscountEl = document.getElementById('detailTotalDiscount');
        
        const premiumFamilyDetailsToggleEl = document.getElementById('premiumFamilyDetailsToggle');
        const premiumFamilyDetailsContainerEl = document.getElementById('premiumFamilyDetailsContainer');
        const detailPfInternetDiscountEl = document.getElementById('detailPfInternetDiscount');
        const detailPfMobileDiscountsContainerEl = document.getElementById('detailPfMobileDiscountsContainer');
        
        const premiumSingleDetailsToggleEl = document.getElementById('premiumSingleDetailsToggle');
        const premiumSingleDetailsContainerEl = document.getElementById('premiumSingleDetailsContainer');
        const detailPsInternetDiscountEl = document.getElementById('detailPsInternetDiscount');
        
        const familyBundleDetailsToggleEl = document.getElementById('familyBundleDetailsToggle');
        const familyBundleDetailsContainerEl = document.getElementById('familyBundleDetailsContainer');
        const detailFbInternetDiscountEl = document.getElementById('detailFbInternetDiscount');
        
        const separateFamilyDetailsToggleEl = document.getElementById('separateFamilyDetailsToggle');
        const separateFamilyDetailsContainerEl = document.getElementById('separateFamilyDetailsContainer');
        const detailSfInternetDiscountEl = document.getElementById('detailSfInternetDiscount');
        const detailSfTvDiscountEl = document.getElementById('detailSfTvDiscount');
        
        const mvnoDetailsToggleEl = document.getElementById('mvnoDetailsToggle');
        const mvnoDetailsContainerEl = document.getElementById('mvnoDetailsContainer');
        const detailMvnoInternetDiscountEl = document.getElementById('detailMvnoInternetDiscount');
        
        const calculateButton = document.getElementById('calculateButton');
        const resetButton = document.getElementById('resetButton');
        const resultSection = document.getElementById('resultSection');
        
        const toggleDetailsButton = document.getElementById('toggleDetailsButton');
        const expandedDetailsContainer = document.getElementById('expandedDetailsContainer');
        
        const summaryPreDiscountCostEl = document.getElementById('summaryPreDiscountCost');
        const summaryFinalCostEl = document.getElementById('summaryFinalCost');
        const summaryInternetDiscountEl = document.getElementById('summaryInternetDiscount');
        const summaryGiftTotalEl = document.getElementById('summaryGiftTotal');
        const summaryMobileDiscountEl = document.getElementById('summaryMobileDiscount');
        
        const selectedInternetEl = document.getElementById('selectedInternet');
        const selectedTvEl = document.getElementById('selectedTv');
        const selectedAdditionalTvEl = document.getElementById('selectedAdditionalTv');
        const selectedPhoneEl = document.getElementById('selectedPhone');
        const selectedWifiEl = document.getElementById('selectedWifi');
        const selectedMobileCountEl = document.getElementById('selectedMobileCount');
        const selectedDiscountTypeEl = document.getElementById('selectedDiscountType');
        const selectedWifiDetailsEl = document.getElementById('selectedWifiDetails');
        
        
        const detailInternetBaseEl = document.getElementById('detailInternetBase');
        const detailWifiFeeEl = document.getElementById('detailWifiFee');
        const detailInternetDiscountTotalEl = document.getElementById('detailInternetDiscountTotal');
        const detailFinalCostEl = document.getElementById('detailFinalCost');
        
        const giftCashEl = document.getElementById('giftCash');
        const giftVoucherEl = document.getElementById('giftVoucher');
        const giftPhoneVoucherEl = document.getElementById('giftPhoneVoucher');
        const giftAdditionalTvEl = document.getElementById('giftAdditionalTv');
        const dongpanCashContainerKtEl = document.getElementById('dongpanCashContainerKt');
        const giftDongpanAdditionalCashKtEl = document.getElementById('giftDongpanAdditionalCashKt');
        const giftTotalEl = document.getElementById('giftTotal');
        const mobileDiscountDetailContainerEl = document.getElementById('mobileDiscountDetailContainer');
        
        // --- New selectors for installation fee ---
        const installationFeeSectionEl = document.getElementById('installationFeeSection');
        const installationFeeResultEl = document.getElementById('installationFeeResult');
        const installationFeeDescriptionEl = document.getElementById('installationFeeDescription');
        
        // --- Message Script Selectors ---
        const messageScriptSectionEl = document.getElementById('messageScriptSection');
        const memoScriptEl = document.getElementById('memoScript');
        const infoScriptEl = document.getElementById('infoScript');
        const completeScriptEl = document.getElementById('completeScript');
        const sensitiveInfoLinkScriptEl = document.getElementById('sensitiveInfoLinkScript');
        const usimCompleteScriptEl = document.getElementById('usimCompleteScript');
        const tcoComparisonScriptEl = document.getElementById('tcoComparisonScript');
        const penaltyAnalysisScriptEl = document.getElementById('penaltyAnalysisScript');
        const penaltyWaiverScriptEl = document.getElementById('penaltyWaiverScript');
        
        // --- Gemini API related selectors ---
        const geminiScriptCardEl = document.getElementById('geminiScriptCard');
        const generateAIPersuasionBtn = document.getElementById('generateAIPersuasionBtn');
        const generateAIHappyCallBtn = document.getElementById('generateAIHappyCallBtn');
        const geminiLoadingEl = document.getElementById('geminiLoading');
        const geminiResultContainerEl = document.getElementById('geminiResultContainer');
        const geminiResultTextareaEl = document.getElementById('geminiResultTextarea');

        // âœ¨ New Button Selector
        const generateComparisonButtonEl = document.getElementById('generateComparisonButton');

        // â–¼â–¼â–¼ NEW SELECTORS ADDED â–¼â–¼â–¼
        const affiliateCardEl = document.getElementById('affiliateCard');
        const cardTierContainerEl = document.getElementById('cardTierContainer');
        const cardTiersEl = document.getElementById('cardTiers');
        const summaryCardAppliedEl = document.getElementById('summaryCardApplied');
        const detailCardDiscountContainerEl = document.getElementById('detailCardDiscountContainer');
        const selectedCardNameEl = document.getElementById('selectedCardName');
        const detailCardDiscountEl = document.getElementById('detailCardDiscount');
        const detailFinalCardCostContainerEl = document.getElementById('detailFinalCardCostContainer');
        const detailFinalCardCostEl = document.getElementById('detailFinalCardCost');
        const finalCardCostSeparatorEl = document.getElementById('finalCardCostSeparator');
        // â–²â–²â–² NEW SELECTORS ADDED â–²â–²â–²
        
        // ------------------- Event Listeners -------------------
        mobileLinesCountEl.addEventListener('input', updateMobileLinesInputs);
        calculateButton.addEventListener('click', calculateAndDisplayResults);
        resetButton.addEventListener('click', resetCalculator); 

        // â–¼â–¼â–¼ NEW EVENT LISTENER ADDED â–¼â–¼â–¼
        affiliateCardEl.addEventListener('change', () => {
            const selectedCard = affiliateCardEl.value;
            cardTiersEl.innerHTML = ''; // Clear previous options

            if (selectedCard === 'none') {
                cardTierContainerEl.classList.add('hidden');
                return;
            }

            const cardData = affiliateCardDiscounts[selectedCard];
            if (cardData) {
                cardData.tiers.forEach((tier, index) => {
                    const label = document.createElement('label');
                    label.className = 'radio-label';
                    label.innerHTML = `
                        <input type="radio" name="cardTier" value="${tier.discount}" class="radio-input" ${index === 0 ? 'checked' : ''}>
                        ${tier.label} (ì›” ${tier.discount.toLocaleString()}ì› í• ì¸)
                    `;
                    cardTiersEl.appendChild(label);
                });
                cardTierContainerEl.classList.remove('hidden');
            }
        });
        // â–²â–²â–² NEW EVENT LISTENER ADDED â–²â–²â–²

        if (generateComparisonButtonEl) {
            generateComparisonButtonEl.addEventListener('click', generateComparisonScript);
        }
        
        toggleDetailsButton.addEventListener('click', () => {
            expandedDetailsContainer.classList.toggle('hidden');
            const isHidden = expandedDetailsContainer.classList.contains('hidden');
            toggleDetailsButton.innerHTML = isHidden ? 'ìƒì„¸ ìš”ê¸ˆ ë‚´ì—­ í¼ì³ë³´ê¸° â–¼' : 'ìƒì„¸ ìš”ê¸ˆ ë‚´ì—­ ì ‘ê¸° â–²';
        });
        
        if(dongpanSalesCheckKtEl) {
            dongpanSalesCheckKtEl.addEventListener('change', function() {
                if (dongpanPolicyDetailsContainerKtEl) {
                    dongpanPolicyDetailsContainerKtEl.classList.toggle('hidden', !this.checked);
                }
                if (!resultSection.classList.contains('hidden')) {
                    calculateAndDisplayResults();
                }
            });
        }

        if(generateAIPersuasionBtn) {
            generateAIPersuasionBtn.addEventListener('click', () => callGeminiAPI('persuasion'));
        }
        if(generateAIHappyCallBtn) {
            generateAIHappyCallBtn.addEventListener('click', () => callGeminiAPI('happycall'));
        }
        
        const allDetailSections = [
            { radioValue: 'totalAmountBundle', toggleEl: totalAmountDetailsToggleEl, containerEl: totalAmountDetailsContainerEl, updateFn: updateTotalAmountDetails },
            { radioValue: 'premiumFamilyBundle', toggleEl: premiumFamilyDetailsToggleEl, containerEl: premiumFamilyDetailsContainerEl, updateFn: updatePremiumFamilyDetails },
            { radioValue: 'premiumSingleBundle', toggleEl: premiumSingleDetailsToggleEl, containerEl: premiumSingleDetailsContainerEl, updateFn: updatePremiumSingleDetails },
            { radioValue: 'familyBundle', toggleEl: familyBundleDetailsToggleEl, containerEl: familyBundleDetailsContainerEl, updateFn: updateFamilyBundleDetails },
            { radioValue: 'separateFamilyBundle', toggleEl: separateFamilyDetailsToggleEl, containerEl: separateFamilyDetailsContainerEl, updateFn: updateSeparateFamilyDetails },
            { radioValue: 'mvnoBundle', toggleEl: mvnoDetailsToggleEl, containerEl: mvnoDetailsContainerEl, updateFn: updateMvnoDetails }
        ];
        
        function updateMobilePlanOptions() {
            const selectedDiscountType = document.querySelector('input[name="discountType"]:checked').value;
            
            document.querySelectorAll('.mobile-plan-select').forEach((select, index) => {
                // [MODIFIED] Premium line rule now only applies to the first 2 lines of Family Bundle
                let isPremiumLineRuleActive = (selectedDiscountType === 'premiumFamilyBundle' && index < 2) || selectedDiscountType === 'premiumSingleBundle';
                let needsReset = false;
        
                for (const option of select.options) {
                    const price = parseInt(option.value);
                    if (price > 0) {
                        if (isPremiumLineRuleActive && price < 77000) { // ê¸°ì¤€ ìš”ê¸ˆ 77,000ì›ìœ¼ë¡œ ë³€ê²½
                            option.disabled = true;
                            if (option.selected) {
                                needsReset = true;
                            }
                        } else {
                            option.disabled = false;
                        }
                    }
                }
        
                if (needsReset) {
                    const firstAvailablePremium = Array.from(select.options).find(opt => !opt.disabled && parseInt(opt.value) >= 77000);
                    if (firstAvailablePremium) {
                         select.value = firstAvailablePremium.value;
                    } else {
                         select.value = "0"; // Fallback if no premium plans are available for some reason
                    }
                    select.dispatchEvent(new Event('change'));
                }
            });
        }
        
        function updateInternetPlanOptions() {
            const selectedDiscountType = document.querySelector('input[name="discountType"]:checked').value;
            const restrictedTypes = ['separateFamilyBundle', 'premiumFamilyBundle', 'premiumSingleBundle'];
            const isRestricted = restrictedTypes.includes(selectedDiscountType);
        
            let wasChanged = false;
        
            for (const option of internetPlanEl.options) {
                if (!option.dataset.speed) continue;
                const speed = parseInt(option.dataset.speed);
                if (speed < 500) { // 500M ë¯¸ë§Œ(ì¦‰, 100M)ì„ ì œí•œ
                    if (isRestricted) {
                        option.disabled = true;
                        if (option.selected) {
                            internetPlanEl.value = 'none';
                            wasChanged = true;
                        }
                    } else {
                        option.disabled = false;
                    }
                }
            }
        
            if (wasChanged) {
                // Use custom modal/notification instead of alert in production
                // alert('ì„ íƒí•˜ì‹  ê²°í•© ìœ í˜•ì€ 100M ì¸í„°ë„·ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. 500M ì´ìƒ ì¸í„°ë„· ìš”ê¸ˆì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                const first500M = Array.from(internetPlanEl.options).find(opt => parseInt(opt.dataset.speed) === 500 && !opt.disabled);
                if (first500M) {
                    internetPlanEl.value = first500M.value;
                }
                internetPlanEl.dispatchEvent(new Event('change'));
            }
        }
        
        discountTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                const newlySelectedRadioValue = this.value;
                const oldMobileCount = parseInt(mobileLinesCountEl.value);

                allDetailSections.forEach(section => {
                    if (section.containerEl && section.toggleEl) {
                        let isVisible = false;
                        if (newlySelectedRadioValue === section.radioValue) {
                            isVisible = section.toggleEl.checked;
                            if (isVisible && section.updateFn) {
                                section.updateFn();
                            }
                        } else {
                            section.toggleEl.checked = false;
                            isVisible = false;
                        }
                        section.containerEl.classList.toggle('hidden', !isVisible);
                    }
                });
        
                if (newlySelectedRadioValue === 'premiumSingleBundle') {
                    mobileLinesCountEl.value = 1;
                    mobileLinesCountEl.disabled = true;
                } else if (newlySelectedRadioValue === "none" || newlySelectedRadioValue === "familyBundle" || newlySelectedRadioValue === "mvnoBundle") {
                    mobileLinesCountEl.value = 0;
                    mobileLinesCountEl.disabled = true;
                } else {
                    mobileLinesCountEl.disabled = false;
                        if (oldMobileCount === 0 && !mobileLinesCountEl.disabled) {
                           mobileLinesCountEl.value = 1;
                        } else {
                           mobileLinesCountEl.value = oldMobileCount;
                        }
                }
        
                updateMobileLinesInputs();
                
                updateMobilePlanOptions();
                updateInternetPlanOptions();
            });
        });
        
        
        allDetailSections.forEach(section => {
            if (section.toggleEl && section.containerEl && section.updateFn) {
                section.toggleEl.addEventListener('change', function() {
                    const radioForThisToggle = document.querySelector(`input[name="discountType"][value="${section.radioValue}"]`);
                    if (radioForThisToggle && radioForThisToggle.checked) {
                        section.containerEl.classList.toggle('hidden', !this.checked);
                        if (this.checked) {
                            section.updateFn();
                        }
                    } else {
                        section.containerEl.classList.add('hidden');
                        this.checked = false;
                    }
                });
            }
        });
        
        const internetTypeRadios = document.querySelectorAll('input[name="internetType"]');
        internetTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                populateInternetPlans();
                handleInternetTypeChange();
            });
        });
        
        
        // ------------------- Functions -------------------
        
        function populateInternetPlans() {
            const selectedInternetType = document.querySelector('input[name="internetType"]:checked').value;
            const currentInternetPlan = internetPlanEl.value;
            internetPlanEl.innerHTML = '<option value="none">ì„ íƒ ì•ˆí•¨</option>';
        
            for (const planKey in internetPlans_KT) {
                const plan = internetPlans_KT[planKey];
                let displayText = "";
                let matchesType = false;
                
                const speedText = plan.speed >= 1000 ? `${plan.speed / 1000}G` : `${plan.speed}M`;
        
                if (selectedInternetType === "bundle") {
                    if (planKey.includes("ë²ˆë“¤")) {
                        displayText = `ì¸í„°ë„· ${speedText} (TV ê²°í•© ì‹œ) (ì›” ${plan.basePrice.toLocaleString()}ì›)`;
                        matchesType = true;
                    }
                } else {
                    if (planKey.includes("(ë‹¨ë…)")) {
                        displayText = `ì¸í„°ë„·(ë‹¨ë…) ${speedText} (ì›” ${plan.basePrice.toLocaleString()}ì›)`;
                        matchesType = true;
                    }
                }
        
                if (matchesType) {
                    const option = document.createElement('option');
                    option.value = planKey;
                    option.textContent = displayText;
                    option.dataset.price = plan.basePrice;
                    option.dataset.speed = plan.speed;
                    option.dataset.type = plan.type;
                    internetPlanEl.appendChild(option);
                }
            }
            
            if (Array.from(internetPlanEl.options).some(opt => opt.value === currentInternetPlan)) {
                internetPlanEl.value = currentInternetPlan;
            }
        
            updateInternetPlanOptions();
            internetPlanEl.dispatchEvent(new Event('change'));
        }
        
        function handleInternetTypeChange() {
            const selectedInternetType = document.querySelector('input[name="internetType"]:checked').value;
            const isStandalone = selectedInternetType === 'standalone';
        
            tvPlanEl.disabled = isStandalone;
            additionalTvPlanEl.disabled = isStandalone;
        
            if (isStandalone) {
                tvPlanEl.value = "none";
                additionalTvPlanEl.value = "none";
                internetPlanEl.value = "KTì¸í„°ë„·(ë‹¨ë…) 100mb";
            } else {
                internetPlanEl.value = "KTì¸í„°ë„·ë²ˆë“¤100mb";
        
                if (tvPlanEl.value === "none") {
                    tvPlanEl.value = "KTTVë² ì´ì§";
                }
            }
            tvPlanEl.dispatchEvent(new Event('change'));
            internetPlanEl.dispatchEvent(new Event('change'));
        }
        
        
        internetPlanEl.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            
            wifiRouterRentalEl.disabled = false;
            const ktRouterOption = Array.from(wifiRouterRentalEl.options).find(opt => opt.dataset.name === "KTê³µìœ ê¸°");
            if (ktRouterOption) {
                ktRouterOption.textContent = 'KTê³µìœ ê¸° (ì›” 1,100ì›)';
            }
        
            if (!selectedOption || selectedOption.value === 'none') {
                updateDiscountTypeAvailability();
                return;
            }
        
            const internetSpeed = parseInt(selectedOption.dataset.speed);
            
            if (internetSpeed >= 1000) { 
                if (ktRouterOption) {
                    ktRouterOption.selected = true;
                    ktRouterOption.textContent = 'KTê³µìœ ê¸° (1G ì´ìƒ ë¬´ë£Œ)';
                    wifiRouterRentalEl.disabled = true;
                }
            } 
            updateDiscountTypeAvailability();
        });
        
        
        tvPlanEl.addEventListener('change', () => {
            const isTvSelected = tvPlanEl.value !== 'none';
        });
        
        additionalTvPlanEl.addEventListener('change', () => {
            if (tvPlanEl.value === 'none' && additionalTvPlanEl.value !== 'none') {
                // Use custom modal/notification instead of alert in production
                // alert('ì²« ë²ˆì§¸ TVë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                additionalTvPlanEl.value = 'none';
            }
        });
        
        
        function updateMobileLinesInputs() {
            const count = parseInt(mobileLinesCountEl.value) || 0;
            const selectedDiscountType = document.querySelector('input[name="discountType"]:checked').value;
        
            const currentValues = [];
            document.querySelectorAll('.mobile-plan-select').forEach(select => {
                currentValues.push(select.value);
            });
        
            mobileLinesContainerEl.innerHTML = '';
        
            for (let i = 0; i < count; i++) {
                const div = document.createElement('div');
                div.className = 'mobile-line-item py-2 space-y-2';
                div.innerHTML = `
                        <div>
                            <label for="mobilePlan${i}" class="block text-sm font-medium text-slate-600 mb-1">íšŒì„  ${i + 1} ìš”ê¸ˆì œ ì„ íƒ</label>
                            <div class="flex items-center space-x-2">
                                <label for="selectiveContract${i}" class="flex items-center text-sm font-medium text-slate-600 cursor-pointer hover:text-sky-600 p-2 rounded-md bg-slate-50 border border-slate-200">
                                    <input type="checkbox" id="selectiveContract${i}" class="selective-contract-checkbox radio-input h-4 w-4 mr-2">
                                    ì„ íƒì•½ì •
                                </label>
                                <select id="mobilePlan${i}" class="input-field mobile-plan-select flex-grow">
                                    <option value="0" data-name="ìš”ê¸ˆì œ ì„ íƒì—†ìŒ" data-url="">ìš”ê¸ˆì œ ì„ íƒì—†ìŒ</option>
                                    ${mobilePlans_KT.map(plan => `
                                        <option value="${plan.price}" data-name="${plan.name}" data-url="${plan.url}">
                                            ${plan.name} (${plan.price.toLocaleString()}ì›)
                                        </option>
                                    `).join('')}
                                </select>
                            </div>
                        </div>
                `;
                mobileLinesContainerEl.appendChild(div);
        
                const newSelect = document.getElementById(`mobilePlan${i}`);
                
                let defaultValueSet = false;
        
                if (i === 0 && (selectedDiscountType === 'totalAmountBundle' || selectedDiscountType === 'premiumFamilyBundle' || selectedDiscountType === 'separateFamilyBundle')) {
                    if (currentValues[i] === undefined || currentValues[i] === null) {
                        if (selectedDiscountType !== 'separateFamilyBundle' || newSelect.value !== "0") {
                             newSelect.value = currentValues[i] || "0";
                             defaultValueSet = true;
                         }
                    }
                }
                
                if (!defaultValueSet) {
                    if (selectedDiscountType === 'premiumFamilyBundle') {
                        if (i === 1) { newSelect.value = "80000"; defaultValueSet = true; }
                        else if (i > 1) { newSelect.value = "69000"; defaultValueSet = true; }
                    } else if (selectedDiscountType === 'premiumSingleBundle') {
                        if (i === 0) { newSelect.value = "80000"; defaultValueSet = true; }
                    }
                }
        
                if (!defaultValueSet && currentValues[i]) {
                    newSelect.value = currentValues[i];
                }
            }
            
            document.querySelectorAll('.mobile-plan-select, .selective-contract-checkbox').forEach(el => {
                el.addEventListener('change', () => {
                    const currentDiscountType = document.querySelector('input[name="discountType"]:checked').value;
                    const section = allDetailSections.find(s => s.radioValue === currentDiscountType);
                    if (section && section.toggleEl.checked && section.updateFn) {
                        section.updateFn();
                    }
                    updateDiscountTypeAvailability();
                });
            });
        
            updateMobilePlanOptions();
            updateDiscountTypeAvailability();
        }
        
        
        function getSelectedInternetInfo(planName) {
            if (!planName || planName === 'none' || !internetPlans_KT[planName]) {
                return { basePrice: 0, modemFee: 0, type: "none", speed: 0 };
            }
        
            let basePrice = internetPlans_KT[planName].basePrice;
            const selectedOption = Array.from(internetPlanEl.options).find(opt => opt.value === planName);
            if (selectedOption && selectedOption.value !== 'none' && selectedOption.text.includes("KTì¸í„°ë„·ë²ˆë“¤")) {
                basePrice = internetPlans_KT[planName].basePrice;
            }
        
            return { ...internetPlans_KT[planName], basePrice: basePrice };
        }
        
        function getMobileTierKey(totalMobileBaseCost, numMobileLines, internetSpeedType) {
            const discountType = document.querySelector('input[name="discountType"]:checked').value;
            if (numMobileLines > 0 && totalMobileBaseCost === 0 && discountType === 'totalAmountBundle') {
                 totalMobileBaseCost = 37000;
            }
            if (numMobileLines === 0 || totalMobileBaseCost === 0) return null;

            if (internetSpeedType === "100M") {
                if (totalMobileBaseCost < 22000) return "ëª¨ë°”ì¼_22000ë¯¸ë§Œ";
                if (totalMobileBaseCost < 64900) return "ëª¨ë°”ì¼_64900ë¯¸ë§Œ";
                return "ëª¨ë°”ì¼_64900ì´ìƒ";
            } else {
                if (totalMobileBaseCost < 22000) return "ëª¨ë°”ì¼_22000ë¯¸ë§Œ";
                return "ëª¨ë°”ì¼_22000ì´ìƒ";
            }
        }
        
        function getMobileTierKeyFor500MUp(totalMobileBaseCost, numMobileLines){
            if (numMobileLines === 0 || totalMobileBaseCost === 0) return null;
            if (totalMobileBaseCost < 22000) return "ëª¨ë°”ì¼_22000ë¯¸ë§Œ";
            return "ëª¨ë°”ì¼_22000ì´ìƒ";
        }
        
        function getMobileTierKeyForSeparateFamily(totalMobileBaseCost, numMobileLines){
            if (numMobileLines === 0 || totalMobileBaseCost === 0) return null;
            if (totalMobileBaseCost < 22000) return "ëª¨ë°”ì¼_22000ë¯¸ë§Œ";
            return "ëª¨ë°”ì¼_22000ì´ìƒ";
        }
        
        // --- NEW/MODIFIED FUNCTIONS for Discount Details ---

        function copyDiscountDetailsToClipboard(type) {
            let textToCopy = '';
            switch(type) {
                case 'totalAmountBundle':
                    textToCopy = `[KT ì´ì•¡ ê²°í•©í• ì¸ ì•ˆë‚´]
KT íœ´ëŒ€í°ì„ ì“°ëŠ” ê°€ì¡±ì´ ë§ì„ìˆ˜ë¡, ìš”ê¸ˆ ì´ì•¡ì´ ë†’ì„ìˆ˜ë¡ ìœ ë¦¬í•œ ê²°í•©ì…ë‹ˆë‹¤.

â–  í•µì‹¬ í˜œíƒ (ì¸í„°ë„·+ëª¨ë°”ì¼)
- 100M: ìµœëŒ€ 28,600ì› í• ì¸
- 500M/1G: ìµœëŒ€ 33,110ì› í• ì¸
* í• ì¸ì•¡ì€ ê²°í•©í•˜ëŠ” íœ´ëŒ€í° ìš”ê¸ˆ ì´ì•¡ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤.

â–  ì£¼ìš” ì¡°ê±´
- ìµœëŒ€ ì¸í„°ë„· 1íšŒì„  + íœ´ëŒ€í° 5íšŒì„ ê¹Œì§€ ê²°í•© ê°€ëŠ¥
- ëŒ€í‘œì ê¸°ì¤€ ì§ê³„ ê°€ì¡± ë²”ìœ„ë§Œ ê°€ëŠ¥ (ê°€ì¡±ê´€ê³„ì¦ëª…ì„œ í•„ìš”)

â–  ì£¼ì˜ì‚¬í•­
- ê¸°ì¡´ 'ë¬´ì„ ë¬´ì„ ' íœ´ëŒ€í° ê²°í•©ê³¼ëŠ” ì¤‘ë³µ ë¶ˆê°€í•©ë‹ˆë‹¤.`;
                    break;
                case 'premiumFamilyBundle':
                    textToCopy = `[KT í”„ë¦¬ë¯¸ì—„ ê°€ì¡±ê²°í•© ì•ˆë‚´]
ê³ ê°€ ìš”ê¸ˆì œ(7.7ë§Œ ì´ìƒ) ì“°ëŠ” ê°€ì¡±ì´ 2ëª… ì´ìƒì¼ ë•Œ ê°•ë ¥ ì¶”ì²œí•˜ëŠ” ê²°í•©ì…ë‹ˆë‹¤.

â–  í•µì‹¬ í˜œíƒ
- 2ë²ˆì§¸ íšŒì„ ë¶€í„° 7.7ë§Œ ì´ìƒ ìš”ê¸ˆì œëŠ” ì›”ì •ì•¡ì˜ 25% í• ì¸! (ì„ íƒì•½ì •ê³¼ ì¤‘ë³µ ì‹œ ìµœëŒ€ 50%!)
- 1ë²ˆì§¸ íšŒì„ ì€ 'ì´ì•¡ê²°í•©í• ì¸'ìœ¼ë¡œ ì¶”ê°€ í• ì¸ ì ìš©

â–  ì£¼ìš” ì¡°ê±´
- 500M ì´ìƒ ì¸í„°ë„· ì‚¬ìš© í•„ìˆ˜
- ê²°í•© ê°€ì¡± ì¤‘ 2ëª… ì´ìƒì´ 7.7ë§Œ ì› ì´ìƒ ìš”ê¸ˆì œ ì‚¬ìš©

â–  ì£¼ì˜ì‚¬í•­
- 100M ì¸í„°ë„·ì€ ê°€ì… ë¶ˆê°€í•©ë‹ˆë‹¤.
- í• ì¸ì„ í•œ ëª…ì—ê²Œ ëª°ì•„ì¤„ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.`;
                    break;
                case 'premiumSingleBundle':
                    textToCopy = `[KT í”„ë¦¬ë¯¸ì—„ ì‹±ê¸€ê²°í•© ì•ˆë‚´]
í˜¼ìì„œ ê³ ê°€ ìš”ê¸ˆì œ(7.7ë§Œ ì´ìƒ)ì™€ ë¹ ë¥¸ ì¸í„°ë„·ì„ ì“¸ ë•Œ ìµœê³ ì˜ ì„ íƒì…ë‹ˆë‹¤.

â–  í•µì‹¬ í˜œíƒ
- íœ´ëŒ€í° ìš”ê¸ˆ ì›”ì •ì•¡ì˜ 25% í• ì¸ (ì„ íƒì•½ì •ê³¼ ì¤‘ë³µ ì‹œ ìµœëŒ€ 50%!)
- 500M ì´ìƒ ì¸í„°ë„· ë‹¨ë… ì‚¬ìš© ì‹œ 5,500ì› ì¶”ê°€ í• ì¸

â–  ì£¼ìš” ì¡°ê±´
- 500M ì´ìƒ ì¸í„°ë„· ì‚¬ìš© í•„ìˆ˜
- ë³¸ì¸ íœ´ëŒ€í° 1íšŒì„ ì´ 7.7ë§Œ ì› ì´ìƒ ìš”ê¸ˆì œ ì‚¬ìš©

â–  ì£¼ì˜ì‚¬í•­
- 100M ì¸í„°ë„·ì€ ê°€ì… ë¶ˆê°€í•©ë‹ˆë‹¤.
- ì¸í„°ë„·+TV ê²°í•© ì‹œì—ëŠ” ê°€ì…ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
                    break;
                case 'familyBundle':
                    textToCopy = `[KT íŒ¨ë°€ë¦¬ ê²°í•© ì•ˆë‚´]
ê¸°ì¡´ì— KT ì¸í„°ë„·ì„ ì“°ëŠ” ê°€ì¡±ì´ ìˆì„ ë•Œ, ì¶”ê°€ íšŒì„ ì„ ì €ë ´í•˜ê²Œ ì´ìš©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

â–  í•µì‹¬ í˜œíƒ (ì¶”ê°€ íšŒì„  ê¸°ì¤€)
- 100M ì¸í„°ë„·: 5,500ì› í• ì¸
- 500M/1G ì¸í„°ë„·: 11,000ì› í• ì¸

â–  ì£¼ìš” ì¡°ê±´
- ë³¸ì¸ ë˜ëŠ” ì§ê³„ ê°€ì¡± ì¤‘ ê¸°ì¡´ KT ì¸í„°ë„· ì‚¬ìš©ì(ëª¨íšŒì„ ) í•„ìš”
- ì‹ ê·œ ì„¤ì¹˜ í›„ 1ê°œì›” ë‚´ ê²°í•© ì‹ ì²­ í•„ìˆ˜

â–  ì£¼ì˜ì‚¬í•­
- ë²•ì¸ ëª…ì˜ëŠ” ê°€ì… ë¶ˆê°€í•©ë‹ˆë‹¤.`;
                    break;
                case 'separateFamilyBundle':
                    textToCopy = `[KT ë”°ë¡œ ì‚´ì•„ë„ ê°€ì¡±ê²°í•© ì•ˆë‚´]
ë©€ë¦¬ ì‚¬ëŠ” ê°€ì¡±ë„ KT ì¸í„°ë„·ì„ ì“´ë‹¤ë©´ ì¶”ê°€ í• ì¸ì„ ë°›ì„ ìˆ˜ ìˆëŠ” ìƒˆë¡œìš´ ê²°í•© ìƒí’ˆì…ë‹ˆë‹¤.

â–  í•µì‹¬ í˜œíƒ
- 500M ì¸í„°ë„·/TV: ê°ê° 2,200ì› ì¶”ê°€ í• ì¸
- 1G ì¸í„°ë„·/TV: ê°ê° 3,300ì› ì¶”ê°€ í• ì¸
* ê¸°ì¡´ 'ì´ì•¡ ê²°í•©í• ì¸'ê³¼ ì¤‘ë³µ ì ìš©ë©ë‹ˆë‹¤.

â–  ì£¼ìš” ì¡°ê±´
- ê¸°ì¤€ ê°€ì¡±(ë² ì´ìŠ¤ íšŒì„ )ì´ KT ì¸í„°ë„·+íœ´ëŒ€í° ì‚¬ìš©
- 25ë…„ 3ì›” ì´í›„ ì‹ ê·œ ê°€ì…ì
- ê°€ì¡±ê´€ê³„ì¦ëª…ì„œ ë“± ì„œë¥˜ ì œì¶œ í•„ìš”

â–  ì£¼ì˜ì‚¬í•­
- 100M ì¸í„°ë„·ì€ í• ì¸ í˜œíƒì´ ì—†ìŠµë‹ˆë‹¤.
- ê¸°ì¡´ 'ë­‰ì¹˜ë©´ì˜¬ë ˆ' ì‚¬ìš©ìëŠ” ë² ì´ìŠ¤ íšŒì„  ì§€ì • ë¶ˆê°€
- 'íŒ¨ë°€ë¦¬ ê²°í•©' ìíšŒì„ ì€ ì¤‘ë³µ ì ìš© ë¶ˆê°€
- ê°œí†µ í›„ ìµì›” ë§ê¹Œì§€ ê²°í•© ì‹ ì²­ í•„ìˆ˜`;
                    break;
                case 'mvnoBundle':
                    textToCopy = `[KT ì•Œëœ°í° ê²°í•© ì•ˆë‚´]
KTë§ ì•Œëœ°í° ìœ ì €ë¥¼ ìœ„í•œ ì¸í„°ë„· ìš”ê¸ˆ í• ì¸ ìƒí’ˆì…ë‹ˆë‹¤.

â–  í•µì‹¬ í˜œíƒ (ì¸í„°ë„· ìš”ê¸ˆë§Œ í• ì¸)
- 100M: 3,300ì› í• ì¸
- 500M/1G(ë‹¨ë…): 11,000ì› í• ì¸
- 500M/1G(TVê²°í•©): 5,500ì› í• ì¸

â–  ì£¼ìš” ì¡°ê±´
- ì§€ì •ëœ KTë§ ì•Œëœ°í° í†µì‹ ì‚¬ ì‚¬ìš© ê³ ê°
- ì¸í„°ë„· ì„¤ì¹˜ í›„, ì‚¬ìš© ì¤‘ì¸ ì•Œëœ°í° ê³ ê°ì„¼í„°ë¡œ ì§ì ‘ ê²°í•© ì‹ ì²­

â–  ì£¼ì˜ì‚¬í•­
- ê°œì¸/ë²•ì¸ ì‚¬ì—…ìëŠ” ê²°í•© ë¶ˆê°€í•©ë‹ˆë‹¤.
- ì›¹(ì˜¨ë¼ì¸)ì„ í†µí•´ ê°œí†µí•œ ì•Œëœ°í°ë§Œ ê²°í•© ê°€ëŠ¥í•©ë‹ˆë‹¤. (ìš°ì²´êµ­, ëŒ€ë¦¬ì  ê°œí†µê±´ ë¶ˆê°€)
- ê²°í•© ê°€ëŠ¥í•œ ì•Œëœ°í° í†µì‹ ì‚¬ê°€ ì •í•´ì ¸ ìˆìœ¼ë‹ˆ ê¼­ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.`;
                    break;
            }
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                // Use a more modern feedback mechanism if possible
                alert('ì•ˆë‚´ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }).catch(err => {
                console.error('Could not copy text: ', err);
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        }

        function updateTotalAmountDetails() {
            totalAmountDetailsContainerEl.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-bold text-sky-800 text-base">ğŸ’¸ ì´ì•¡ ê²°í•©í• ì¸</h4>
                    <button onclick="copyDiscountDetailsToClipboard('totalAmountBundle')" class="btn-secondary text-xs py-1 px-2 rounded-md">ë‚´ìš© ë³µì‚¬</button>
                </div>
                <p class="text-sm text-sky-700 bg-sky-100 p-2 rounded-md mb-3">
                    "KT íœ´ëŒ€í° ì“°ëŠ” ê°€ì¡±ì´ ë§ì„ìˆ˜ë¡, ìš”ê¸ˆ ì´ì•¡ì´ ë†’ì„ìˆ˜ë¡ ìœ ë¦¬í•´ìš”!"
                </p>
                <div class="mb-3">
                    <h5 class="font-semibold text-slate-700 text-sm mb-1">ğŸ í•µì‹¬ í˜œíƒ</h5>
                    <ul class="list-disc list-inside text-sm space-y-1 text-slate-600">
                        <li>ì¸í„°ë„·ê³¼ ëª¨ë°”ì¼ ìš”ê¸ˆì„ <strong>ì´ì¤‘ìœ¼ë¡œ í• ì¸!</strong></li>
                        <li><strong>100M ì¸í„°ë„· ê¸°ì¤€:</strong> ìµœëŒ€ <strong class="text-green-600">28,600ì›</strong> í• ì¸</li>
                        <li><strong>500M/1G ì¸í„°ë„· ê¸°ì¤€:</strong> ìµœëŒ€ <strong class="text-green-600">33,110ì›</strong> í• ì¸</li>
                    </ul>
                </div>
                <div class="bg-amber-50 border-l-4 border-amber-400 p-3 rounded">
                    <h5 class="font-bold text-amber-800 text-sm mb-1">âš ï¸ ê¼­ í™•ì¸í•˜ì„¸ìš”!</h5>
                    <ul class="list-disc list-inside text-sm space-y-1 text-amber-700">
                        <li>ê¸°ì¡´ 'ë¬´ì„ ë¬´ì„ ' ê²°í•© ìƒí’ˆê³¼ëŠ” ì¤‘ë³µ ê°€ì…ì´ ì•ˆë¼ìš”.</li>
                        <li>ìµœëŒ€ ì¸í„°ë„· 1íšŒì„  + íœ´ëŒ€í° 5íšŒì„ ê¹Œì§€ ê²°í•© ê°€ëŠ¥í•´ìš”.</li>
                    </ul>
                </div>
            `;
        }

        function updatePremiumFamilyDetails() {
            premiumFamilyDetailsContainerEl.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-bold text-violet-800 text-base">ğŸ‘‘ í”„ë¦¬ë¯¸ì—„ ê°€ì¡±ê²°í•©</h4>
                    <button onclick="copyDiscountDetailsToClipboard('premiumFamilyBundle')" class="btn-secondary text-xs py-1 px-2 rounded-md">ë‚´ìš© ë³µì‚¬</button>
                </div>
                <p class="text-sm text-violet-700 bg-violet-100 p-2 rounded-md mb-3">
                    "ê³ ê°€ ìš”ê¸ˆì œ(7.7ë§Œ ì´ìƒ) ì“°ëŠ” ê°€ì¡±ì´ 2ëª… ì´ìƒì¼ ë•Œ ê°•ë ¥ ì¶”ì²œ!"
                </p>
                <div class="mb-3">
                    <h5 class="font-semibold text-slate-700 text-sm mb-1">ğŸ í•µì‹¬ í˜œíƒ</h5>
                    <ul class="list-disc list-inside text-sm space-y-1 text-slate-600">
                        <li>2ë²ˆì§¸ íšŒì„ ë¶€í„° <strong>íœ´ëŒ€í° ìš”ê¸ˆ 25% í• ì¸!</strong></li>
                        <li>ì„ íƒì•½ì • 25% + ê²°í•© 25% = <strong class="text-green-600">ìµœëŒ€ 50% í• ì¸!</strong></li>
                        <li>1ë²ˆì§¸ íšŒì„ ì€ 'ì´ì•¡ê²°í•©'ìœ¼ë¡œ ì¶”ê°€ í• ì¸ì„ ë°›ì•„ìš”.</li>
                    </ul>
                </div>
                <div class="bg-amber-50 border-l-4 border-amber-400 p-3 rounded">
                    <h5 class="font-bold text-amber-800 text-sm mb-1">âš ï¸ ê¼­ í™•ì¸í•˜ì„¸ìš”!</h5>
                    <ul class="list-disc list-inside text-sm space-y-1 text-amber-700">
                        <li><strong>500M ì´ìƒ ì¸í„°ë„·</strong>ë§Œ ê°€ì… ê°€ëŠ¥í•´ìš”. (100M ë¶ˆê°€)</li>
                        <li>ê°€ì¡± ì¤‘ <strong>2ëª… ì´ìƒì´ 7.7ë§Œ ì› ì´ìƒ</strong> ìš”ê¸ˆì œë¥¼ ì¨ì•¼ í•´ìš”.</li>
                    </ul>
                </div>
            `;
        }
        
        function updatePremiumSingleDetails() {
            premiumSingleDetailsContainerEl.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-bold text-rose-800 text-base">ğŸ’ í”„ë¦¬ë¯¸ì—„ ì‹±ê¸€ê²°í•©</h4>
                    <button onclick="copyDiscountDetailsToClipboard('premiumSingleBundle')" class="btn-secondary text-xs py-1 px-2 rounded-md">ë‚´ìš© ë³µì‚¬</button>
                </div>
                <p class="text-sm text-rose-700 bg-rose-100 p-2 rounded-md mb-3">
                    "í˜¼ìì„œ ê³ ê°€ ìš”ê¸ˆì œ(7.7ë§Œ ì´ìƒ)ì™€ ë¹ ë¥¸ ì¸í„°ë„·ì„ ì“¸ ë•Œ ìµœê³ ì˜ ì„ íƒ!"
                </p>
                <div class="mb-3">
                    <h5 class="font-semibold text-slate-700 text-sm mb-1">ğŸ í•µì‹¬ í˜œíƒ</h5>
                    <ul class="list-disc list-inside text-sm space-y-1 text-slate-600">
                        <li><strong>íœ´ëŒ€í° ìš”ê¸ˆ 25% í• ì¸!</strong></li>
                        <li>ì„ íƒì•½ì • 25% + ê²°í•© 25% = <strong class="text-green-600">ìµœëŒ€ 50% í• ì¸!</strong></li>
                        <li>ì¸í„°ë„·ë§Œ ë‹¨ë…ìœ¼ë¡œ ì“°ë©´ <strong class="text-green-600">5,500ì›</strong> ì¶”ê°€ í• ì¸!</li>
                    </ul>
                </div>
                <div class="bg-amber-50 border-l-4 border-amber-400 p-3 rounded">
                    <h5 class="font-bold text-amber-800 text-sm mb-1">âš ï¸ ê¼­ í™•ì¸í•˜ì„¸ìš”!</h5>
                    <ul class="list-disc list-inside text-sm space-y-1 text-amber-700">
                        <li><strong>500M ì´ìƒ ì¸í„°ë„·</strong>ë§Œ ê°€ì… ê°€ëŠ¥í•´ìš”. (100M ë¶ˆê°€)</li>
                        <li>ë³¸ì¸ íœ´ëŒ€í° 1íšŒì„ ì´ <strong>7.7ë§Œ ì› ì´ìƒ</strong> ìš”ê¸ˆì œì—¬ì•¼ í•´ìš”.</li>
                    </ul>
                </div>
            `;
        }
        
        function updateFamilyBundleDetails() {
            familyBundleDetailsContainerEl.innerHTML = `
                 <div class="flex justify-between items-center mb-3">
                    <h4 class="font-bold text-cyan-800 text-base">ğŸ  íŒ¨ë°€ë¦¬ ê²°í•©</h4>
                    <button onclick="copyDiscountDetailsToClipboard('familyBundle')" class="btn-secondary text-xs py-1 px-2 rounded-md">ë‚´ìš© ë³µì‚¬</button>
                </div>
                <p class="text-sm text-cyan-700 bg-cyan-100 p-2 rounded-md mb-3">
                    "ê¸°ì¡´ì— KT ì¸í„°ë„·ì„ ì“°ëŠ” ê°€ì¡±ì´ ìˆì„ ë•Œ, ì¶”ê°€ íšŒì„ ì„ ì €ë ´í•˜ê²Œ!"
                </p>
                <div class="mb-3">
                    <h5 class="font-semibold text-slate-700 text-sm mb-1">ğŸ í•µì‹¬ í˜œíƒ (ì¶”ê°€ íšŒì„  ê¸°ì¤€)</h5>
                    <ul class="list-disc list-inside text-sm space-y-1 text-slate-600">
                        <li><strong>100M ì¸í„°ë„·:</strong> <strong class="text-green-600">5,500ì›</strong> í• ì¸</li>
                        <li><strong>500M/1G ì¸í„°ë„·:</strong> <strong class="text-green-600">11,000ì›</strong> í• ì¸</li>
                    </ul>
                </div>
                <div class="bg-amber-50 border-l-4 border-amber-400 p-3 rounded">
                    <h5 class="font-bold text-amber-800 text-sm mb-1">âš ï¸ ê¼­ í™•ì¸í•˜ì„¸ìš”!</h5>
                    <ul class="list-disc list-inside text-sm space-y-1 text-amber-700">
                        <li>ê°€ì¡± ì¤‘ ê¸°ì¡´ KT ì¸í„°ë„· ì‚¬ìš©ì(ëª¨íšŒì„ )ê°€ ê¼­ ìˆì–´ì•¼ í•´ìš”.</li>
                        <li>ì„¤ì¹˜ í›„ <strong>1ê°œì›” ì•ˆì—</strong> ê²°í•© ì‹ ì²­ì„ í•´ì•¼ í•´ìš”.</li>
                        <li>ë²•ì¸ ëª…ì˜ëŠ” ê°€ì…í•  ìˆ˜ ì—†ì–´ìš”.</li>
                    </ul>
                </div>
            `;
        }
        
        function updateSeparateFamilyDetails() {
            separateFamilyDetailsContainerEl.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-bold text-emerald-800 text-base">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ë”°ë¡œ ì‚´ì•„ë„ ê°€ì¡±ê²°í•©</h4>
                     <button onclick="copyDiscountDetailsToClipboard('separateFamilyBundle')" class="btn-secondary text-xs py-1 px-2 rounded-md">ë‚´ìš© ë³µì‚¬</button>
                </div>
                <p class="text-sm text-emerald-700 bg-emerald-100 p-2 rounded-md mb-3">
                    "ë©€ë¦¬ ì‚´ì•„ë„ KT ì“°ëŠ” ê°€ì¡±ì´ ìˆë‹¤ë©´! ì´ì•¡ê²°í•©ì— í• ì¸ì„ ë” ë°›ëŠ” ì‹ ìƒ ê²°í•©!"
                </p>
                <div class="mb-3">
                    <h5 class="font-semibold text-slate-700 text-sm mb-1">ğŸ í•µì‹¬ í˜œíƒ</h5>
                    <ul class="list-disc list-inside text-sm space-y-1 text-slate-600">
                        <li><strong>500M ì¸í„°ë„·/TV:</strong> ê°ê° <strong class="text-green-600">2,200ì›</strong> ì¶”ê°€ í• ì¸</li>
                        <li><strong>1G ì¸í„°ë„·/TV:</strong> ê°ê° <strong class="text-green-600">3,300ì›</strong> ì¶”ê°€ í• ì¸</li>
                        <li>ê¸°ì¡´ 'ì´ì•¡ ê²°í•©í• ì¸'ì— <strong class="text-green-600">ì¤‘ë³µìœ¼ë¡œ ì ìš©</strong>ë¼ìš”!</li>
                    </ul>
                </div>
                <div class="bg-amber-50 border-l-4 border-amber-400 p-3 rounded">
                    <h5 class="font-bold text-amber-800 text-sm mb-1">âš ï¸ ê¼­ í™•ì¸í•˜ì„¸ìš”!</h5>
                    <ul class="list-disc list-inside text-sm space-y-1 text-amber-700">
                        <li><strong>100M ì¸í„°ë„·ì€ í• ì¸ í˜œíƒì´ ì—†ì–´ìš”.</strong></li>
                        <li>ê¸°ì¡´ 'ë­‰ì¹˜ë©´ì˜¬ë ˆ' ê²°í•© ì‚¬ìš©ìëŠ” ë² ì´ìŠ¤ íšŒì„ ìœ¼ë¡œ ì§€ì •í•  ìˆ˜ ì—†ì–´ìš”.</li>
                        <li>'íŒ¨ë°€ë¦¬ ê²°í•©'ì˜ ìíšŒì„ ì€ ì¤‘ë³µ ì ìš©ì´ ì•ˆë¼ìš”.</li>
                        <li>ê°œí†µ í›„ ë‹¤ìŒ ë‹¬ ë§ê¹Œì§€ ê¼­ ê²°í•© ì‹ ì²­ì„ ì™„ë£Œí•´ì•¼ í•´ìš”.</li>
                    </ul>
                </div>
            `;
        }
        
        function updateMvnoDetails() {
            mvnoDetailsContainerEl.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-bold text-gray-800 text-base">ğŸ“± KT ì•Œëœ°í° ê²°í•©</h4>
                    <button onclick="copyDiscountDetailsToClipboard('mvnoBundle')" class="btn-secondary text-xs py-1 px-2 rounded-md">ë‚´ìš© ë³µì‚¬</button>
                </div>
                <p class="text-sm text-gray-700 bg-gray-100 p-2 rounded-md mb-3">
                    "KTë§ ì•Œëœ°í° ìœ ì €ë¥¼ ìœ„í•œ ì¸í„°ë„· ìš”ê¸ˆ í• ì¸!"
                </p>
                <div class="mb-3">
                    <h5 class="font-semibold text-slate-700 text-sm mb-1">ğŸ í•µì‹¬ í˜œíƒ (ì¸í„°ë„· ìš”ê¸ˆë§Œ í• ì¸)</h5>
                    <ul class="list-disc list-inside text-sm space-y-1 text-slate-600">
                        <li><strong>100M:</strong> <strong class="text-green-600">3,300ì›</strong> í• ì¸</li>
                        <li><strong>500M/1G (ë‹¨ë…):</strong> <strong class="text-green-600">11,000ì›</strong> í• ì¸</li>
                        <li><strong>500M/1G (TVê²°í•©):</strong> <strong class="text-green-600">5,500ì›</strong> í• ì¸</li>
                    </ul>
                </div>
                <div class="bg-amber-50 border-l-4 border-amber-400 p-3 rounded">
                    <h5 class="font-bold text-amber-800 text-sm mb-1">âš ï¸ ê¼­ í™•ì¸í•˜ì„¸ìš”!</h5>
                    <ul class="list-disc list-inside text-sm space-y-1 text-amber-700">
                        <li>ì‚¬ì—…ì ëª…ì˜ëŠ” ê°€ì…í•  ìˆ˜ ì—†ì–´ìš”.</li>
                        <li>ì¸í„°ë„· ì„¤ì¹˜ í›„, <strong class="text-amber-900">ì•Œëœ°í° ê³ ê°ì„¼í„°ë¡œ ì§ì ‘</strong> ê²°í•©ì„ ìš”ì²­í•´ì•¼ í•´ìš”.</li>
                        <li>ì˜¨ë¼ì¸ìœ¼ë¡œ ê°œí†µí•œ ì•Œëœ°í°ë§Œ ê°€ëŠ¥í•´ìš”! (ìš°ì²´êµ­/ëŒ€ë¦¬ì  ê°œí†µ ë¶ˆê°€)</li>
                        <li>ê²°í•© ê°€ëŠ¥í•œ ì•Œëœ°í° í†µì‹ ì‚¬ì¸ì§€ ê¼­ í™•ì¸í•´ì•¼ í•´ìš”.</li>
                    </ul>
                </div>
            `;
        }
        
        function calculateInstallationFee(internetSelected, tvSelected, phonePlanName, additionalTvSelected, installTime) {
            const timeKey = installTime === 'weekday' ? 'í‰ì¼' : 'ì£¼ë§';
            const feeTable = ktInstallationFees_new[timeKey];
        
            if (!feeTable) return { fee: 0, desc: "ì„¤ì¹˜ ì‹œê°„ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”." };
        
            let fee = 0;
            let desc = "ì‚°ì • ë¶ˆê°€";
            let combinationKey = "";
        
            const phoneSelected = phonePlanName !== 'none';
            const is070Phone = phoneSelected && phonePlanName.includes("ì¸í„°ë„·ì „í™”");
            const isGeneralPhone = phoneSelected && !is070Phone;
        
            if (internetSelected && tvSelected && additionalTvSelected) {
                combinationKey = "ì¸í„°ë„·+TV+TVì¶”ê°€";
                desc = "ì¸í„°ë„· + TV + ì¶”ê°€ TV";
            } else if (internetSelected && tvSelected && isGeneralPhone) {
                combinationKey = "ì¸í„°ë„·+TV+ì¼ë°˜ì „í™”";
                desc = "ì¸í„°ë„· + TV + ì¼ë°˜ì „í™”";
            } else if (internetSelected && tvSelected && is070Phone) {
                combinationKey = "ì¸í„°ë„·+TV+070ì „í™”";
                desc = "ì¸í„°ë„· + TV + 070ì „í™”";
            } else if (internetSelected && tvSelected) {
                combinationKey = "ì¸í„°ë„·+TV";
                desc = "ì¸í„°ë„· + TV";
            } else if (internetSelected && isGeneralPhone) {
                combinationKey = "ì¸í„°ë„·+ì¼ë°˜ì „í™”";
                desc = "ì¸í„°ë„· + ì¼ë°˜ì „í™”";
            } else if (internetSelected && is070Phone) {
                combinationKey = "ì¸í„°ë„·+070ì „í™”";
                desc = "ì¸í„°ë„· + 070ì „í™”";
            } else if (internetSelected) {
                combinationKey = "ì¸í„°ë„·";
                desc = "ì¸í„°ë„· ë‹¨ë…";
            } else {
                if (tvSelected) {
                    fee = 0; 
                    desc = "TV ë‹¨ë… (ë¹„ìš© ë³„ë„ ë¬¸ì˜)";
                } else if (phoneSelected) {
                    fee = 0;
                    desc = "ì „í™” ë‹¨ë… (ë¹„ìš© ë³„ë„ ë¬¸ì˜)";
                }
                return { fee, desc };
            }
        
            fee = feeTable[combinationKey] || 0;
            
            if (timeKey === 'ì£¼ë§' && fee > 0 && feeTable["ìœ íš¨ê¸°ê°„"]) {
                desc += ` (${feeTable["ìœ íš¨ê¸°ê°„"]})`;
            }
        
            return { fee, desc };
        }
        
        
        /**
         * @description Main calculation orchestrator for the "Calculate" button
         */
        function calculateAndDisplayResults() {
            try {
                const results = getCalculationResults();
                displayResults(results);
                generateAllScripts(results);
            } catch (error) {
                console.error("ê³„ì‚° ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                // Use a custom modal/notification in production instead of alert
                // alert("ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì…ë ¥ ê°’ì„ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            }
        }
        
       /**
        * @description âœ¨ New: Core calculation engine. Can be called for any plan.
        * @param {object} options - Optional parameters.
        * @param {string|null} options.forcedInternetPlanName - If provided, calculates for this plan instead of the selected one.
        * @returns {object} A comprehensive object with all calculation results.
        */
        function getCalculationResults(options = {}) {
            const { forcedInternetPlanName = null } = options;

            // --- 1. Gather Inputs ---
            const internetPlanName = forcedInternetPlanName || internetPlanEl.value;
            const selectedWifiOptionEl = wifiRouterRentalEl.options[wifiRouterRentalEl.selectedIndex];
            const selectedWifiName = selectedWifiOptionEl ? selectedWifiOptionEl.dataset.name : "KTê³µìœ ê¸° X";
            const tvPlanName = tvPlanEl.value;
            const additionalTvPlanKey = additionalTvPlanEl.value;
            const phonePlanName = phonePlanEl.value;
            const discountType = document.querySelector('input[name="discountType"]:checked').value;
            const installationTime = document.querySelector('input[name="installationTime"]:checked').value;
            const selectedAddonCheckboxes = document.querySelectorAll('#addonServicesContainer input[type="checkbox"]:checked');
            const isDongpanChecked = dongpanSalesCheckKtEl ? dongpanSalesCheckKtEl.checked : false;

            // â–¼â–¼â–¼ NEW INPUT GATHERING â–¼â–¼â–¼
            const selectedCardId = affiliateCardEl.value;
            const selectedCardTierEl = document.querySelector('input[name="cardTier"]:checked');
            const cardDiscountAmount = selectedCardTierEl ? parseInt(selectedCardTierEl.value) : 0;
            const selectedCardData = affiliateCardDiscounts[selectedCardId];
            // â–²â–²â–² NEW INPUT GATHERING â–²â–²â–²

            let totalMobileBaseCost = 0;
            let mobileLinesData = [];
            document.querySelectorAll('.mobile-line-item').forEach((item, i) => {
                const select = item.querySelector(`#mobilePlan${i}`);
                const checkbox = item.querySelector(`#selectiveContract${i}`);
                const option = select.options[select.selectedIndex];
                const cost = parseInt(option.value) || 0;
                mobileLinesData.push({
                    cost: cost,
                    name: option.dataset.name,
                    url: option.dataset.url,
                    applySelectiveContract: checkbox.checked
                });
                totalMobileBaseCost += cost;
            });
            const numMobileLines = mobileLinesData.length;

            // --- 2. Calculate Base Costs ---
            let tvBase = (tvPlanName !== 'none' && tvPlans_KT[tvPlanName]) ? tvPlans_KT[tvPlanName].basePrice : 0;
            let additionalTvCost = (additionalTvPlanKey !== 'none' && additionalTvPlans_KT[additionalTvPlanKey]) ? additionalTvPlans_KT[additionalTvPlanKey].basePrice : 0;
            let phoneBase = (phonePlanName !== 'none' && phonePlans_KT[phonePlanName]) ? phonePlans_KT[phonePlanName].basePrice : 0;
            let currentInternet = getSelectedInternetInfo(internetPlanName);
            let internetBase = internetPlanName !== 'none' ? (parseFloat(currentInternet.basePrice) || 0) : 0;
            
            const selectedWifiData = wifiOptions_KT[selectedWifiName];
            let actualWifiRouterFee = selectedWifiData ? selectedWifiData.fee : 0;
            if (currentInternet.speed >= 1000 && selectedWifiName === "KTê³µìœ ê¸°") {
                actualWifiRouterFee = 0;
            }
            
            let addonServicesTotalCost = 0;
            selectedAddonCheckboxes.forEach(checkbox => {
                addonServicesTotalCost += (parseFloat(checkbox.dataset.price) || 0);
            });

            // --- 3. Calculate Discounts ---
            let internetDiscount = 0;
            let currentTvDiscount = 0;
            let totalMobileDiscount = 0;
            let mobileDiscountDescription = 'ê²°í•©ì— ë”°ë¥¸ ëª¨ë°”ì¼ í• ì¸ ì—†ìŒ.';
            let mobileLinesDetailsForScript = [];

            const isTvOrPhoneBundled = tvPlanName !== 'none' || phonePlanName !== 'none';
            
            if (discountType !== 'none' && internetPlanName !== 'none') {
                // (The entire complex discount logic from the original function goes here)
                // This part is unchanged, just encapsulated. It calculates internetDiscount, currentTvDiscount, and totalMobileDiscount
                  const internetSpeedType = currentInternet.type;
                  const bundleTypeForDiscountRule = isTvOrPhoneBundled ? "TV" : "ë‹¨ë…";
        
                if (discountType === 'totalAmountBundle') {
                    let costForDiscountCalc = totalMobileBaseCost;
                    if (totalMobileBaseCost === 0 && numMobileLines > 0) {
                        costForDiscountCalc = 37000;
                    }
                    let mobileTierKey = getMobileTierKey(costForDiscountCalc, numMobileLines, internetSpeedType);
                    
                    if (mobileTierKey && newKtDiscountRules.ì´ì•¡ê²°í•©í• ì¸?.[internetSpeedType]?.[bundleTypeForDiscountRule]?.[mobileTierKey]) {
                        internetDiscount = newKtDiscountRules.ì´ì•¡ê²°í•©í• ì¸[internetSpeedType][bundleTypeForDiscountRule][mobileTierKey];
                    } else if (internetSpeedType === "1G" && bundleTypeForDiscountRule === "TV" && newKtDiscountRules.ì´ì•¡ê²°í•©í• ì¸?.["1G"]?.TV?.["ëª¨ë°”ì¼_ê²°í•©ì‹œ"] && numMobileLines > 0) {
                        internetDiscount = newKtDiscountRules.ì´ì•¡ê²°í•©í• ì¸["1G"]["TV"]["ëª¨ë°”ì¼_ê²°í•©ì‹œ"];
                    }
                } else if (discountType === 'premiumFamilyBundle') {
                    const firstLineCost = numMobileLines > 0 ? mobileLinesData[0].cost : 0;
                    if (numMobileLines > 0 && firstLineCost >= 77000 && currentInternet.speed >= 500) {
                        const fullKey = (currentInternet.speed >= 1000 ? "1G" : "500M") + (isTvOrPhoneBundled ? "_TV" : "_ë‹¨ë…");
                        internetDiscount = newKtDiscountRules.í”„ë¦¬ë¯¸ì—„ê°€ì¡±ê²°í•©?.[fullKey] || 0;
                    }
                } else if (discountType === 'premiumSingleBundle') {
                    const singleLineCost = numMobileLines === 1 ? mobileLinesData[0].cost : 0;
                    if (singleLineCost >= 77000 && currentInternet.speed >= 500 && !isTvOrPhoneBundled) {
                        const speedKey = (currentInternet.speed === 500 ? "500M" : "1G") + "_ë‹¨ë…";
                        internetDiscount = newKtDiscountRules.í”„ë¦¬ë¯¸ì—„ì‹±ê¸€ê²°í•©?.[speedKey] || 0;
                    }
                } else if (discountType === 'mvnoBundle' || discountType === 'familyBundle') {
                    const fullKey = internetSpeedType + "_" + bundleTypeForDiscountRule;
                    const rule = discountType === 'mvnoBundle' ? newKtDiscountRules.ì•Œëœ°í°ê²°í•© : newKtDiscountRules.íŒ¨ë°€ë¦¬ê²°í•©;
                    internetDiscount = rule?.[fullKey] || 0;
                } else if (discountType === 'separateFamilyBundle') {
                    if (currentInternet.speed >= 500 && totalMobileBaseCost >= 37000) {
                        let mobileTierKey = getMobileTierKey(totalMobileBaseCost, numMobileLines, internetSpeedType);
                        if (mobileTierKey) {
                            if (newKtDiscountRules.ì´ì•¡ê²°í•©í• ì¸?.[internetSpeedType]?.[bundleTypeForDiscountRule]?.[mobileTierKey]) {
                                internetDiscount = newKtDiscountRules.ì´ì•¡ê²°í•©í• ì¸[internetSpeedType][bundleTypeForDiscountRule][mobileTierKey];
                            } else if (internetSpeedType === "1G" && bundleTypeForDiscountRule === "TV" && newKtDiscountRules.ì´ì•¡ê²°í•©í• ì¸?.["1G"]?.TV?.["ëª¨ë°”ì¼_ê²°í•©ì‹œ"] && numMobileLines > 0) {
                                internetDiscount = newKtDiscountRules.ì´ì•¡ê²°í•©í• ì¸["1G"]["TV"]["ëª¨ë°”ì¼_ê²°í•©ì‹œ"];
                            }
                        }
                        if (currentInternet.speed === 500) {
                            internetDiscount += 2200;
                            if (isTvOrPhoneBundled) {
                                currentTvDiscount = 2200;
                            }
                        } else if (currentInternet.speed >= 1000) {
                            internetDiscount += 3300;
                            if (isTvOrPhoneBundled) {
                                currentTvDiscount = 3300;
                            }
                        }
                    }
                }
                internetDiscount = Math.min(internetDiscount, internetBase);
        
                // --- START: Mobile Discount Calculation ---
                let totalAmountBundleMobileDiscount = 0;
                if (discountType === 'totalAmountBundle' && numMobileLines > 0) {
                    const internetSpeedKeyForJson = (currentInternet.speed >= 500) ? "500M_1G" : "100M";
                    let mobileTierKeyForJson = null;
                    if (totalMobileBaseCost < 22000) { mobileTierKeyForJson = "tier1_under_22000"; }
                    else if (totalMobileBaseCost < 64900) { mobileTierKeyForJson = "tier2_22000_to_64899"; }
                    else if (totalMobileBaseCost < 108900) { mobileTierKeyForJson = "tier3_64900_to_108899"; }
                    else if (totalMobileBaseCost < 141900) { mobileTierKeyForJson = "tier4_108900_to_141899"; }
                    else if (totalMobileBaseCost < 174900) { mobileTierKeyForJson = "tier5_141900_to_174899"; }
                    else { mobileTierKeyForJson = "tier6_over_174900"; }
                    const discountInfo = kt_total_mobile_fee_discounts[internetSpeedKeyForJson]?.[mobileTierKeyForJson];
                    if (discountInfo) {
                        totalAmountBundleMobileDiscount = discountInfo.mobile_discount || 0;
                    }
                }
        
                const totalAmountDiscountsByLine = new Array(numMobileLines).fill(0);
                if (discountType === 'totalAmountBundle' && totalAmountBundleMobileDiscount > 0 && totalMobileBaseCost > 0) {
                    let distributedDiscountSum = 0;
                    for (let i = 0; i < numMobileLines - 1; i++) {
                        const line = mobileLinesData[i];
                        const proportionalDiscount = Math.round(totalAmountBundleMobileDiscount * (line.cost / totalMobileBaseCost));
                        totalAmountDiscountsByLine[i] = proportionalDiscount;
                        distributedDiscountSum += proportionalDiscount;
                    }
                    if (numMobileLines > 0) {
                       totalAmountDiscountsByLine[numMobileLines - 1] = totalAmountBundleMobileDiscount - distributedDiscountSum;
                    }
                }
        
                let premiumFamilyProportionalDiscounts = new Map();
                if (discountType === 'premiumFamilyBundle' && numMobileLines > 0) {
                    const linesUnder77k = mobileLinesData
                        .map((line, index) => ({ ...line, originalIndex: index }))
                        .filter((line, index) => index > 0 && line.cost > 0 && line.cost < 77000);
        
                    if (linesUnder77k.length > 0 && mobileLinesData[0].cost > 0) {
                        const participatingLines = [{ ...mobileLinesData[0], originalIndex: 0 }, ...linesUnder77k];
                        const totalCostForSpecialCalc = participatingLines.reduce((sum, line) => sum + line.cost, 0);
                        
                        const internetSpeedKeyForJson = (currentInternet.speed >= 500) ? "500M_1G" : "100M";
                        let mobileTierKeyForJson = null;
                        if (totalCostForSpecialCalc < 22000) { mobileTierKeyForJson = "tier1_under_22000"; } 
                        else if (totalCostForSpecialCalc < 64900) { mobileTierKeyForJson = "tier2_22000_to_64899"; } 
                        else if (totalCostForSpecialCalc < 108900) { mobileTierKeyForJson = "tier3_64900_to_108899"; } 
                        else if (totalCostForSpecialCalc < 141900) { mobileTierKeyForJson = "tier4_108900_to_141899"; } 
                        else if (totalCostForSpecialCalc < 174900) { mobileTierKeyForJson = "tier5_141900_to_174899"; } 
                        else { mobileTierKeyForJson = "tier6_over_174900"; }
        
                        const discountInfo = kt_total_mobile_fee_discounts[internetSpeedKeyForJson]?.[mobileTierKeyForJson];
                        const totalMobileDiscountForGroup = discountInfo?.mobile_discount || 0;
        
                        if (totalMobileDiscountForGroup > 0) {
                            let distributedSum = 0;
                            participatingLines.filter(p => p.originalIndex !== 0).forEach(pLine => {
                                const discount = Math.round(totalMobileDiscountForGroup * (pLine.cost / totalCostForSpecialCalc));
                                premiumFamilyProportionalDiscounts.set(pLine.originalIndex, discount);
                                distributedSum += discount;
                            });
                            premiumFamilyProportionalDiscounts.set(0, totalMobileDiscountForGroup - distributedSum);
                        }
                    }
                }
        
                mobileLinesDetailsForScript = mobileLinesData.map((line, i) => {
                    if (line.cost === 0) {
                        return { ...line, selectiveDiscount: 0, bundleDiscount: 0, totalAmountLineDiscount: 0, finalBill: 0 };
                    }
                    let selectiveDiscount = line.applySelectiveContract ? Math.floor(line.cost * 0.25) : 0;
                    let bundleDiscount = 0;
                    let totalAmountLineDiscount = 0;
        
                    if (discountType === 'totalAmountBundle') {
                        totalAmountLineDiscount = totalAmountDiscountsByLine[i];
                    } else if (discountType === 'premiumFamilyBundle') {
                        if (premiumFamilyProportionalDiscounts.has(i)) {
                            bundleDiscount = premiumFamilyProportionalDiscounts.get(i);
                        } else {
                            if (i === 0 && line.cost >= 77000) {
                                bundleDiscount = 5500;
                            } else if (i >= 1 && line.cost >= 77000) {
                                bundleDiscount = Math.floor(line.cost * 0.25);
                            }
                        }
                    } else if (discountType === 'premiumSingleBundle') {
                        if (i === 0 && line.cost >= 77000) {
                            bundleDiscount = Math.floor(line.cost * 0.25);
                        }
                    }
        
                    const totalLineDiscount = selectiveDiscount + bundleDiscount + totalAmountLineDiscount;
                    const finalBill = line.cost - totalLineDiscount;
                    totalMobileDiscount += totalLineDiscount;
                    return { ...line, selectiveDiscount, bundleDiscount, totalAmountLineDiscount, finalBill };
                });
            }


            // --- 4. Calculate Final Costs and Gifts ---
            const totalPreDiscountCost = internetBase + actualWifiRouterFee + tvBase + additionalTvCost + phoneBase + addonServicesTotalCost;
            const finalMonthlyCost = (internetBase - internetDiscount) + actualWifiRouterFee + (tvBase - currentTvDiscount) + additionalTvCost + phoneBase + addonServicesTotalCost;
            
            // â–¼â–¼â–¼ NEW CALCULATION â–¼â–¼â–¼
            const finalCostWithCard = finalMonthlyCost - cardDiscountAmount;
            // â–²â–²â–² NEW CALCULATION â–²â–²â–²

            let giftCash = 0, giftVoucher = 0, giftPhoneVoucherAmount = 0, giftAdditionalTvAmount = 0, giftDongpanAdditionalCashAmount = 0;
            const reviewEventGift = 40000;
            const referralEventGift = 30000;

            if (internetPlanName !== 'none') {
                const internetSpeed = currentInternet.speed;
                const isTvSelectedForGift = tvPlanName !== 'none';
                const tvOptionForGift = Array.from(tvPlanEl.options).find(opt => opt.value === tvPlanName);
                const tvCategoryForGift = isTvSelectedForGift && tvOptionForGift ? (tvOptionForGift.dataset.category || "ë² ì´ì§") : "ë² ì´ì§";
                let giftKeyPrefix = "";
                if (!isTvSelectedForGift) {
                    if (internetSpeed === 100) giftKeyPrefix = "100ë‹¨ë…";
                    else if (internetSpeed === 500) giftKeyPrefix = "500ë‹¨ë…";
                    else if (internetSpeed >= 1000) giftKeyPrefix = "1Gë‹¨ë…";
                } else {
                    if (internetSpeed === 100) giftKeyPrefix = "100ë²ˆë“¤";
                    else if (internetSpeed === 500) giftKeyPrefix = "500ë²ˆë“¤";
                    else if (internetSpeed >= 1000) giftKeyPrefix = "ê¸°ê°€ë²ˆë“¤";
                }
                if (giftTable[tvCategoryForGift] && giftTable[tvCategoryForGift][giftKeyPrefix]) {
                    giftCash = giftTable[tvCategoryForGift][giftKeyPrefix].cash;
                    giftVoucher = giftTable[tvCategoryForGift][giftKeyPrefix].voucher;
                }
                if (isDongpanChecked && numMobileLines > 0) {
                    const isFamilyBundle = discountType === 'familyBundle';
                    const ownerType = isFamilyBundle ? "íŒ¨ë°€ë¦¬" : "ì¼ë°˜";
                    let productKey = "";
                    if (!isTvSelectedForGift) {
                        if (internetSpeed === 100) productKey = "100Mb ë‹¨ë…";
                        else if (internetSpeed === 500) productKey = "500Mb ë‹¨ë…";
                        else if (internetSpeed >= 1000) productKey = "1Gb ë‹¨ë…";
                    } else {
                        if (internetSpeed === 100) productKey = "100Mb+TV";
                        else if (internetSpeed === 500) productKey = "500Mb+TV";
                        else if (internetSpeed >= 1000) productKey = "1Gb+TV";
                    }

                    const maxDongpanLines = isTvSelectedForGift ? 3 : 1;
                    for (let i = 0; i < Math.min(numMobileLines, maxDongpanLines); i++) {
                        const mobileLineFee = mobileLinesData[i].cost;
                        let mobileFeeTierKey = null;
                        if (mobileLineFee >= 37000 && mobileLineFee < 61000) mobileFeeTierKey = "37K ìš”ê¸ˆì œ";
                        else if (mobileLineFee >= 61000 && mobileLineFee < 90000) mobileFeeTierKey = "61K ìš”ê¸ˆì œ";
                        else if (mobileLineFee >= 90000) mobileFeeTierKey = "90K ìš”ê¸ˆì œ";
                        
                        if (mobileFeeTierKey && productKey) {
                            const lookupKey = `${productKey} ${ownerType}`;
                            const rule = dongpanGiftRules_New[mobileFeeTierKey]?.[lookupKey];
                            if (rule) {
                                if (i === 0) { // First line
                                    const mainGift = parseInt(rule["ì¸í„°ë„· ëª…ì˜ì ì‚¬ì€í’ˆ"]?.["ìœ ì‹¬"] || 0);
                                    giftDongpanAdditionalCashAmount += mainGift;
                                } else { // Second and third lines
                                    const familyGiftRaw = rule["ê°€ì¡± ì‚¬ì€í’ˆ"];
                                    const familyGift = (typeof familyGiftRaw === 'number') ? familyGiftRaw : 0;
                                    giftDongpanAdditionalCashAmount += familyGift;
                                }
                            }
                        }
                    }
                }
            }
            if (phonePlanName !== 'none') giftPhoneVoucherAmount = 20000;
            if (additionalTvPlanKey !== 'none') giftAdditionalTvAmount = 30000;
            
            const confirmedGiftAmount = giftCash + giftVoucher + giftPhoneVoucherAmount + giftAdditionalTvAmount + giftDongpanAdditionalCashAmount;
            const maxGiftAmount = confirmedGiftAmount + reviewEventGift + referralEventGift;

            // --- 5. Installation Fee ---
            const installInfo = calculateInstallationFee(internetPlanName !== 'none', tvPlanName !== 'none', phonePlanName, additionalTvPlanKey !== 'none', installationTime);

            // --- 6. Return all results ---
            return {
                // Inputs
                internetPlanName, tvPlanName, additionalTvPlanKey, phonePlanName,
                selectedWifiName, selectedWifiData, discountType, numMobileLines, isDongpanChecked, installationTime,
                isPostApplied: ['totalAmountBundle', 'mvnoBundle', 'premiumFamilyBundle', 'premiumSingleBundle'].includes(discountType),
                // Costs
                totalPreDiscountCost, finalMonthlyCost, finalCostWithCard,
                internetBase, tvBase, additionalTvCost, phoneBase, addonServicesTotalCost, actualWifiRouterFee,
                // Discounts
                internetDiscount, currentTvDiscount, totalMobileDiscount, cardDiscountAmount, selectedCardData,
                // Mobile Details
                mobileLinesDetails: mobileLinesDetailsForScript,
                mobileDiscountDescription, // This needs to be generated based on mobileLinesDetailsForScript
                // Gifts
                giftCash, giftVoucher, giftPhoneVoucherAmount, giftAdditionalTvAmount, giftDongpanAdditionalCashAmount,
                confirmedGiftAmount, maxGiftAmount,
                // Installation
                installFee: installInfo.fee,
                installFeeDesc: installInfo.desc,
                // Other info
                currentInternet,
            };
        }

       /**
        * @description âœ¨ New: Updates all visible result elements on the page.
        * @param {object} results - The comprehensive results object from getCalculationResults.
        */
        function displayResults(results) {
            const {
                finalMonthlyCost, finalCostWithCard, totalPreDiscountCost, internetDiscount, currentTvDiscount, totalMobileDiscount,
                cardDiscountAmount, selectedCardData,
                maxGiftAmount, confirmedGiftAmount,
                internetPlanName, tvPlanName, additionalTvPlanKey, phonePlanName, selectedWifiName, selectedWifiData,
                numMobileLines, discountType, currentInternet,
                internetBase, tvBase, additionalTvCost, phoneBase, addonServicesTotalCost, actualWifiRouterFee,
                installFee, installFeeDesc, installationTime, mobileLinesDetails
            } = results;

            // Summary Card
            const costToShowInSummary = cardDiscountAmount > 0 ? finalCostWithCard : finalMonthlyCost;
            summaryFinalCostEl.textContent = `${costToShowInSummary.toLocaleString()} ì›`;
            if (cardDiscountAmount > 0) {
                summaryCardAppliedEl.textContent = `(${selectedCardData.name} ì ìš©ê°€)`;
            } else {
                summaryCardAppliedEl.textContent = '';
            }

            if (totalPreDiscountCost > finalMonthlyCost) {
                summaryPreDiscountCostEl.textContent = `í• ì¸ ì „ ${totalPreDiscountCost.toLocaleString()} ì›`;
                summaryPreDiscountCostEl.style.display = 'block';
            } else {
                summaryPreDiscountCostEl.style.display = 'none';
            }
            summaryInternetDiscountEl.textContent = `- ${(internetDiscount + currentTvDiscount).toLocaleString()} ì›`;
            summaryMobileDiscountEl.textContent = `- ${totalMobileDiscount.toLocaleString()} ì›`;
            summaryGiftTotalEl.textContent = `${maxGiftAmount.toLocaleString()} ì›`;
            document.getElementById('summaryGiftBreakdown').textContent = `(í™•ì • ${confirmedGiftAmount.toLocaleString()}ì› + ì°¸ì—¬ í˜œíƒ 70,000ì›)`;

            // Expanded Details
            const internetOption = Array.from(internetPlanEl.options).find(opt => opt.value === internetPlanName);
            selectedInternetEl.textContent = internetOption ? internetOption.text.split(" (")[0] : 'ë¯¸ì„ íƒ';
            const tvOption = Array.from(tvPlanEl.options).find(opt => opt.value === tvPlanName);
            selectedTvEl.textContent = tvOption && tvOption.value !=='none' ? tvOption.text.split(" (")[0] : 'ë¯¸ì„ íƒ';
            selectedAdditionalTvEl.textContent = additionalTvPlanKey !== 'none' ? additionalTvPlans_KT[additionalTvPlanKey].name : 'ë¯¸ì„ íƒ';
            const phoneOption = Array.from(phonePlanEl.options).find(opt => opt.value === phonePlanName);
            selectedPhoneEl.textContent = phoneOption && phoneOption.value !== 'none' ? phoneOption.text.split(" (")[0] : 'ë¯¸ì„ íƒ';
            selectedWifiEl.textContent = selectedWifiName || 'ë¯¸ì„ íƒ';
            selectedMobileCountEl.textContent = numMobileLines;

            if (selectedWifiData && selectedWifiData.promotion) {
                selectedWifiDetailsEl.innerHTML = `<p class="text-sm text-sky-700 mt-1">
                    ã„´ í”„ë¡œëª¨ì…˜: ${selectedWifiData.promotion}
                    ${selectedWifiData.url ? `<a href="${selectedWifiData.url}" target="_blank" class="font-semibold underline hover:text-sky-500 ml-2">[ì œí’ˆ ìƒì„¸ì •ë³´]</a>` : ''}
                </p>`;
            } else {
                selectedWifiDetailsEl.innerHTML = '';
            }

            const discountTypeMap = {
                none: "ê²°í•© í• ì¸ ì—†ìŒ", totalAmountBundle: "ì´ì•¡ ê²°í•©í• ì¸", premiumFamilyBundle: "í”„ë¦¬ë¯¸ì—„ ê°€ì¡±ê²°í•©",
                premiumSingleBundle: "í”„ë¦¬ë¯¸ì—„ ì‹±ê¸€ê²°í•©", mvnoBundle: "ì•Œëœ°í° ê²°í•©", familyBundle: "íŒ¨ë°€ë¦¬ ê²°í•© (ì¸í„°ë„· ì¶”ê°€íšŒì„ )",
                separateFamilyBundle: "ë”°ë¡œ ì‚´ì•„ë„ ê°€ì¡±ê²°í•©"
            };
            selectedDiscountTypeEl.textContent = discountTypeMap[discountType] || "ì•Œ ìˆ˜ ì—†ìŒ";

            detailInternetBaseEl.textContent = `${(internetBase + tvBase + additionalTvCost + phoneBase + addonServicesTotalCost).toLocaleString()} ì›`;
            detailWifiFeeEl.textContent = `${actualWifiRouterFee.toLocaleString()} ì›`;
            detailInternetDiscountTotalEl.textContent = `- ${(internetDiscount + currentTvDiscount).toLocaleString()} ì›`;
            detailFinalCostEl.textContent = `${finalMonthlyCost.toLocaleString()} ì›`;
            
            // â–¼â–¼â–¼ NEW DISPLAY LOGIC â–¼â–¼â–¼
            if (cardDiscountAmount > 0 && selectedCardData) {
                selectedCardNameEl.textContent = selectedCardData.name;
                detailCardDiscountEl.textContent = `- ${cardDiscountAmount.toLocaleString()} ì›`;
                detailFinalCardCostEl.textContent = `${finalCostWithCard.toLocaleString()} ì›`;
                detailCardDiscountContainerEl.classList.remove('hidden');
                detailFinalCardCostContainerEl.classList.remove('hidden');
                finalCardCostSeparatorEl.classList.remove('hidden');
            } else {
                detailCardDiscountContainerEl.classList.add('hidden');
                detailFinalCardCostContainerEl.classList.add('hidden');
                finalCardCostSeparatorEl.classList.add('hidden');
            }
            // â–²â–²â–² NEW DISPLAY LOGIC â–²â–²â–²

            // Mobile Discount Details
            let mobileDiscountHtml = '<div class="space-y-3">';
            if (mobileLinesDetails.length > 0 && mobileLinesDetails.some(l => l.cost > 0)) {
                 mobileLinesDetails.forEach(line => {
                    if (line.cost === 0) return;
                    let discountDetailString = '';
                    if (line.totalAmountLineDiscount > 0) discountDetailString += ` - ${line.totalAmountLineDiscount.toLocaleString()}ì›(ì´ì•¡í• ì¸)`;
                    if (line.bundleDiscount > 0) discountDetailString += ` - ${line.bundleDiscount.toLocaleString()}ì›(ê²°í•©)`;
                    if (line.selectiveDiscount > 0) discountDetailString += ` - ${line.selectiveDiscount.toLocaleString()}ì›(ì„ íƒì•½ì •)`;
                    mobileDiscountHtml += `<div class="p-2 border-t border-slate-200">
                        <p class="font-semibold">${line.name} (${line.cost.toLocaleString()}ì›)</p>
                        <p class="text-sm pl-2"> ã„´ ${line.cost.toLocaleString()}ì›${discountDetailString} = <strong class="text-blue-600">${line.finalBill.toLocaleString()}ì›</strong> 
                        <a href="${line.url}" target="_blank" class="text-blue-500 hover:underline">(ìƒì„¸)</a>
                        </p></div>`;
                });
            } else {
                mobileDiscountHtml += `<p>ê²°í•©ì— ë”°ë¥¸ ëª¨ë°”ì¼ í• ì¸ ì—†ìŒ.</p>`;
            }
            mobileDiscountHtml += '</div>';
            mobileDiscountDetailContainerEl.innerHTML = mobileDiscountHtml;


            // Gift Details
            giftCashEl.textContent = `${results.giftCash.toLocaleString()} ì›`;
            giftVoucherEl.textContent = `${results.giftVoucher.toLocaleString()} ì›`;
            giftPhoneVoucherEl.textContent = `${results.giftPhoneVoucherAmount.toLocaleString()} ì›`;
            giftAdditionalTvEl.textContent = `${results.giftAdditionalTvAmount.toLocaleString()} ì›`;
            dongpanCashContainerKtEl.classList.toggle('hidden', !results.isDongpanChecked || results.giftDongpanAdditionalCashAmount === 0);
            giftDongpanAdditionalCashKtEl.textContent = `${results.giftDongpanAdditionalCashAmount.toLocaleString()} ì›`;
            giftTotalEl.textContent = `${maxGiftAmount.toLocaleString()} ì›`;

            // Installation Fee
            installationFeeResultEl.textContent = `${installFee.toLocaleString()} ì›`;
            installationFeeDescriptionEl.textContent = `(${installFeeDesc}, ${installationTime === 'weekday' ? 'í‰ì¼ ì£¼ê°„' : 'ì£¼ë§/ì•¼ê°„'} ê¸°ì¤€)`;

            // Show sections
            resultSection.classList.remove('hidden');
            installationFeeSectionEl.classList.remove('hidden');
            messageScriptSectionEl.classList.remove('hidden');
            geminiScriptCardEl.classList.remove('hidden');
        }

       /**
        * @description âœ¨ New: Generates all customer-facing scripts based on calculation results.
        * @param {object} results - The comprehensive results object from getCalculationResults.
        */
        function generateAllScripts(results) {
            const {
                isPostApplied, installTime, discountType, isDongpanChecked, numMobileLines,
                totalPreDiscountCost, finalMonthlyCost, installFee,
                mobileLinesDetails, selectedWifiData, confirmedGiftAmount, maxGiftAmount,
                internetPlanName, tvPlanName, additionalTvPlanKey, phonePlanName,
                currentInternet, finalCostWithCard, cardDiscountAmount, selectedCardData
            } = results;

            // Generate Memo Script
            const internetOption = Array.from(internetPlanEl.options).find(opt => opt.value === internetPlanName);
            const internetPlanText = internetOption ? internetOption.text.split(' (')[0] : 'ì¸í„°ë„· ë¯¸ì„ íƒ';
            const tvOption = Array.from(tvPlanEl.options).find(opt => opt.value === tvPlanName);
            let firstTvText = "ë¯¸ì„ íƒ";
             if (tvOption && tvOption.value !== 'none' && tvPlans_KT[tvOption.value]) { 
                 firstTvText = `${tvOption.text.split(' (')[0]} + ${tvPlans_KT[tvOption.value].stbIncluded} ì…‹í†± ì„ëŒ€ í¬í•¨`;
             }
            const additionalTvText = additionalTvPlanKey !== 'none' ? ` + (ì¶”ê°€) ${additionalTvPlans_KT[additionalTvPlanKey].name}` : "";
            const phoneOption = Array.from(phonePlanEl.options).find(opt => opt.value === phonePlanName);
            let phoneText = "ë¯¸ì„ íƒ";
            if (phoneOption && phoneOption.value !== 'none' && phonePlans_KT[phoneOption.value]) {
                phoneText = phoneOption.text.split(' (')[0];
            }
            const wifiName = selectedWifiData ? selectedWifiData.name : "ë¯¸ì„ íƒ";

            let productDescriptionMemo = internetPlanText;
            if (wifiName !== "KTê³µìœ ê¸° X") productDescriptionMemo += ` + ${wifiName}`;
            if (tvOption && tvOption.value !== 'none') {
                const tvPlanInfo = tvPlans_KT[tvOption.value];
                if (tvPlanInfo) {
                    productDescriptionMemo += ` + ${tvOption.text.split(' (')[0]} + ${tvPlanInfo.stbIncluded}`;
                }
            }
            productDescriptionMemo += additionalTvText;
            if (phoneText !== "ë¯¸ì„ íƒ") productDescriptionMemo += ` + ${phoneText}`;
            
            const discountTypeName = selectedDiscountTypeEl.textContent;
            const mobilePlanNamesForMemo = mobileLinesDetails.filter(line => line.cost > 0).map(line => line.name).join(', ') || 'ì—†ìŒ';

            // â–¼â–¼â–¼ MODIFIED SCRIPT â–¼â–¼â–¼
            const finalCostForMemo = cardDiscountAmount > 0 ? finalCostWithCard : finalMonthlyCost;
            const cardInfoForMemo = cardDiscountAmount > 0 ? ` / (ì¹´ë“œì ìš©ê°€)${finalCostWithCard.toLocaleString()}ì›` : "";

            memoScriptEl.value = `[KT ë¯¸ì†Œ ìƒë‹´ ë©”ëª¨]
1. ìƒí’ˆ : ${productDescriptionMemo}
2. ìš”ê¸ˆ : (í• ì¸ì „)${totalPreDiscountCost.toLocaleString()}ì› / (í• ì¸í›„)${finalMonthlyCost.toLocaleString()}ì›${cardInfoForMemo}
3. ì‚¬ì€í’ˆ ì´ì•¡ : ${maxGiftAmount.toLocaleString()}ì› (í™•ì • ${confirmedGiftAmount.toLocaleString()}ì› + ì°¸ì—¬í˜œíƒ 7ë§Œì›) (ì˜ˆìƒ)
4. ì„¤ì¹˜ë¹„ : ${installFee.toLocaleString()}ì›
5. ê²°í•©ì ìš©ì‹œì : ${isPostApplied ? 'í›„ê²°í•©' : 'ì„ ê²°í•©'}
6. ê¸°íƒ€ : ì´ì‚¬ ì—¬ë¶€ [ ] / í¬ë§ì„¤ì¹˜ì¼ì [   ë…„  ì›”  ì¼]
7. í• ì¸ìœ í˜•: ${discountTypeName}
9. ëª¨ë°”ì¼ê²°í•©íšŒì„ : ${numMobileLines}ê°œ
10. ë™íŒíŒë§¤ê°€ì ìš©: ${isDongpanChecked ? 'Y' : 'N'}

--- ë™íŒ ì¶”ê°€ ì •ë³´ ---
ê³ ê°ëª… :
ë™íŒìœ ì„ ëª…ì˜ì :
ì—°ë½ì²˜ :
ê¸°ì¡´í†µì‹ ì‚¬ :
ìœ ì‹¬ë°œì†¡ì£¼ì†Œ :
ì„ íƒì•½ì •ì—¬ë¶€ (12ê°œì›”/24ê°œì›”) : 12ê°œì›”
ìš”ê¸ˆì œ : ${mobilePlanNamesForMemo}
ìœ ì‹¬ë¹„ í›„ì²­êµ¬ ë™ì˜ (Y/N) : Y
â˜… ê²°í•©ì—¬ë¶€ (í”„ë¦¬ë¯¸ì—„ê°€ì¡±/í”„ë¦¬ë¯¸ì—„ì‹±ê¸€/ì´ì•¡) : ${discountTypeName}
â˜… í• ì¸ì§€ì •(ì§€ì •í• ì¸orê¸°ì—¬ë„) : ê¸°ì—¬ë„
â˜… ë™íŒ ê²°í•©ì¸ì¦ (URL ì™„ë£Œì—¬ë¶€) : ì™„ë£Œ
â˜… íŒ¨ìŠ¤orì‹ ìš©ì¹´ë“œ ì¸ì¦ : íŒ¨ìŠ¤ì¸ì¦

--- í•„ìˆ˜ ì•ˆë‚´ì‚¬í•­ ---
ê³ ê° ìƒí™©ì—ë”°ë¥¸ í•„ìˆ˜ì•ˆë‚´ì‚¬í•­ ì™„ë£Œ
1.  ê¸°ì¡´ ê°€ì¡± ë˜ëŠ” ë³¸ì¸ ëª…ì˜ íšŒì„  ìˆëŠ” ê²½ìš° ìœ ì§€ í•„ìš” ì•ˆë‚´ ì™„ë£Œ
2.  ì´ì‚¬ ê³ ê° Y / ì¶”í›„ ì†Œëª… ë°œìƒ ì‹œ ê´€ë ¨ ì„œë¥˜ ì œì¶œ ë™ì˜ ìˆ˜ê¸
3.  ì¸í„°ë„· ì„¤ì¹˜ í›„ ê³ ê°ì„¼í„°ë¡œ í›„ê²°í•© ìš”ì²­ ì•ˆë‚´ ì™„ë£Œ`;
            // â–²â–²â–² MODIFIED SCRIPT â–²â–²â–²

            // Generate Info Script
            infoScriptEl.value = generateInfoScriptForPlan(results);

            // Generate Complete Script
            let productDescriptionComplete = [];
            if (internetPlanText !== 'ì¸í„°ë„· ë¯¸ì„ íƒ') {
                let internetLine = `â–¶ï¸ ${internetPlanText}`;
                if (wifiName !== "KTê³µìœ ê¸° X" && wifiName !== "ë¯¸ì„ íƒ") {
                    internetLine += ` + ${wifiName}`;
                }
                productDescriptionComplete.push(internetLine);
            }
            if (firstTvText !== "ë¯¸ì„ íƒ") {
                productDescriptionComplete.push(`â–¶ï¸ ${firstTvText}`);
            }
            if (additionalTvText) {
                productDescriptionComplete.push(`â–¶ï¸ ${additionalTvText.replace(' + ', '')}`);
            }
             if (phoneText !== "ë¯¸ì„ íƒ") {
                productDescriptionComplete.push(`â–¶ï¸ ${phoneText}`);
            }
        
            // â–¼â–¼â–¼ MODIFIED SCRIPT â–¼â–¼â–¼
            const finalCostForComplete = cardDiscountAmount > 0 ? finalCostWithCard : finalMonthlyCost;
            const cardInfoForComplete = cardDiscountAmount > 0 ? ` (${selectedCardData.name} ì ìš©ê°€)` : (discountType !== 'none' ? ' (ê²°í•© O)' : ' (ê²°í•© X)');

            let completeScriptContent = `[ë¯¸ì†Œ] ê°€ì… ì™„ë£Œ ì•ˆë‚´
ì•ˆë…•í•˜ì„¸ìš”, ê³ ê°ë‹˜.
ë¯¸ì†Œ ì¸í„°ë„· ë¶€ì„œì…ë‹ˆë‹¤.
âœ… ê³„ì•½ì´ ì™„ë£Œë˜ì—ˆì–´ìš”, ì•„ë˜ ë‚´ìš©ì€ ê³„ì•½ì„œì™€ ë™ì¼í•œ íš¨ë ¥ì´ ìˆìœ¼ë‹ˆ ê¼¼ê¼¼íˆ ì½ì–´ì£¼ì„¸ìš”.
âš ï¸ 3ë…„ ì•½ì •ì´ë©°, ì•„ë˜ì™€ ê°™ì€ ìƒí™©ì— í•´ë‹¹í•˜ë©´ ë°›ìœ¼ì…¨ë˜ ì‚¬ì€í’ˆì€ í™˜ìˆ˜ ë©ë‹ˆë‹¤.
â‘  1ë…„ ì´ë‚´ í•´ì§€
â‘¡ 3ê°œì›” (90ì¼) ì´ìƒ ì •ì§€
â‘¢ 1ë…„ ì´ë‚´ ìš”ê¸ˆì œ í•˜í–¥ (ìƒí–¥ ì‹œì—ëŠ” í™˜ìˆ˜ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤!)
â‘£ 3ê°œì›” ì´ë‚´ ëª…ì˜ë³€ê²½
â‘¤ ê°œí†µ 1ê°œì›” ì´ë‚´ ê²°ì œìˆ˜ë‹¨ ì§€ë¡œì²­êµ¬ì„œë¡œ ë³€ê²½
âš ï¸ ì‹ ê·œ ê°€ì… í›„ ê¸°ì¡´ì— ì¸í„°ë„·ì€ ê¼­ í•´ì§€ í•´ì£¼ì„¸ìš”. ìë™í•´ì§€ë˜ì§€ ì•Šìœ¼ë©° ì´ëŸ´ ê²½ìš° ìš”ê¸ˆì´ ì´ì¤‘ ë¶€ê³¼ë˜ì–´ìš”.
âš ï¸ 3ë…„ ì´ë‚´ í•´ì§€ ì‹œ í†µì‹ ì‚¬ ë³¸ì‚¬ì— ìœ„ì•½ê¸ˆ (í• ì¸ ë°˜í™˜ê¸ˆ) ë° í†µì‹ ì‚¬ì— ë”°ë¼ ë©´ì œëœ ì™€ì´íŒŒì´ / í†µì‹ ê¸°ê¸° ì„¤ì¹˜ë¹„ ë°˜í™˜ì´ í•„ìš”í•  ìˆ˜ ìˆì–´ìš”.
âœ… ê°€ì… ìƒí’ˆ ì•ˆë‚´
${productDescriptionComplete.join('\n')}
â–¶ï¸ ì›” ${finalCostForComplete.toLocaleString()}ì›${cardInfoForComplete}
â–¶ï¸ ì„¤ì¹˜ë¹„ ${installFee.toLocaleString()}ì› ì²« ë‹¬ ë¶€ê³¼
â–¶ï¸ ì‚¬ì€í’ˆ ${confirmedGiftAmount.toLocaleString()}ì› (í™•ì •)
âœ…ì‚¬ì€í’ˆì€ ì„¤ì¹˜ í›„ 7ì¼ ì´ë‚´ ìë™ìœ¼ë¡œ ì§€ê¸‰ë˜ë‚˜ í‰ì¼ê¸°ì¤€ 5ì‹œ ì´ì „ ê°œí†µ ë°›ì•˜ë‹¤ê³  ë¬¸ì ì£¼ì‹œë©´ ë‹¹ì¼ì…ê¸ˆ ë„ì›€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.`;
            // â–²â–²â–² MODIFIED SCRIPT â–²â–²â–²

            if (isPostApplied) {
                completeScriptContent += `

---
âš ï¸ [í•„ë…] ì›” ìš”ê¸ˆ í• ì¸ì„ ìœ„í•œ ë§ˆì§€ë§‰ ë‹¨ê³„!

ê³ ê°ë‹˜, ì„¤ì¹˜ í›„ 30ì¼ ì´ë‚´ì— ì§ì ‘ ê²°í•© ì‹ ì²­ì„ ì™„ë£Œí•˜ì…”ì•¼ ë§¤ë‹¬ ìš”ê¸ˆ í• ì¸ì´ ì ìš©ë©ë‹ˆë‹¤.
ì•„ë˜ ë²ˆí˜¸ë¡œ ì „í™”í•˜ì…”ì„œ "ì¸í„°ë„·ì´ë‘ íœ´ëŒ€í°(ë˜ëŠ” TV) ê²°í•© ì‹ ì²­í•©ë‹ˆë‹¤"ë¼ê³  ë§ì”€í•´ì£¼ì„¸ìš”!
(ê¸°í•œì´ ì§€ë‚˜ í• ì¸ì„ ë†“ì¹˜ì‹œëŠ” ì¼ì´ ì—†ë„ë¡ ì§€ê¸ˆ ë°”ë¡œ ì‹ ì²­í•˜ì‹œëŠ” ê²ƒì„ ê¶Œí•´ë“œë¦½ë‹ˆë‹¤.)

â–  KT ê³ ê°ë‹˜: íœ´ëŒ€í°ì—ì„œ 100ë²ˆìœ¼ë¡œ ì „í™”
---`;
            }

            completeScriptContent += `

[ë¯¸ì†Œë¥¼ ì†Œê°œí•´ì£¼ì„¸ìš”]
ì§€ì¸ì´ ë¯¸ì†Œì—ì„œ ì¸í„°ë„· ì„¤ì¹˜í•˜ë©´ ì†Œê°œí•´ì£¼ì‹  ë¶„ì—ê²Œ 3ë§Œì› ë“œë ¤ìš”.
â–¶ ì§€ì¸ì—ê²Œ ì¶”ì²œí•˜ê³  3O,OOOì› ë°›ê¸° (â†“)
https://get.miso.kr/pZbfsUPthzb
ë¯¸ì†Œ ì „ë‹´ ìƒë‹´ì‚¬ ê¹€í™ì‹ ë“œë¦¼.`;

            completeScriptEl.value = completeScriptContent;

            // Generate other static/persuasion scripts
            generatePersuasionScripts(currentInternet);
        }

       /**
        * @description âœ¨ New: Generates the content for the "Info Script" text area.
        * @param {object} results - The results object for a single plan.
        * @returns {string} The formatted script text.
        */
        function generateInfoScriptForPlan(results) {
            const { 
                internetPlanName, tvPlanName, additionalTvPlanKey, phonePlanName,
                selectedWifiData, mobileLinesDetails, finalMonthlyCost,
                confirmedGiftAmount, maxGiftAmount,
                finalCostWithCard, cardDiscountAmount, selectedCardData
            } = results;

            const discountTypeName = selectedDiscountTypeEl.textContent;

            const internetOption = Array.from(internetPlanEl.options).find(opt => opt.value === internetPlanName);
            const internetPlanText = internetOption ? internetOption.text.split(' (')[0] : 'ì¸í„°ë„· ë¯¸ì„ íƒ';
            
            const tvOption = Array.from(tvPlanEl.options).find(opt => opt.value === tvPlanName);
            let firstTvText = "ë¯¸ì„ íƒ";
            if (tvOption && tvOption.value !== 'none' && tvPlans_KT[tvOption.value]) { 
                firstTvText = `${tvOption.text.split(' (')[0]} + ${tvPlans_KT[tvOption.value].stbIncluded} ì…‹í†± ì„ëŒ€ í¬í•¨`;
            }
            const additionalTvText = additionalTvPlanKey !== 'none' ? ` + (ì¶”ê°€) ${additionalTvPlans_KT[additionalTvPlanKey].name}` : "";
            
            const phoneOption = Array.from(phonePlanEl.options).find(opt => opt.value === phonePlanName);
            let phoneText = "ë¯¸ì„ íƒ";
            if (phoneOption && phoneOption.value !== 'none') {
                phoneText = phoneOption.text.split(' (')[0];
            }

            let productDescriptionInfo = `[ìœ ì„  ìƒí’ˆ]
â–¶ï¸ ${internetPlanText}
â–¶ï¸ ${firstTvText !== 'ë¯¸ì„ íƒ' ? firstTvText : 'TV ë¯¸ì„ íƒ'}${additionalTvText}
â–¶ï¸ ${phoneText !== 'ë¯¸ì„ íƒ' ? phoneText : 'ì§‘ì „í™” ë¯¸ì„ íƒ'}`;
            
            if (selectedWifiData && selectedWifiData.name !== "KTê³µìœ ê¸° X") {
                productDescriptionInfo += `\nâ–¶ï¸ ${selectedWifiData.name}`;
                if (selectedWifiData.url) {
                    productDescriptionInfo += `\n   (ì •ë³´: ${selectedWifiData.url})`;
                }
            }
            
            const actualMobileLines = mobileLinesDetails.filter(line => line.cost > 0);
            if (actualMobileLines.length > 0) {
                productDescriptionInfo += `\n\n[ê²°í•© ëª¨ë°”ì¼]`;
                actualMobileLines.forEach(line => {
                    let discountText = '';
                    if (line.totalAmountLineDiscount > 0) discountText += ` - ${line.totalAmountLineDiscount.toLocaleString()} (ì´ì•¡)`;
                    if (line.bundleDiscount > 0) discountText += ` - ${line.bundleDiscount.toLocaleString()} (ê²°í•©)`;
                    if (line.selectiveDiscount > 0) discountText += ` - ${line.selectiveDiscount.toLocaleString()} (ì„ ì•½)`;
                    
                    productDescriptionInfo += `\nâ–¶ï¸ ${line.name} (${line.cost.toLocaleString()}ì›)${discountText} = ìµœì¢… ${line.finalBill.toLocaleString()}ì›`;
                    if (line.url) {
                        productDescriptionInfo += `\n   (ì •ë³´: ${line.url})`;
                    }
                });
            }

            // â–¼â–¼â–¼ MODIFIED SCRIPT â–¼â–¼â–¼
            let finalCostBlock = `[ìµœì¢… ìš”ê¸ˆ ë° í˜œíƒ]
â–¶ï¸ ì›” ${finalMonthlyCost.toLocaleString()}ì› (${discountTypeName})
â–¶ï¸ ì‚¬ì€í’ˆ ${confirmedGiftAmount.toLocaleString()}ì› (í™•ì •)`;
            
            if (cardDiscountAmount > 0 && selectedCardData) {
                const selectedCardTierEl = document.querySelector('input[name="cardTier"]:checked');
                const tierLabel = selectedCardTierEl.parentElement.textContent.trim().split(' (')[0];
                finalCostBlock += `

[ğŸ’³ ${selectedCardData.name} ì¶”ê°€ í• ì¸ìœ¼ë¡œ ë” ì €ë ´í•˜ê²Œ!]
ê³ ê°ë‹˜, ${selectedCardData.name}ìœ¼ë¡œ ê²°ì œí•˜ê³  ì „ì›” ${tierLabel} ì‚¬ìš© ì‹œ, ë§¤ë‹¬ ${cardDiscountAmount.toLocaleString()}ì›ì„ ì¶”ê°€ë¡œ ì•„ë¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!

ê¸°ì¡´ ì›” ${finalMonthlyCost.toLocaleString()}ì› - ì¹´ë“œ í• ì¸ ${cardDiscountAmount.toLocaleString()}ì›
= âœ¨ ìµœì¢… ì›” ë‚©ë¶€ì•¡ ${finalCostWithCard.toLocaleString()}ì›! âœ¨

* ë³¸ í• ì¸ì€ ì „ì›” ì‹¤ì  ì¶©ì¡± ì‹œ ì ìš©ë˜ë©°, ìì„¸í•œ ë‚´ìš©ì€ ${selectedCardData.name}(${selectedCardData.phone})ë¡œ ë¬¸ì˜ ë°”ëë‹ˆë‹¤.`;
            }
            // â–²â–²â–² MODIFIED SCRIPT â–²â–²â–²

            return `[ë¯¸ì†Œ] ìƒí’ˆ & ì‚¬ì€í’ˆ ìš”ì•½ ì•ˆë‚´
ì•ˆë…•í•˜ì„¸ìš”, ë¯¸ì†Œ ì¸í„°ë„· ì…ë‹ˆë‹¤.
ê³ ê°ë‹˜ê»˜ì„œ ì˜¤ëŠ˜ ìƒë‹´ ë°›ìœ¼ì‹  ìƒí’ˆ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
${productDescriptionInfo}

${finalCostBlock}
âœ¨ì°¸ì—¬ë§Œ í•´ë„ ìµœëŒ€ 7ë§Œì› ì¶”ê°€ í˜œíƒì´ ê¸°ë‹¤ë ¤ìš”!

ğŸ ìµœëŒ€ í˜œíƒ ê¸ˆì•¡
${maxGiftAmount.toLocaleString()} ì›
(í™•ì • ${confirmedGiftAmount.toLocaleString()}ì› + ì°¸ì—¬ í˜œíƒ 70,000ì›)

* í˜œíƒì€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°”ë€” ìˆ˜ ìˆë‹¤ëŠ” ì  ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
* 3ë…„ ì•½ì • ê¸°ì¤€
ë¯¸ì†Œ ë“œë¦¼.

[âœ¨ì¶”ê°€ í˜œíƒ ì´ë²¤íŠ¸ ìƒì„¸ ì•ˆë‚´âœ¨]
í˜œíƒ 1. ìƒìƒí•œ í›„ê¸° ë‚¨ê¸°ê³  í˜„ê¸ˆ ë°›ê¸°! (ìµœëŒ€ 4ë§Œì›)
ë¸”ë¡œê·¸, ì¸ìŠ¤íƒ€ê·¸ë¨ ë“± ê°œì¸ SNSì— ë¯¸ì†Œ ì¸í„°ë„· ì„¤ì¹˜ í›„ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”.
ì •ì„±ìŠ¤ëŸ¬ìš´ í›„ê¸°ë¥¼ ì‘ì„±í•´ì£¼ì‹  ëª¨ë“  ë¶„ê»˜ í˜„ê¸ˆ ì‚¬ì€í’ˆì„ ë“œë¦½ë‹ˆë‹¤!
(ì‚¬ì§„ê³¼ í•¨ê»˜ ê¼¼ê¼¼í•œ í›„ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì‹œë©´ ë‹¹ì²¨ í™•ë¥  UP!)

í˜œíƒ 2. ì¢‹ì€ ê±´ í•¨ê»˜! ì§€ì¸ ì¶”ì²œí•˜ê³  í˜„ê¸ˆ ë°›ê¸°! (ìµœëŒ€ 3ë§Œì›)
ì£¼ë³€ì— ì¸í„°ë„· ê°€ì…ì„ ê³ ë¯¼í•˜ëŠ” ì¹œêµ¬ë‚˜ ê°€ì¡±ì´ ìˆë‹¤ë©´ ë¯¸ì†Œë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”!
ì§€ì¸ë¶„ì´ ê³ ê°ë‹˜ ì¶”ì²œìœ¼ë¡œ ê°€ì… ë° ì„¤ì¹˜ë¥¼ ì™„ë£Œí•˜ì‹œë©´, ë‘ ë¶„ ëª¨ë‘ì—ê²Œ í˜„ê¸ˆ ì‚¬ì€í’ˆì„ ë“œë¦½ë‹ˆë‹¤.

â–¶ï¸ ì°¸ì—¬ ë°©ë²•
1. SNSì— í›„ê¸°ë¥¼ ì‘ì„±í•˜ì‹  í›„, í•´ë‹¹ ë§í¬ë¥¼ ì €í¬ì—ê²Œ ë¬¸ìë¡œ ë³´ë‚´ì£¼ì„¸ìš”.
2. ì§€ì¸ ì¶”ì²œ ì‹œ, ì§€ì¸ë¶„ê»˜ì„œ ìƒë‹´ ê³¼ì •ì—ì„œ 'OOOë‹˜ ì¶”ì²œ'ì´ë¼ê³  ê¼­ ë§ì”€í•´ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.

ê¶ê¸ˆí•œ ì ì€ ì–¸ì œë“  í¸í•˜ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.
ê³ ê°ë‹˜ì˜ ë§ì€ ì°¸ì—¬ë¥¼ ê¸°ë‹¤ë¦¬ê² ìŠµë‹ˆë‹¤! â¤ï¸`;
        }

       /**
        * @description âœ¨ New: Generates and displays the 100M vs 500M comparison script.
        */
        function generateComparisonScript() {
            try {
                // Determine the correct plan names based on the current selection (bundle/standalone)
                const isBundleType = document.querySelector('input[name="internetType"]:checked').value === 'bundle';
                const planName100M = isBundleType ? "KTì¸í„°ë„·ë²ˆë“¤100mb" : "KTì¸í„°ë„·(ë‹¨ë…) 100mb";
                const planName500M = isBundleType ? "KTì¸í„°ë„·ë²ˆë“¤500mb" : "KTì¸í„°ë„·(ë‹¨ë…) 500mb";

                // Get full calculation results for both scenarios
                const results100M = getCalculationResults({ forcedInternetPlanName: planName100M });
                const results500M = getCalculationResults({ forcedInternetPlanName: planName500M });

                if (!results100M || !results500M) {
                    throw new Error("ê²°ê³¼ë¥¼ ê³„ì‚°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }

                // Generate the specific script block for each result
                const scriptBlock100M = generateSimpleProductScript(results100M);
                const scriptBlock500M = generateSimpleProductScript(results500M);

                // Calculate differences
                const cost100M = results100M.cardDiscountAmount > 0 ? results100M.finalCostWithCard : results100M.finalMonthlyCost;
                const cost500M = results500M.cardDiscountAmount > 0 ? results500M.finalCostWithCard : results500M.finalMonthlyCost;
                const monthlyCostDifference = cost500M - cost100M;
                const giftDifference = results500M.confirmedGiftAmount - results100M.confirmedGiftAmount;

                // Assemble the final comparison script
                const comparisonScript = `[ë¯¸ì†Œ] 100Mbps vs 500Mbps ìƒí’ˆ ë¹„êµ ì•ˆë‚´

ê³ ê°ë‹˜ê»˜ì„œ ì„ íƒí•˜ì‹  ì˜µì…˜ ê¸°ì¤€ìœ¼ë¡œ, ì¸í„°ë„· ì†ë„ë§Œ ë³€ê²½í–ˆì„ ë•Œì˜ ìš”ê¸ˆê³¼ í˜œíƒì„ ë¹„êµí•´ ë“œë¦½ë‹ˆë‹¤.

----- 100M -----
${scriptBlock100M}
--------------------

----- 500M -----
${scriptBlock500M}
--------------------

ê³ ê°ë‹˜, í˜¹ì‹œ ì•Œê³  ê³„ì…¨ë‚˜ìš”?
ì§€ê¸ˆ ì„ íƒí•˜ì‹  100Mbps ìš”ê¸ˆì— ì›” ${monthlyCostDifference.toLocaleString()}ì›ë§Œ ì¶”ê°€í•˜ì‹œë©´,
âœ… ì¸í„°ë„· ì†ë„ëŠ” 5ë°° ë¹¨ë¼ì§€ê³ ,
âœ… ì²« ë‹¬ì— ë°›ìœ¼ì‹œëŠ” ì‚¬ì€í’ˆì€ ${(giftDifference / 10000).toLocaleString()}ë§Œì› ë” ì»¤ì§‘ë‹ˆë‹¤!

ì˜¨ ê°€ì¡±ì´ ë™ì‹œì— ì ‘ì†í•´ë„ ëŠê¹€ ì—†ëŠ” 500Mbps ìƒí’ˆìœ¼ë¡œ ë³€ê²½ ì›í•˜ì‹œë©´ í¸í•˜ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”. ğŸ˜Š`;

                // Update the text area
                infoScriptEl.value = comparisonScript.trim();
                // alert('100M vs 500M ë¹„êµ ìŠ¤í¬ë¦½íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error("ë¹„êµ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜:", error);
                infoScriptEl.value = "ë¹„êµ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì„ íƒ í•­ëª©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
            }
        }

       /**
        * @description âœ¨ New Helper: Generates a simplified product info block for the comparison script.
        * @param {object} results - A single calculation result object.
        * @returns {string} A formatted string block.
        */
        function generateSimpleProductScript(results) {
            const { 
                internetPlanName, tvPlanName, additionalTvPlanKey, phonePlanName, selectedWifiData,
                finalMonthlyCost, confirmedGiftAmount,
                finalCostWithCard, cardDiscountAmount
            } = results;

            const internetOption = Array.from(internetPlanEl.options).find(opt => opt.value === internetPlanName);
            const internetPlanText = internetOption ? internetOption.text.split(' (')[0] : 'ì¸í„°ë„· ë¯¸ì„ íƒ';
            
            const tvOption = Array.from(tvPlanEl.options).find(opt => opt.value === tvPlanName);
            let firstTvText = "ë¯¸ì„ íƒ";
            if (tvOption && tvOption.value !== 'none' && tvPlans_KT[tvOption.value]) {
                firstTvText = tvOption.text.split(' (')[0];
            }
            const additionalTvText = additionalTvPlanKey !== 'none' ? ` + (ì¶”ê°€) ${additionalTvPlans_KT[additionalTvPlanKey].name}` : "";
            
            const phoneOption = Array.from(phonePlanEl.options).find(opt => opt.value === phonePlanName);
            let phoneText = "ë¯¸ì„ íƒ";
            if (phoneOption && phoneOption.value !== 'none') {
                phoneText = phoneOption.text.split(' (')[0];
            }

            let desc = `[ìœ ì„  ìƒí’ˆ]
â–¶ï¸ ${internetPlanText}
â–¶ï¸ ${firstTvText !== 'ë¯¸ì„ íƒ' ? firstTvText : 'TV ë¯¸ì„ íƒ'}${additionalTvText}
â–¶ï¸ ${phoneText !== 'ë¯¸ì„ íƒ' ? phoneText : 'ì§‘ì „í™” ë¯¸ì„ íƒ'}`;

            if (selectedWifiData && selectedWifiData.name !== "KTê³µìœ ê¸° X") {
                desc += `\nâ–¶ï¸ ${selectedWifiData.name}`;
            }

            const finalCostToShow = cardDiscountAmount > 0 ? finalCostWithCard : finalMonthlyCost;

            desc += `\n\n[ìµœì¢… ìš”ê¸ˆ ë° í˜œíƒ]
â–¶ï¸ ì›” ${finalCostToShow.toLocaleString()}ì› (${selectedDiscountTypeEl.textContent})
â–¶ï¸ ì‚¬ì€í’ˆ ${confirmedGiftAmount.toLocaleString()}ì› (í™•ì •)`;
            
            return desc;
        }

        function copyToClipboard(elementId, feedbackElementId) {
            const textarea = document.getElementById(elementId);
            if (!textarea) return;
            textarea.select();
            textarea.setSelectionRange(0, 99999);
            try {
                document.execCommand('copy');
                const feedbackEl = document.getElementById(feedbackElementId);
                if (feedbackEl) feedbackEl.textContent = 'ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!';
                setTimeout(() => { if (feedbackEl) feedbackEl.textContent = ''; }, 2000);
            } catch (err) {
                const feedbackEl = document.getElementById(feedbackElementId);
                if (feedbackEl) feedbackEl.textContent = 'ë³µì‚¬ ì‹¤íŒ¨';
                setTimeout(() => { if (feedbackEl) feedbackEl.textContent = ''; }, 2000);
            }
            window.getSelection().removeAllRanges();
        }
        
        function setInitialDefaults() {
            document.querySelector('input[name="internetType"][value="standalone"]').checked = true;
            populateInternetPlans();
            internetPlanEl.value = "KTì¸í„°ë„·(ë‹¨ë…) 100mb";
            
            tvPlanEl.value = "none";
            additionalTvPlanEl.value = "none";
            phonePlanEl.value = "none";
            wifiRouterRentalEl.value = "1100";
            wifiRouterRentalEl.disabled = false;
        
            const addonCheckboxes = document.querySelectorAll('#addonServicesContainer input[type="checkbox"]');
            addonCheckboxes.forEach(cb => cb.checked = false);
        
            document.querySelector('input[name="discountType"][value="totalAmountBundle"]').checked = true;
            
            document.querySelector('input[name="installationTime"][value="weekday"]').checked = true;
            if (dongpanSalesCheckKtEl) {
                dongpanSalesCheckKtEl.checked = false;
                if(dongpanPolicyDetailsContainerKtEl) dongpanPolicyDetailsContainerKtEl.classList.add('hidden');
            }

            // â–¼â–¼â–¼ NEW LOGIC ADDED â–¼â–¼â–¼
            affiliateCardEl.value = 'none';
            cardTierContainerEl.classList.add('hidden');
            cardTiersEl.innerHTML = '';
            // â–²â–²â–² NEW LOGIC ADDED â–²â–²â–²
        
            allDetailSections.forEach(section => {
                if (section.containerEl && section.toggleEl) {
                    const isSelected = document.querySelector(`input[name="discountType"][value="${section.radioValue}"]`).checked;
                    let shouldBeVisible = false;
                    if (isSelected) {
                        section.toggleEl.checked = false;
                        shouldBeVisible = section.toggleEl.checked;
                    } else {
                        section.toggleEl.checked = false;
                    }
                    section.containerEl.classList.toggle('hidden', !shouldBeVisible);
                }
            });
        
            document.querySelector('input[name="internetType"]:checked').dispatchEvent(new Event('change'));
            document.querySelector('input[name="discountType"]:checked').dispatchEvent(new Event('change'));
            
            document.querySelectorAll('.selective-contract-checkbox').forEach(cb => cb.checked = false);
            updateDiscountTypeAvailability();
        }
        
        function resetCalculator() {
            setInitialDefaults();
            resultSection.classList.add('hidden');
            installationFeeSectionEl.classList.add('hidden');
            messageScriptSectionEl.classList.add('hidden');
            geminiScriptCardEl.classList.add('hidden');
            expandedDetailsContainer.classList.add('hidden');
            toggleDetailsButton.innerHTML = 'ìƒì„¸ ìš”ê¸ˆ ë‚´ì—­ í¼ì³ë³´ê¸° â–¼';
            if(selectedWifiDetailsEl) selectedWifiDetailsEl.innerHTML = '';
            window.scrollTo(0, 0);
        }
        
        function updateDiscountTypeAvailability() {
            const internetOption = internetPlanEl.options[internetPlanEl.selectedIndex];
            const internetSpeed = internetOption.value !== 'none' ? parseInt(internetOption.dataset.speed) : 0;

            let totalMobileCost = 0;
            document.querySelectorAll('.mobile-line-item').forEach((item, i) => {
                const select = item.querySelector(`#mobilePlan${i}`);
                totalMobileCost += parseInt(select.value) || 0;
            });

            const separateFamilyRadio = document.querySelector('input[name="discountType"][value="separateFamilyBundle"]');
            const separateFamilyLabel = separateFamilyRadio.parentElement;

            const isEligible = internetSpeed >= 500 && totalMobileCost >= 37000;

            if (isEligible) {
                separateFamilyRadio.disabled = false;
                separateFamilyLabel.classList.remove('text-slate-400', 'cursor-not-allowed');
            } else {
                separateFamilyRadio.disabled = true;
                separateFamilyLabel.classList.add('text-slate-400', 'cursor-not-allowed');
                if (separateFamilyRadio.checked) {
                    document.querySelector('input[name="discountType"][value="totalAmountBundle"]').checked = true;
                }
            }
        }

        async function callGeminiAPI(promptType) {
            geminiLoadingEl.classList.remove('hidden');
            geminiResultContainerEl.classList.add('hidden');

            const apiKey = ""; // Canvas will provide the key

            const internetOption = internetPlanEl.options[internetPlanEl.selectedIndex];
            const internetPlanText = internetOption.value !== 'none' ? internetOption.text.split(' (')[0] : 'ì¸í„°ë„· ë¯¸ì„ íƒ';
            const tvOption = tvPlanEl.options[tvPlanEl.selectedIndex];
            let firstTvText = tvOption.value !== 'none' ? tvOption.text.split(' (')[0] : '';
            
            let internetDescription = internetPlanText;
            if(firstTvText) {
                internetDescription += ` + ${firstTvText}`;
            }

            const finalMonthlyCost = parseInt(document.getElementById('summaryFinalCost').textContent.replace(/[^0-9]/g, '')) || 0;
            const maxGiftAmountText = document.getElementById('summaryGiftTotal').textContent.trim();
            const giftBreakdownText = document.getElementById('summaryGiftBreakdown').textContent.trim();
            const discountTypeName = document.getElementById('selectedDiscountType').textContent;

            let systemPrompt = "";
            let userQuery = "";

            if (promptType === 'persuasion') {
                systemPrompt = "ë‹¹ì‹ ì€ ëŒ€í•œë¯¼êµ­ ìµœê³ ì˜ KT ì¸í„°ë„· ì˜ì—… ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ê³ ê° ìƒë‹´ í›„, ê°€ì…ì„ ë§ì„¤ì´ëŠ” ê³ ê°ì—ê²Œ ë³´ë‚¼ ì§§ê³  ì¹œê·¼í•˜ë©° ì„¤ë“ë ¥ ìˆëŠ” ë¬¸ì ë©”ì‹œì§€ë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì´ ë‹¹ì‹ ì˜ ì„ë¬´ì…ë‹ˆë‹¤. ì œê³µëœ í•µì‹¬ í˜œíƒì„ ë°”íƒ•ìœ¼ë¡œ, ìƒí’ˆì˜ ê°€ì¹˜ë¥¼ ë¶€ë“œëŸ½ê²Œ ê°•ì¡°í•˜ì—¬ ê³ ê°ì´ ê°€ì…ì„ ì™„ë£Œí•˜ë„ë¡ ìœ ë„í•´ì£¼ì„¸ìš”. ë”±ë”±í•œ ê´‘ê³ ê°€ ì•„ë‹Œ, ë°”ë¡œ ì˜†ì—ì„œ ì±™ê²¨ì£¼ëŠ” ë“¯í•œ ìì—°ìŠ¤ëŸ¬ìš´ í†¤ì„ ìœ ì§€í•˜ì„¸ìš”. ëª¨ë“  ì‘ë‹µì€ ë°˜ë“œì‹œ '[ë¯¸ì†Œ] ê³ ê°ë‹˜, ì•ˆë…•í•˜ì„¸ìš”! KTë¯¸ì†Œ ì¸í„°ë„·ì…ë‹ˆë‹¤ ğŸ˜Š' ë¼ëŠ” ë¬¸êµ¬ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤.";
                userQuery = `ê³ ê° í˜œíƒ ì •ë³´:\n- ì¸í„°ë„·/TV ìƒí’ˆ: ${internetDescription}\n- ìµœì¢… ì›” ìš”ê¸ˆ: ${finalMonthlyCost.toLocaleString()}ì›\n- ìµœëŒ€ ì‚¬ì€í’ˆ í˜œíƒ: ${maxGiftAmountText} ${giftBreakdownText}\n- í•µì‹¬ í• ì¸: ${discountTypeName}\n\nìœ„ ì •ë³´ë¥¼ í™œìš©í•˜ì—¬ ê³ ê°ì´ "ì•„, ì •ë§ ì¢‹ì€ í˜œíƒì´êµ¬ë‚˜"ë¼ê³  ëŠë¼ê³  ê°€ì…ì„ ë§ˆë¬´ë¦¬í•˜ê³  ì‹¶ê²Œ ë§Œë“œëŠ” ë¬¸ì ë©”ì‹œì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”. ì‚¬ì€í’ˆ í˜œíƒì„ ì–¸ê¸‰í•  ë•ŒëŠ” ë°˜ë“œì‹œ "ğŸ ìµœëŒ€ í˜œíƒ ê¸ˆì•¡\n${maxGiftAmountText}\n${giftBreakdownText}" í˜•ì‹ì„ í¬í•¨ì‹œì¼œ ì£¼ì„¸ìš”.`;
            } else if (promptType === 'happycall') {
                systemPrompt = "ë‹¹ì‹ ì€ ëŒ€í•œë¯¼êµ­ ìµœê³ ì˜ KT ì¸í„°ë„· ì„¤ì¹˜ í›„ ê³ ê° ê´€ë¦¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì¸í„°ë„· ì„¤ì¹˜ë¥¼ ë§‰ ë§ˆì¹œ ê³ ê°ì—ê²Œ ë³´ë‚¼ ì¹œì ˆí•˜ê³  ë”°ëœ»í•œ 'í•´í”¼ì½œ' ë¬¸ì ë©”ì‹œì§€ë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì´ ë‹¹ì‹ ì˜ ì„ë¬´ì…ë‹ˆë‹¤. ì¸í„°ë„·ì€ ì˜ ì‚¬ìš©í•˜ê³  ê³„ì‹ ì§€ í™•ì¸í•˜ê³ , ê³ ê°ì´ ì„ íƒí•œ ìƒí’ˆì˜ í•µì‹¬ í˜œíƒ(ì €ë ´í•œ ì›” ìš”ê¸ˆ, ë†’ì€ ì‚¬ì€í’ˆ)ì„ ë‹¤ì‹œ í•œë²ˆ ìƒê¸°ì‹œì¼œì£¼ë©° 'ì¢‹ì€ ì„ íƒ'ì„ í–ˆë‹¤ëŠ” í™•ì‹ ì„ ì£¼ì„¸ìš”. ë§ˆì§€ë§‰ìœ¼ë¡œ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ë©´ ì–¸ì œë“  í¸í•˜ê²Œ ì—°ë½ ë‹¬ë¼ëŠ” ë‚´ìš©ìœ¼ë¡œ ë§ˆë¬´ë¦¬í•´ì£¼ì„¸ìš”. ì „ì²´ì ìœ¼ë¡œ ë”°ëœ»í•˜ê³  ê³ ê°ì„ ì±™ê¸°ëŠ” ëŠë‚Œì´ ë“œëŸ¬ë‚˜ì•¼ í•©ë‹ˆë‹¤. ëª¨ë“  ì‘ë‹µì€ ë°˜ë“œì‹œ '[ë¯¸ì†Œ] ê³ ê°ë‹˜, ì•ˆë…•í•˜ì„¸ìš”! KTë¯¸ì†Œ ì¸í„°ë„·ì…ë‹ˆë‹¤ ğŸ˜Š' ë¼ëŠ” ë¬¸êµ¬ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤.";
                 userQuery = `ê³ ê° ê°€ì… ì •ë³´:\n- ì„¤ì¹˜ëœ ìƒí’ˆ: ${internetDescription}\n- í™•ì •ëœ ì›” ìš”ê¸ˆ: ${finalMonthlyCost.toLocaleString()}ì›\n- ì§€ê¸‰ëœ ì‚¬ì€í’ˆ ìƒì„¸: ${maxGiftAmountText} ${giftBreakdownText}\n\nìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ì„¤ì¹˜ëŠ” ì˜ ëëŠ”ì§€ í™•ì¸í•˜ê³  ê³ ê°ì´ ë°›ì€ í˜œíƒì„ ë‹¤ì‹œ í•œë²ˆ ì§šì–´ì£¼ì–´ ë§Œì¡±ê°ì„ ë†’ì´ëŠ” í•´í”¼ì½œ ë¬¸ì ë©”ì‹œì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”. ì‚¬ì€í’ˆ í˜œíƒì„ ì–¸ê¸‰í•  ë•ŒëŠ” ë°˜ë“œì‹œ "ğŸ ìµœëŒ€ í˜œíƒ ê¸ˆì•¡\n${maxGiftAmountText}\n${giftBreakdownText}" í˜•ì‹ì„ í¬í•¨ì‹œì¼œ ì£¼ì„¸ìš”.`;
            }

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: userQuery
                            }]
                        }],
                        systemInstruction: {
                            parts: [{
                                text: systemPrompt
                            }]
                        }
                    }),
                });

                if (!response.ok) {
                    throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status}`);
                }

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                geminiResultTextareaEl.value = text;
                geminiResultContainerEl.classList.remove('hidden');

            } catch (error) {
                console.error("Gemini API Error:", error);
                geminiResultTextareaEl.value = "AI ë¬¸ì ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
                geminiResultContainerEl.classList.remove('hidden');
            } finally {
                geminiLoadingEl.classList.add('hidden');
            }
        }

        function generatePersuasionScripts(currentInternet) {
            const internetSpeed = currentInternet.speed;
            let tcoScript = `[ë¯¸ì†Œ] 3ë…„ ì•½ì •ì´ ë¶€ë‹´ìŠ¤ëŸ¬ìš°ì‹ ê°€ìš”?\n1ë…„ë§Œ ì¨ë„ ë” ì´ë“ì¸ ì´ìœ , ì •í™•íˆ ë¹„êµí•´ ë“œë¦´ê²Œìš”!\n\nì•ˆë…•í•˜ì„¸ìš”, ê³ ê°ë‹˜.\nì•½ì • ê¸°ê°„ ë•Œë¬¸ì— ê³ ë¯¼í•˜ì‹œëŠ” ë§ˆìŒ ì¶©ë¶„íˆ ì´í•´í•©ë‹ˆë‹¤.\n\nê·¸ë˜ì„œ KT ê³µì‹ ì•½ê´€ ê¸°ì¤€ìœ¼ë¡œ, 1ë…„ ì•½ì •ê³¼ 3ë…„ ì•½ì •ì˜ ì‹¤ì œ ì´ë¹„ìš©(TCO)ì„ ê¼¼ê¼¼í•˜ê²Œ ë¹„êµí•´ ë“œë ¸ìŠµë‹ˆë‹¤.\n\në†€ëê²Œë„, 3ë…„ ì•½ì •ì€ 1ë…„(13ê°œì›”)ë§Œ ì‚¬ìš©í•˜ê³  í•´ì§€í•´ë„ 1ë…„ ì•½ì •ë³´ë‹¤ í›¨ì”¬ ì €ë ´í•©ë‹ˆë‹¤.\nì‹¬ì§€ì–´ 1ë…„ 6ê°œì›”(18ê°œì›”) ì‚¬ìš© ì‹œ í˜œíƒ ì°¨ì´ëŠ” ë” ì»¤ì§‘ë‹ˆë‹¤.`;
            let penaltyScript = `[ë¯¸ì†Œ] KT ìœ„ì•½ê¸ˆ, ì •í™•í•œ ê³„ì‚° ë°©ì‹ì´ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?\nê³ ê°ë‹˜ì˜ ì•Œ ê¶Œë¦¬ë¥¼ ìœ„í•´, KTì˜ ê³µì‹ í• ì¸ë°˜í™˜ê¸ˆ(ìœ„ì•½ê¸ˆ) ì‚°ì • ë°©ì‹ì„ íˆ¬ëª…í•˜ê²Œ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.\n\n**1. KTì˜ ìƒˆë¡œìš´ ìœ„ì•½ê¸ˆ ê³µì‹**\nKTëŠ” ì•„ë˜ ê³µì‹ì— ë”°ë¼ ìœ„ì•½ê¸ˆì„ ì‚°ì •í•©ë‹ˆë‹¤.\nâ–¶ ìœ„ì•½ê¸ˆ = (ì´ í• ì¸ë°›ì€ ê¸ˆì•¡) x (1 - ê°ë©´ìœ¨)\n- ì´ í• ì¸ì•¡: (ì •ìƒê°€-ì•½ì •ê°€) x ì´ìš© ê°œì›” ìˆ˜\n- ê°ë©´ìœ¨: ì•½ì • ê¸°ê°„ì„ ì±„ìš¸ìˆ˜ë¡ ìœ„ì•½ê¸ˆì„ ê¹ì•„ì£¼ëŠ” ë¹„ìœ¨\n\n**2. ê¼­ ì•„ì…”ì•¼ í•  í•µì‹¬ í¬ì¸íŠ¸ 1: '180ì¼'ì˜ ë¹„ë°€**\nKT ì•½ê´€ìƒ, ê°€ì… í›„ ì²« 6ê°œì›”(180ì¼) ë™ì•ˆì€ ìœ„ì•½ê¸ˆ ê°ë©´ì´ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ ê¸°ê°„ì—ëŠ” í• ì¸ë°›ì€ ê¸ˆì•¡ì´ ê·¸ëŒ€ë¡œ ìœ„ì•½ê¸ˆìœ¼ë¡œ ëˆ„ì ë˜ì–´, ì´ˆë°˜ í•´ì§€ ì‹œ ë¶€ë‹´ì´ ê°€ì¥ í½ë‹ˆë‹¤.\n\n**3. ê¼­ ì•„ì…”ì•¼ í•  í•µì‹¬ í¬ì¸íŠ¸ 2: '18ê°œì›”'ì˜ ìµœê³ ì ê³¼ ê·¸ ì´í›„**\nìœ„ì•½ê¸ˆì€ ì•½ì • ê¸°ê°„ì˜ ì ˆë°˜ì¸ 18ê°œì›” ì°¨ì— ìµœê³ ì ì— ë„ë‹¬í•˜ê³ , ê·¸ ì´í›„ë¶€í„°ëŠ” ê°ë©´ìœ¨ì´ í¬ê²Œ ë†’ì•„ì ¸ ìœ„ì•½ê¸ˆì´ ê³„ì†í•´ì„œ ê°ì†Œí•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.`;

            if (internetSpeed === 100) {
                tcoScript += `\n\n[ì¸í„°ë„· ë‹¨ë… (100Mbps) ì´ë¹„ìš© ë¹„êµ]\n--------------------------------\nğŸ†š 1ë…„ ì•½ì •\n- ì›” ìš”ê¸ˆ: 34,650ì›\n- 13ê°œì›” ì´ë¹„ìš©: ì•½ 450,450ì›\n- 18ê°œì›” ì´ë¹„ìš©: ì•½ 623,700ì›\n\nâœ… 3ë…„ ì•½ì • (ì¤‘ë„ í•´ì§€ ì‹œ)\n- ì›” ìš”ê¸ˆ: 22,000ì› (ì‚¬ì€í’ˆ 9ë§Œì› í¬í•¨)\n- 13ê°œì›” ì´ë¹„ìš©: ì•½ 333,600ì› (ğŸ‘‰ 11ë§Œì› ì´ìƒ ì´ë“!)\n- 18ê°œì›” ì´ë¹„ìš©: ì•½ 447,000ì› (ğŸ‘‰ 17ë§Œì› ì´ìƒ ì´ë“!)\n--------------------------------`;
                penaltyScript += `\n\n(ì˜ˆì‹œ: 100M ì¸í„°ë„·, ë§¤ë‹¬ 22,000ì› í• ì¸ ì‹œ)\n- 13ê°œì›” ì°¨ ìœ„ì•½ê¸ˆ: ì•½ 218,790ì›\n- 18ê°œì›” ì°¨ ìœ„ì•½ê¸ˆ: ì•½ 237,204ì› (ìµœê³ ì )\n- 24ê°œì›” ì°¨ ìœ„ì•½ê¸ˆ: ì•½ 210,672ì› (ë‹¤ì‹œ ê°ì†Œ ì‹œì‘)`;
            } else if (internetSpeed === 500) {
                tcoScript += `\n\n[ì¸í„°ë„· ë‹¨ë… (500Mbps) ì´ë¹„ìš© ë¹„êµ]\n--------------------------------\nğŸ†š 1ë…„ ì•½ì •\n- ì›” ìš”ê¸ˆ: 41,800ì›\n- 13ê°œì›” ì´ë¹„ìš©: ì•½ 543,400ì›\n- 18ê°œì›” ì´ë¹„ìš©: ì•½ 752,400ì›\n\nâœ… 3ë…„ ì•½ì • (ì¤‘ë„ í•´ì§€ ì‹œ)\n- ì›” ìš”ê¸ˆ: 33,000ì› (ì‚¬ì€í’ˆ 14ë§Œì› í¬í•¨)\n- 13ê°œì›” ì´ë¹„ìš©: ì•½ 439,400ì› (ğŸ‘‰ 10ë§Œì› ì´ìƒ ì´ë“!)\n- 18ê°œì›” ì´ë¹„ìš©: ì•½ 577,000ì› (ğŸ‘‰ 17ë§Œì› ì´ìƒ ì´ë“!)\n--------------------------------`;
                // Note: Penalty calculation for 500Mbps would need its own data, using 100M as placeholder
                penaltyScript += `\n\n(ìœ„ì•½ê¸ˆ ì˜ˆì‹œëŠ” 100M ê¸°ì¤€ì´ë©°, 500Më„ ìœ ì‚¬í•œ êµ¬ì¡°ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.)`;
            }

            tcoScript += `\n\nâœ¨ ê°€ì¥ ì¤‘ìš”í•œ í¬ì¸íŠ¸!\n3ë…„ ì•½ì •ì€ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ìœ„ì•½ê¸ˆì´ í¬ê²Œ ì¤„ì–´ë“­ë‹ˆë‹¤. íŠ¹íˆ ì•½ì • ê¸°ê°„ì˜ ì ˆë°˜ì¸ 1ë…„ 6ê°œì›”(18ê°œì›”)ì´ ì§€ë‚˜ë©´ ë¶€ë‹´ì´ í›¨ì”¬ ëœí•´ì§€ê¸° ë•Œë¬¸ì—, ì˜ˆìƒë³´ë‹¤ ì˜¤ë˜ ì‚¬ìš©í•˜ì‹¤ìˆ˜ë¡ 3ë…„ ì•½ì •ì´ ì••ë„ì ìœ¼ë¡œ ìœ ë¦¬í•©ë‹ˆë‹¤.\n\nâ€» TCO(ì´ ì†Œìœ  ë¹„ìš©)ë€? ì›” ìš”ê¸ˆ, ì‚¬ì€í’ˆ í˜œíƒ, ì¤‘ë„ í•´ì§€ ì‹œ ìœ„ì•½ê¸ˆê¹Œì§€ ëª¨ë‘ ê³„ì‚°í–ˆì„ ë•Œ, ê³ ê°ë‹˜ê»˜ì„œ ì‹¤ì œë¡œ ë¶€ë‹´í•˜ì‹œëŠ” ì´ ê¸ˆì•¡ì…ë‹ˆë‹¤.\nâ€» ì¶œì²˜: kt.com ë²•ì ê³ ì§€ > ì´ˆê³ ì†ì¸í„°ë„· ì´ìš©ì•½ê´€\n\nê²°ë¡ ì ìœ¼ë¡œ, í˜¹ì‹œ ëª¨ë¥¼ ìƒí™©ìœ¼ë¡œ ì¤‘ë„ì— í•´ì§€í•˜ì‹œë”ë¼ë„ 3ë…„ ì•½ì •ìœ¼ë¡œ ì‹œì‘í•˜ì‹œëŠ” ê²ƒì´ ëª¨ë“  ë©´ì—ì„œ ê°€ì¥ ê²½ì œì ì¸ ì„ íƒì…ë‹ˆë‹¤. ğŸ˜Š`;
            penaltyScript += `\n\n**4. ê²°ë¡ : ê°€ì¥ í•©ë¦¬ì ì¸ ì„ íƒê³¼ 'ì•ˆì „ì¥ì¹˜'**\nì´ëŸ¬í•œ êµ¬ì¡° ë•Œë¬¸ì—, 1ë…„ ì´ìƒ ì‚¬ìš©í•˜ì‹¤ ê³„íšì´ë¼ë©´ ì•ì„œ ë³´ë‚´ë“œë¦° 'TCO ë¹„êµ' ìë£Œì—ì„œ ë³´ì…¨ë“¯ 3ë…„ ì•½ì •ì´ ì••ë„ì ìœ¼ë¡œ ìœ ë¦¬í•©ë‹ˆë‹¤.\n\në˜í•œ, ì´ì‚¬ ì‹œ ì„¤ì¹˜ ë¶ˆê°€ ë“± ì•½ê´€ì— ëª…ì‹œëœ ì •ë‹¹í•œ ì‚¬ìœ ê°€ ë°œìƒí•˜ë©´ ìœ„ì•½ê¸ˆ ì—†ì´ í•´ì§€ê°€ ê°€ëŠ¥í•œ 'ìœ„ì•½ê¸ˆ ë©´ì œ'ë¼ëŠ” ì•ˆì „ì¥ì¹˜ë„ ë§ˆë ¨ë˜ì–´ ìˆìœ¼ë‹ˆ ì•ˆì‹¬í•˜ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤.\n\nâ€» ì¶œì²˜: kt.com ë²•ì ê³ ì§€ > ì´ˆê³ ì†ì¸í„°ë„· ì´ìš©ì•½ê´€`;
            
            const waiverScript = `[ë¯¸ì†Œ] ê³ ê°ë‹˜ì˜ ê¶Œë¦¬, 'ìœ„ì•½ê¸ˆ ë©´ì œ ì¡°ê±´' ìƒì„¸ ì•ˆë‚´\n\nì•ˆë…•í•˜ì„¸ìš”, ê³ ê°ë‹˜.\n3ë…„ ì•½ì • ê¸°ê°„ ì¤‘ ì˜ˆê¸°ì¹˜ ëª»í•œ ìƒí™©ì´ ë°œìƒí• ê¹Œ ê±±ì •ë˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nê³ ê°ë‹˜ì˜ ì•Œ ê¶Œë¦¬ë¥¼ ìœ„í•´, ì•½ê´€ì— ëª…ì‹œëœ 'ìœ„ì•½ê¸ˆ ë©´ì œ(í•©ë²•ì  í•´ì§€)' ì¡°ê±´ë“¤ì„ íˆ¬ëª…í•˜ê²Œ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.\n\nì•„ë˜ ì¡°ê±´ì— í•´ë‹¹ë  ê²½ìš°, ìœ„ì•½ê¸ˆ ì—†ì´ ê³„ì•½ì„ í•´ì§€í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n**1. ì„œë¹„ìŠ¤ í’ˆì§ˆì´ ê¸°ì¤€ì— ë¯¸ë‹¬í•˜ëŠ” ê²½ìš°**\n- ì¸í„°ë„· ì†ë„ê°€ 'ìµœì €ë³´ì¥ì†ë„(SLA)' ê¸°ì¤€ì— ì§€ì†ì ìœ¼ë¡œ ë¯¸ë‹¬ (ì›” 5íšŒ ì´ìƒ ì¸¡ì • ê¸°ë¡ í•„ìš”)\n- ì„œë¹„ìŠ¤ ì¥ì• ë¡œ A/Së¥¼ ì›” 3íšŒ ì´ìƒ ë°›ì•˜ìœ¼ë‚˜ ê°œì„ ë˜ì§€ ì•Šì„ ê²½ìš°\n- ì›” ëˆ„ì  ì¥ì•  ì‹œê°„ì´ í†µì‹ ì‚¬ ê¸°ì¤€(KT/LGU+ 48ì‹œê°„)ì„ ì´ˆê³¼í•œ ê²½ìš°\n\n**2. ì´ì‚¬ ë“±ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì´ìš©ì´ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°**\n- ì´ì‚¬í•œ ì¥ì†Œê°€ í†µì‹ ì‚¬ì˜ ì„œë¹„ìŠ¤ ì œê³µ ë¶ˆê°€ ì§€ì—­ì¸ ê²½ìš° (ê°€ì¥ ì¼ë°˜ì ì¸ ë©´ì œ ì‚¬ìœ )\n- ì´ì‚¬í•œ ê±´ë¬¼ì´ íŠ¹ì • í†µì‹ ì‚¬ì™€ ë…ì  ê³„ì•½ ìƒíƒœë¼ íƒ€ì‚¬ ì¸í„°ë„· ì„¤ì¹˜ê°€ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°\n\n**3. ê°€ì…ì ê°œì¸ì˜ í”¼ì¹˜ ëª»í•  ì‚¬ì •ì´ ìƒê¸´ ê²½ìš°**\n- ê³„ì•½ì ë³¸ì¸ì´ êµ°ì— ì…ëŒ€í•˜ëŠ” ê²½ìš° (ì…ì˜í†µì§€ì„œ ë“± ì¦ë¹™ ì„œë¥˜ í•„ìš”)\n- ê³„ì•½ìê°€ ì‚¬ë§í•œ ê²½ìš°\n\nì´ì²˜ëŸ¼ ê³ ê°ë‹˜ì„ ë³´í˜¸í•˜ê¸° ìœ„í•œ ì—¬ëŸ¬ 'ì•ˆì „ì¥ì¹˜'ê°€ ë§ˆë ¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\nì´ëŸ¬í•œ ì¡°ê±´ë“¤ì„ í™•ì¸í•˜ì‹œê³ , ê°€ì¥ ê²½ì œì ì¸ 3ë…„ ì•½ì •ì„ ì•ˆì‹¬í•˜ê³  ì„ íƒí•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.\n\nâ€» ì¶œì²˜: í†µì‹ ì‚¬ ì´ìš©ì•½ê´€ ë° ë°©ì†¡í†µì‹ ìœ„ì›íšŒ ê´€ë ¨ ê·œì •`;

            tcoComparisonScriptEl.value = tcoScript;
            penaltyAnalysisScriptEl.value = penaltyScript;
            penaltyWaiverScriptEl.value = waiverScript;

            // These scripts are static, so they can be set once.
            if (usimCompleteScriptEl) {
                usimCompleteScriptEl.value = `[ë¯¸ì†Œ] ìœ ì‹¬ ì ‘ìˆ˜ ì™„ë£Œ ì•ˆë‚´
ì•ˆë…•í•˜ì„¸ìš”, ê³ ê°ë‹˜.
ë¯¸ì†Œ ì¸í„°ë„· ë¶€ì„œì…ë‹ˆë‹¤.
âœ… ìœ ì‹¬ë™íŒ ì ‘ìˆ˜ê°€ ì™„ë£Œë˜ì—ˆì–´ìš”, ì•„ë˜ ë‚´ìš©ì€ ê³„ì•½ì„œì™€ ë™ì¼í•œ íš¨ë ¥ì´ ìˆìœ¼ë‹ˆ ê¼¼ê¼¼íˆ ì½ì–´ì£¼ì„¸ìš”.
âš ï¸ 12ê°œì›”/24ê°œì›” ì•½ì •ì´ë©°, ì•„ë˜ì™€ ê°™ì€ ìƒí™©ì— í•´ë‹¹í•˜ë©´ ë°›ìœ¼ì…¨ë˜ ì‚¬ì€í’ˆì€ í™˜ìˆ˜ ë©ë‹ˆë‹¤.
â‘  183ì¼ ì´ë‚´ í•´ì§€ ë° ìš”ê¸ˆì œ í•˜í–¥
â‘¡ ê°œí†µ í›„ ë¬´í†µí™” ëŒ€ìƒ
â‘¢ 183ì¼ ì´ë‚´ ëª…ì˜ë³€ê²½ í†µì‹ ì‚¬ ë³€ê²½ ì‹œ
â‘£ 183ì¼ ì´ë‚´ ê²°í•© í•´ì§€
â‘¤ ì¸í„°ë„· ê°œí†µ í›„ ìµì›” ë§ì¼ê¹Œì§€ ê¼­ ìœ ì‹¬ ê°œí†µì´ í•„ìš”í•´ìš”!
âš ï¸ ìœ ì‹¬ ê°œí†µ ì™„ë£Œ ë˜ë©´ ì‚¬ìš©í•˜ì…¨ë˜ ìœ ì‹¬ê³¼ êµì²´í•˜ì—¬ ê¸°ê¸° ì „ì›ì„ 3~4íšŒ ê»ë‹¤ í‚¤ì‹œë©´ ë©ë‹ˆë‹¤!
âœ…ì‚¬ì€í’ˆì€ ì„¤ì¹˜ í›„ 7ì¼ ì´ë‚´ ìë™ìœ¼ë¡œ ì§€ê¸‰ë˜ë‚˜ í‰ì¼ê¸°ì¤€ 5ì‹œ ì´ì „ ê°œí†µ ë°›ì•˜ë‹¤ê³  ë¬¸ì ì£¼ì‹œë©´ ë‹¹ì¼ì…ê¸ˆ ë„ì›€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
ğŸ”Š í•´ë‹¹ ì—°ë½ì²˜ë¡œ ì—°ë½ì´ ì–´ë ¤ìš¸ ê²½ìš° ê±±ì •í•˜ì§€ ë§ˆì„¸ìš”! ì•„ë˜ ëŒ€í‘œë²ˆí˜¸ë¡œ ë¬¸ì˜ì£¼ì‹œë©´ í™•ì¸í•˜ì—¬ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì‹œê°„ ì–‘í•´ ë¶€íƒë“œë ¤ìš”.
[ë¯¸ì†Œë¥¼ ì†Œê°œí•´ì£¼ì„¸ìš”]
ì§€ì¸ì´ ë¯¸ì†Œì—ì„œ ì¸í„°ë„· ì„¤ì¹˜í•˜ë©´ ì†Œê°œí•´ì£¼ì‹  ë¶„ì—ê²Œ 3ë§Œì› ë“œë ¤ìš”.
â–¶ ì§€ì¸ì—ê²Œ ì¶”ì²œí•˜ê³  3O,OOOì› ë°›ê¸° (â†“)
https://get.miso.kr/pZbfsUPthzb
ë¯¸ì†Œ ë“œë¦¼.
â˜ ë¯¸ì†Œ ëŒ€í‘œë²ˆí˜¸ 1577-8808 ì˜¤ì „ 9ì‹œ ~ ì˜¤í›„ 10ì‹œ (ì—°ì¤‘ë¬´íœ´)`;
            }
        
            if (sensitiveInfoLinkScriptEl) {
                sensitiveInfoLinkScriptEl.value = `[KT] ì•„ë˜ ë§í¬ì— ê³ ê°ë‹˜ì˜ ë¯¼ê°ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´ KTë¡œ ê³ ê°ë‹˜ì˜ ë¯¼ê°ì •ë³´ê°€ ì§ì ‘ ì „ì†¡í›„ ì ‘ìˆ˜ ë©ë‹ˆë‹¤.
ì…ë ¥í›„ ì ‘ìˆ˜ ì™„ë£Œ ë¼ê³  ë¬¸ì ì£¼ì‹œë©´ ë‹´ë‹¹ ìƒë‹´ì›ì´ ì ‘ìˆ˜ í™•ì¸í›„ í•„ìˆ˜ ì•ˆë‚´ì‚¬í•­ ì•ˆë‚´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
https://miso.kr/booking/forms/secure-details?querystring=ê³ ê°ë‹˜ ì „í™”ë²ˆí˜¸`;
            }
        }


        window.onload = setInitialDefaults;
    </script>
</body>
</html>
